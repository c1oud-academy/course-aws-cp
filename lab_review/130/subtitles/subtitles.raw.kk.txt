Қайырлы күн, құрметті студенттер! Сіздердің барлығыңызды келесі зертханалық шолу сессиясында көргеніме қуаныштымын. Бүгінгі зертханалық жұмыстың тақырыбы - Масштаб және жүктеме балансы Сіздің сәулетіңіз. Біз ELB қызметтері туралы көбірек білеміз - серпімді жүктеме теңдестірушісі және автоматты масштабтау. Сонымен, бастайық.
Сіз қазірдің өзінде зертханалық бетте тұрсыз және уақытша AWS есептік жазбасын құруды бастадыңыз деп күтілуде. Енді AWS басқару консоліне өту үшін AWS түймесін басу керек. Консольдегі бірінші тапсырма - AMI құру. Мұны істеу үшін біз іздеу жолағына EC2 енгізуіміз керек және сіз іздеу нәтижелеріндегі қажетті сілтемені көресіз. Оны басып, Amazon EC2-ге барайық. Содан кейін таңдаңыз Даналар сол жақ шарлау мәзірінде. Пайда болған даналар тізімінен Веб-сервер 1 таңдаңыз. Содан кейін Әрекеттер түймесін басып, ашылмалы мәзірден Сурет және шаблондар тармағын таңдап, Суретті жасау түймесін басыңыз. Сіз оны басқаннан кейін, сіз кейбір мәліметтерді енгізу қажет жаңа бетке қайта бағытталасыз. Біріншісі - Сурет атауы, сіз WebServerami енгізуіңіз керек. Келесі сурет сипаттамасы, веб-сервер үшін Lab AMI енгізейік. Төмен жылжып, барлық басқа параметрлерді әдепкі бойынша қалдырыңыз және Суретті жасау түймешігін басыңыз. Сіз оны басқаннан кейін сіз алдыңғы бетке қайта бағытталасыз және сіз осы идентификаторы бар AMI сәтті жасалған хабарды көресіз. AMI-ді көшірейік, бізге келесі тапсырмаларда қажет болуы мүмкін. Енді біз мақсатты топ құруымыз керек. Біз Мақсатты топты алдын-ала құрамыз және біз бұл мақсатты топты серпімді жүктеме теңдестірушісін жасау кезінде қолданамыз. Сонымен, біз сол жақ шарлау мәзіріндегі Мақсатты топтарды таңдауымыз керек. Оны басқаннан кейін, біз уақытша AWS есептік жазбамыздағы барлық қолданыстағы Мақсатты топтардың тізімін көреміз. Мақсатты топ жасау түймесін басу керек. Кейбір деректерді енгізу үшін тиісті бет ашылады. Басында сіз даналарды тип ретінде таңдауыңыз керек, яғни біз Amazon EC2-мен жұмыс істейміз. Әрі қарай, сіз төмен қарай жылжып, LabGroup-ты Мақсатты топ атауы ретінде енгізуіңіз керек. VPC ретінде Lab VPC таңдаңыз, барлық басқа параметрлер өзгеріссіз қалады. Беттің төменгі жағында Келесі түймесін басыңыз. Сіз Мақсатты топ құрудың екінші қадамына бағытталасыз және мұнда біздің мақсаттарымызды таңдау керек. Біздің мақсаттарымызды Auto Scaling тобы басқаратындықтан, біз мұнда даналарды таңдаудың қажеті жоқ. Тек бетті төмен қарай жылжып, байланыстырылған мақсаттарсыз мақсатты топ жасау түймесін басыңыз.
Келесі қадам - жүктеме теңдестіргішін жасау. Ол үшін сол жақ шарлау мәзіріндегі Жүктеме теңдестіргіштері опциясын таңдап, ашылатын беттегі Жүктеме теңдестіргішін жасау түймесін басыңыз. Жүктеме теңдестірушілерінің үш түрі бар екенін бәріміз білеміз. Біздің жағдайда, біз бірінші болып мүдделіміз, ол Қолданбалы жүктеме теңдестірушісі. Осы опцияның астындағы Жасау түймесін басайық. Сіз оны басқаннан кейін сіз кіріс деректерін енгізу үшін бетке қайта бағытталасыз. LabelB ретінде көрсетейік Жүктеме теңдестіруші атауы. Әрі қарай, сіз VPC-ді Lab VPC ретінде көрсетуіңіз керек. Mappings бөлімінде біз ELB трафикті тарататын қол жетімділік аймағын таңдап, әр қол жетімділік аймағы үшін ішкі желіні таңдауымыз керек. US-East-1a үшін ашылмалы мәзірде Public Subnet 1 тармағын таңдаңыз, біз-шығыс-1b үшін Public Subnet 2 таңдаңыз. Егер біз сәл төмен қарай айналдырсақ, Қауіпсіздік топтары бөлімінде ашылмалы мәзірден Web Security Group таңдау керек. Келесі Тыңдаушылар мен маршруттау бөлімінде сіз протоколдың HTTP және 80 порты екеніне көз жеткізуіңіз керек. Әдепкі әрекет ретінде ашылмалы тізімнен Lab тобына қайта жіберу параметрін таңдайық. Енді біз беттің ең төменгі жағына жылжып, жүктеме теңдестіргішін жасау түймесін басыңыз. Жүктеме теңдестірушісін жасау түймесін басқаннан кейін, сіз басқа батырмасы бар бетке қайта бағытталасыз, ол сізді тікелей Load Balancer-ге апарады. Сіз одан өтіп, осы ресурсты құрудың барлық мәліметтерін көре аласыз және біз келесі тапсырмаға көшеміз, енді біз автоматты масштабтау тобын құрамыз.
Автоматты масштабтау тобын құру үшін бірінші нәрсе жасау керек Launch config. Ол үшін сол жақ шарлау мәзіріндегі Конфигурацияларды іске қосу опциясын таңдап, ашылатын бетте іске қосу конфигурациясын жасау түймешігін басыңыз. Сіз кіріс бетіне қайта бағытталасыз, өйткені Name LabConfig, біз бұрын жасаған WebServerAMI-ді қалай таңдауға болатынын, Instance түрін t3.micro арқылы қалай таңдау керектігін айтуы керек, егер бұл опция болмаса, мұнда сіз таңдай аласыз t2.micro немесе кез келген басқа. Зертханалық жұмыс аясында ешқандай айырмашылық жоқ. Төменде төмен қарай жылжыңыз, Қосымша конфигурация бөлімінде және Мониторинг бөлімінде егжей-тегжейлі бақылауды іске қосу үшін құсбелгіні қою керек. Бұл метрикалар CloudWatch-қа әдеттегіден жиі жіберілген кезде. Қауіпсіздік топтары бөлімінде “Бар қауіпсіздік тобын таңдау” опциясын таңдаңыз, яғни. біз қолданыстағы қауіпсіздік топтарынан таңдаймыз, жаңасын жасаудың қажеті жоқ. Біз үшін бізде Web Security Group деп аталатын алдын ала жасалған қауіпсіздік тобы бар. Біз оны таңдауымыз керек және біз келесі бөлімге ауысамыз. Ең соңғы бөлім - бұл кілт жұбы, біз SSH арқылы Amazon EC2 даналарына қосылу үшін пайдалануға болатын кілтті көрсетеміз. Зертханалық жұмыс аясында біз SSH арқылы қосылмаймыз, бірақ біз бұл кілтті ең жақсы тәжірибе ретінде көрсетеміз. Кілт жұбы опцияларында бар кілт жұбын таңдау опциясын таңдау керек, содан кейін бар кілтті таңдаңыз - vockey. Сондай-ақ, осы кілтті пайдаланып Amazon EC2 даналарына қосылатынымызды растайтын құсбелгіні қою керек. Бұл соңғы бөлім болды, енді беттің төменгі жағындағы іске қосу конфигурациясын жасау түймесін басу керек. Ол жасалғаннан кейін біз Auto Scaling тобын құруға көшуге болады. Ол үшін іске қосу теңшелімдері тізімінен бұрын жасалған LabConfig таңдаңыз, содан кейін Әрекеттер түймесін басып, ашылмалы мәзірден Автоматты масштабтау тобын жасау опциясын таңдаңыз. Сіз кіріс бетіне қайта бағытталасыз. Автоматты масштабтау тобының атауы өрісі үшін Lab Auto Scaling Group енгізіп, Келесі түймешігін басыңыз. Келесі бетте сіз желі параметрлерін енгізуіңіз керек, I.E. Желілер. Ең алдымен, VPC көрсетіңіз, біздің жағдайда бұл Lab VPC, біз оны ашылмалы тізімнен таба аламыз. Әрі қарай, біз көрсетуіміз керек Қол жетімділік аймақтары мен ішкі желілер. Мұнда ашылмалы тізімнен Private Subnet 1 және Private Subnet 2 таңдау керек. Мен зертханалық жұмысты қарастырған кезде алдыңғы бейнеде жеке субнеттерді неге таңдайтынымызды түсіндірдім. Қажетті ішкі желілерді таңдағаннан кейін келесі бөлікке өтеміз, келесі конфигурация бетіне Келесі түймешігін басыңыз.
Келесі бетте Жүктемені теңестіру бөлімі бар, онда сіз қолданыстағы жүктемені теңестіргішке бекіту опциясын таңдауыңыз керек. Келесі бөлімде Жүктеме теңгерушісінің мақсатты топтарынан Таңдау тармағын таңдап, ашылмалы тізімнен LabGroup жүктемесін таңдаңыз. Төмен қарай жылжып, бақылауға арналған қосымша параметрлер бөлімінде CloudWatch ішіндегі топтық метрикалар жинағын қосу параметрін тексеріңіз. Бұл дегеніміз, біз барлық көрсеткіштерді CloudWatch-те біріктіреміз. Бұл бетте біз барлық қажетті кірістерді көрсеттік, енді Келесі түймесін басу керек. Біз топ өлшемін конфигурациялау бетіне және масштабтау саясатына жетеміз. Біріншіден, біз сыйымдылықты толтырамыз, үш нұсқа бар: Қажетті сыйымдылық, Минималды сыйымдылық және Максималды сыйымдылық. Сондай-ақ, біз зертханалық жұмыстарды қарау кезінде олардың бір-бірінен қалай ерекшеленетінін талқыладық. Мұнда біз 2, 2 және 6 мәндерін енгізуіміз керек және біз қозғаламыз. Келесі бөлім - Масштабтау саясаттары, мұнда Мақсатты бақылауды масштабтау саясатын таңдау керек. Бұл Auto Scaling тобы белгілі бір метрикаға қарап, осы метрикаға байланысты мөлшерін ұлғайтады немесе азайтады деп болжайды. Масштабтау саясатының атауы ретінде LabScalingPolicy енгізейік және метрикалық тип ретінде біз орташа процессорды пайдалануды енгіземіз, яғни. біз Amazon EC2 даналарындағы процессорларымызға жүктемені қарап, Мақсатты мәнді 60 ретінде көрсетеміз. Осы сәтте біз осы беттегі барлық қажетті параметрлерді енгіздік. Төмен жылжып, Келесі түймесін басыңыз.
Келесі бет әр түрлі хабарландыруларды енгізуді сұрайды. Біз мұны зертханалық жұмысымыздың бір бөлігі ретінде орнатпаймыз және біз қозғаламыз. Кейбір енгізуді енгізетін келесі және соңғы қадам - тегтеу қадамы. Lab Instance мәнімен Тег атауын қосып, Тег жаңа даналар жолағын тексерейік. Бұл Auto Scaling тобында жасалған барлық даналар Auto Scaling тобымен бірдей тегтерді алады дегенді білдіреді. Біз осы бетте жасадық, сондықтан соңғы бетке өту үшін Келесі түймесін басайық.
Мұнда ешқандай деректерді енгізудің қажеті жоқ, бірақ біз бұрын енгізген барлық кірістер көрсетіледі. Егер кейбір деректер дұрыс болмаса немесе оны өзгерткіңіз келсе, қажетті бетке жылдам өту үшін әр бөлімнің жанында Өңдеу батырмасы бар. Егер бәрі жақсы болса, беттің төменгі жағына жылжып, Авто масштабтау тобын жасау түймесін басыңыз. Сіз барлық Auto Scaling топтары бар бетке қайта бағытталасыз, жаңарту сыйымдылығы күйін және қазіргі уақытта даналар санын көресіз 0. Егер біз біраз уақыт күтіп, бетті қайтадан жаңартатын болсақ, даналар саны тең Қалаған сыйымдылық, яғни екі жаңа даналар жасалып, күй болады Дайын. Сіз мұны өз бетіңізше жасай аласыз, бірақ қазір біз қозғаламыз, біз даналар шынымен жасалып жатқанын тексергіміз келеді. Мұны істеу үшін сол жақ мәзірдегі даналар түймесін басыңыз және сіз осы AWS есептік жазбасындағы даналар тізімін көресіз. Екі жаңа инстанция қосылды, екеуі де Lab Instance деп аталды және сіз Инициализациялау күйін көре аласыз, яғни олар жаңадан құрыла бастады. Біраз уақыттан кейін олар толығымен жаңартылады, конфигурацияланады және барлық күй тексерулерінен өтеді және бар даналармен бірдей мәнді қабылдайды.
Енді біз жасаған Мақсатты топта қандай мақсаттар бар екенін көру үшін төменгі жағындағы сол жақ шарлау мәзіріндегі Мақсатты топтар қойындысына барайық. Бізде жалғыз мақсатты топ бар, оны таңдайық, экранның төменгі жағында толығырақ ақпарат бар қосымша қойындылар пайда болады. Біз Мақсаттар қойындысына өтуіміз керек және сіз қазіргі уақытта Тіркелген мақсаттар ретінде тізімделген екі дананың бар екенін көресіз. Бұл Auto Scaling тобы жасаған екі даналар және сіз сау күйді көресіз, яғни Elastic Load Balancer трафикті жіберуге дайын және бұл даналар трафикті алуға дайын. Серпімді жүктемені теңестіру, авто масштабтау және Amazon EC2 даналары жиынтығының іс жүзінде жұмыс істеп тұрғанын тексеру үшін біздің қосымшаға кіре аламыз. Мұны істеу үшін сол жақ шарлау мәзіріндегі Жүктеме теңдестіргіштері қойындысын таңдап, бұрын жасаған жалғыз Жүктеме теңдестіргішін таңдағанда, экранның төменгі жағында қосымша қойындылар пайда болады. Бірінші Сипаттама қойындысында біз DNS атауын көшіріп, осы мәнді веб-шолғыштағы жаңа қойындыға енгізе аламыз. Сіз беттің көрсетілгенін көресіз, бұл сіздің сұранысыңыз Load Balancer арқылы қабылданғанын көрсетеді. Load Balancer сіздің сұрауыңызды веб-серверге жіберді, веб-сервер оны өңдеп, кейбір жауапты қайтарды. Бұл жауап сізге веб-парақ түрінде көрсетілген. Сонымен қатар, сіз қандай дананың сұрауыңызды өңдегені туралы ақпаратты көре аласыз. Бұл екінші қол жетімділік аймағында, атап айтқанда, біз-шығыс-1b. Керемет, енді біз Auto Scaling тобының дұрыс жұмыс істейтінін, ол таразылап, өсіп, мөлшерін азайтатынын тексеруіміз керек. Мұны тексеру үшін бірінші қадам - CloudWatch бағдарламасына ауысу. CloudWatch теруді бастайық немесе қызмет іздеу жолағында Watch теруді бастаймыз және біз қажетті сілтемені көреміз. CloudWatch қызметіне кіргеннен кейін, сол жақ шарлау мәзіріндегі Барлық дабылдар опциясын таңдауымыз керек. Осы AWS есептік жазбасында бар барлық дабылдардың тізімі көрсетіледі. Біздің жағдайда екі дабыл болады. Бірінші атауында AlarmHigh бар, екіншісі AlarmLow атауын қамтиды. Бұл қарама-қарсы дабылдар. Идея, AlarmHigh процессорды пайдалану 60% -дан 3 минут ішінде әр минут үшін, яғни 3 datapoints асқанда дабыл болып табылады. Егер біз AlarmLow туралы айтатын болсақ, бұл жағдайда ол дабылдағы мәнді алады, егер процессорды пайдалану 15 минут ішінде 54% -дан аз болса, яғни. ол 15 минут ішінде бақылайды, егер мән 15 минут ішінде азаятын болса, ол дабыл күйіне өтеді. Екі дабыл қарама-қарсы бағытта Auto Scaling тобын іске қосады. AlarmHigh біз үшін жұмыс істеген кезде, Auto Scaling тобы жаңа дананы қосады. AlarmLow іске қосылған кезде, Auto Scaling тобы қосымша дананы жояды. Егер сіз бұл дабылдарды көрмесеңіз, келесі әрекеттерді орындауыңыз керек. Біз Amazon EC2-ге баруымыз керек, содан кейін сол жақ шарлау мәзірінде Автоматты масштабтау топтарын таңдап, тізімнен Lab Auto Scaling таңдаңыз. Және осы автоматты масштабтау тобы туралы ақпарат бар қойындыларда Автоматты масштабтау қойындысын таңдаңыз. Барлық масштабтау саясаттары осы жерде көрсетіледі. Бізде тек бір масштабтау саясаты бар, оны таңдау керек, содан кейін Әрекеттер түймесін басып, оны өңдеу үшін ашылмалы мәзірдегі Өңдеу түймесін басыңыз. Мұнда дабылдарды қайта құруды бастау үшін сіз мәнді өзгертуіңіз керек, мәнді 50-ге орнатып, Жаңарту түймесін басыңыз. Мұны жасағаннан кейін CloudWatch-қа оралуға болады және дабылды жасау керек. Таңдайық AlarmHigh. Біз келесі бетке барамыз, онда ортасында барлық бар дабылдардың тізімі болады және таңдалған дабыл туралы толығырақ ақпарат экранның оң жағында көрсетіледі. Біздің жағдайда, бұл AlarmHigh, сіз қызыл сызықты көресіз, яғни. бұл 50% шекті, және сіз ағымдағы CPU жүктеме мәнін көресіз. Бұл дәл қазір біздің инстанцияларымыздағы ең аз жүктеме. Бұл анық, өйткені жүктеме дәл қазір біздің инстанцияларымызда емес. Енді біз не істейміз? Біз біздің қолданбаға ораламыз және жоғарғы жағында Load Test батырмасы бар екенін көресіз. Оны басайық. Біз оны басқаннан кейін, біз Amazon EC2 даналарына жүктеме жасай бастаймыз. Біздің Amazon EC2 даналарында ағымдағы CPU жүктемесін көрсету үшін бет әр 5 минут сайын жаңартылады. Сіз бұл бетті жаба алмайсыз, егер сіз оны жапсаңыз, сценарийлер жұмысын тоқтатады және жүктеме төмендейді. Бұл қойындыны ашық ұстау керек. Енді біз қайтып оралуымыз керек және біраз уақыттан кейін 5 минуттан кейін диаграммалардың қалай өзгеретінін көруге болады және сіз AlarmHigh дабыл күйіне кіргенін көресіз. Неге? Біздің Amazon EC2 даналарындағы жүктеме 50 немесе 60% -дан асты, қайсысын таңдағанымызға байланысты. Егер біз айтатын болсақ AlarmLow, ол жеткілікті деректерде немесе дабылда, ол қазір OK, бұл қарама-қарсы мемлекет. Енді біздің Auto Scaling тобы қосымша даналар жасағанын білу үшін EC2-ге көшуіміз керек. Мұны істеу үшін сол жақ шарлау мәзіріндегі даналар қойындысына өтіңіз, сонда сіз 3 немесе 4 дананы көресіз, олардың 2-і баптандыру күйінде болады. Біраз уақыттан кейін барлық 4 даналар трафикті алады және жүктемені теңестірушіден барлық сұрауларды өңдейді.
Осы арқылы біз барлық негізгі міндеттерді орындадық. Қосымша эксперимент ретінде мен сізге келесі әрекеттерді орындауға кеңес бергім келеді. Сіз өзіңіздің Amazon EC2 даналарыңыздағы жүктемені тоқтата аласыз. Жүктеме басылғаннан кейін, біраз уақыттан кейін, 15 минут ішінде Auto Scaling тобы тоқтатыла бастайды, яғни Auto Scaling тобындағы даналарды ажыратып, бастапқы күйіне оралады, бізде 2 Lab Instance болады. Енді біз не істей аламыз? Біз екеуі де немесе Lab Instance біреуін қолмен тоқтатып, не болатынын көре аламыз. Және келесілер болады. Сіз даналардың біреуін алып тастағаннан кейін, нысаналардың жалпы саны, яғни Auto Scaling тобындағы даналар, ең төменгі мәннен аз болады. Есімізде, ең төменгі мән 2 болды. Бұл жағдайда, Auto Scaling триггерлері, даналар саны бір себептермен немесе басқа себептермен минимумнан аз екенін көреді және жаңа даналарды құруды бастайды. Біраз уақыттан кейін ол жаңа даналардың қажетті санын жасайды, осылайша даналар саны Auto Scaling топтарының параметрлеріндегі ең аз даналар санына тең болады.
Біз оны соңғы миссиямызға айналдырдық. Бұл өте қарапайым, идея келесідей. Біз бұрын веб-сервер 1 данасынан AMI құрдық, ол жүктемелер алды, сұраулар алды және біздің қосымшаға қызмет етті. Енді бізге қажет емес, біз оны қауіпсіз жойып, жоя аламыз. Ол үшін тізімнен Веб-сервер 1 тармағын таңдап, басқа даналар таңдалмағанына көз жеткізіңіз. Содан кейін жоғарғы жағындағы Instance state түймесін басып, ашылмалы тізімнен дананы тоқтату опциясын таңдаңыз. Сіз өзіңіздің данаңызды шынымен ажыратқыңыз келсе, “Тоқтату” түймешігін басып, дананы ажыратып жатқаныңызды растауыңыз керек. Мысал жойылғаннан кейін, сіз бәрі жұмыс істеп тұрғанын екі рет тексеріп, қолданба бетін аша аласыз. Сілтеме бар Серпімді жүктеме теңдестірушісі және қолданба да жұмысын жалғастырады.
Бұл біздің зертханалық жұмысымызды аяқтайды. Енді біз барлық жүйелерден сәтті шығуымыз керек. Біріншісі - AWS басқару консолі, жоғарғы оң жақ бөліктегі пайдаланушы атын нұқыңыз және ашылмалы тізімдегі Шығу түймесін басыңыз. Әрі қарай, сіз AWS академиясында зертханалық жұмысты аяқтау керек End Lab түймесін басу арқылы дұрыс. Бізден зертхананы шынымен аяқтағымыз келетінін растау сұралады, біз “Иә” батырмасын басамыз және қалқымалы терезеде біз бұл хабарламаны жаба алатын хабарды күтуіміз керек, барлық құрылған ресурстарды жою басталды. Сіз бұл қалқымалы терезені жаба аласыз немесе AWS Академиясының бет қойындысын жаба аласыз.
Бұл бізді зертханалық жұмысымыздың соңына дейін жеткізеді, біз оны бөлшектедік және сізде Elastic Load Balancing және Auto Scaling қызметтері туралы жақсы түсінік бар деп үміттенемін. Бұл біздің инфрақұрылымымызды жүктемеге және сыртқы факторларға байланысты мөлшердің өзгеруі, ұлғаюы немесе азаюы мүмкін абстрактілі организмге айналдыратын негізгі қызметтер. Бұл компанияға, ең алдымен, сіздің пайдаланушыларыңыздың, қосымшаларыңыздың пайдаланушыларының барлық сұраныстарын өңдеуге үлкен мүмкіндіктер береді, ал тағы бір мәселе - сіздің өтініміңізге жүктеме азайған кезде оның мөлшері сіздің АТ-инфрақұрылымыңыздың шығындарын азайту үшін автоматты түрде азаяды.
Зертханалық жұмысты талдау сіз үшін пайдалы болды деп сенемін. Назарларыңызға рахмет, біз сізді келесі іс-шараларда көреміз.