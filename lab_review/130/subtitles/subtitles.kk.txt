Қайырлы күн, құрметті студенттер! Сіздердің барлығыңызды келесі зертханалық жұмысқа  шолу сессиясында көргеніме қуаныштымын. Бүгінгі зертханалық жұмыстың тақырыбы - Scale & Load Balance your Architecture. Біз ELB - Elastic Load Balancer және Auto Scaling сервистерін толығырақ қарастырамыз. Сонымен, бастайық.
Сіз қазір зертханалық жұмыс парақшасында тұрсыз және уақытша AWS аккаунтын құруды бастадыңыз. Енді AWS Management Console-ге өту үшін AWS батырмасын басу керек. Console-дегі бірінші тапсырма - AMI құруымыз керек. Мұны істеу үшін біз іздеу жолағына EC2 деп енгізуіміз керек және сіз қажетті сілтемені көресіз. Оны басып, Amazon EC2 сервисіне өтейік. Әрі қарай, сол жақ навигация мәзірінде Instances қойындысын таңдау керек. Көрсетілген инстанстар тізімінде Web Server 1-ді таңдау керек. Әрі қарай, Actions батырмасын басып, ашылмалы мәзірден Image and templates тармағын таңдап, Create image батырмасын басамыз. Оны басқаннан кейін сіз кейбір деректерді енгізу қажет жаңа парақшаға бағытталасыз. Біріншісі - Image name, сізге WebServerAMI енгізу керек. Әрі қарай, Image description өрісінде LabAMI for Web Server деп енгізейік. Кішкене төменге айналдырайық, барлық басқа параметрлерді әдепкі бойынша қалдырамыз және Create image батырмасын басамыз. Сіз оны басқаннан кейін сізді алдыңғы парақшаға бағыттайды және осындай ID бар AMI сәтті жасалғаны туралы хабарламаны көресіз. AMI-ді көшірейік, ол бізге келесі тапсырмаларда қажет болуы мүмкін. Енді біз Target group құруымыз керек. Target group-ты біз алдын ала жасаймыз және бұл target group-ты Elastic Load Balancer құруда қолданамыз. Сонымен, сол жақ навигациялық мәзірден Target Groups тармағын таңдау керек. Сіз оны басқаннан кейін біздің уақытша AWS аккаунтымыздағы барлық Target Group тізімі көрсетіледі. Біз Create target group батырмасын басуымыз керек. Кейбір деректерді енгізу үшін тиісті парақша ашылады. Ең басында Type ретінде Instances таңдау керек, яғни біз Amazon EC2 сервисімен жұмыс істейміз. Әрі қарай, сәл төмен жылжытып, Target group name ретінде LabGroup енгізу керек. VPC ретінде Lab VPC таңдаңыз, барлық басқа параметрлер солай болып қалады. Парақшаның төменгі жағында Next батырмасын басу керек. Сізді Target group құрудың екінші қадамына бағыттайды және мұнда біздің targets таңдау керек. Біздің targets Auto Scaling group-пен басқарылатындықтан, мұнда инстанстарды таңдаудың қажеті жоқ. Парақшаны сәл төмен айналдырып, Create target group батырмасын тіркелген таргеттерсіз бассаңыз жеткілікті.
Келесі қадам - біз Load Balancer-дің өзін жасауымыз керек. Ол үшін сол жақ навигациялық мәзірде Load Balancers опциясын таңдап, ашылған парақшада Create Load Balancer батырмасын басамыз. Біз Load Balancers-тің үш түрі бар екенін білеміз. Біздің жағдайда біріншісі қызықтырады, бұл Application Load Balancer. Осы опцияның астындағы Create батырмасын басайық. Сіз оны басқаннан кейін, сізді кіріс деректерін енгізу үшін басқа парақшаға бағыттайды. Load balancer name ретінде LabELB көрсетейік. Әрі қарай, VPC көрсету керек - бұл Lab VPC. Mappings бөлімінде біз ELB трафикті тарататын availability zone белгілеп өтуіміз керек, сонымен қатар әрбір availability zone үшін subnet таңдау керек. Ашылмалы мәзірде us-east-1a үшін Public Subnet 1, us-east-1b үшін Public Subnet 2 таңдау керек. Егер біз төменге айналдырсақ, Security groups бөлімінде ашылмалы мәзірден Web Security Group таңдауымыз керек. Келесі Listeners and routing бөлімінде протокол HTTP, ал порттың 80 екендігіне көз жеткізу керек. Default action ретінде ашылмалы тізімнен Forward to Lab Group таңдайық. Енді біз парақшаның ең соңына қарай жылжытып, Create load balancer батырмасын басуымыз керек. Create load balancer батырмасын басқаннан кейін, сізді тағы бір батырмасы бар парақшаға бағыттайды және оны басу арқылы тікелей Load Balancer-ге өтуге болады. Сіз оған өтіп, осы ресурсты құрудың барлық ақпараттарын көре аласыз, ал біз келесі тапсырмаға көшеміз, енді біз Auto Scaling group құрамыз.
Auto Scaling group құру үшін бірінші кезекте Launch config құрылады. Ол үшін сол жақ навигациялық мәзірде Launch Configurations опциясын таңдап, ашылған парақшада Create launch configuration батырмасын басамыз. Сізді кіріс деректерін енгізу парақшасына бағыттайды, Name ретінде LabConfig-ті көрсету керек, AMI ретінде біз бұрын жасаған WebServerAMI-ді таңдауға болады, Instance type ретінде t3.micro таңдау керек, егер бұл нұсқа қол жетімді болмаса, мұнда t2.micro немесе кез келген басқасын таңдауыңызға болады. Зертханалық жұмыс аясында ешқандай айырмашылығы жоқ. Кішкене төмен айналдырамыз, Additional configuration бөлімінде және Monitoring бөлімшесінде, detailed monitoring-ті іске қосу үшін құсбелгі қою керек. Сонда метрикалар CloudWatch-қа әдеттегіден жиі жіберіледі. Security groups бөлімінде Select an existing security group опциясын таңдау керек, яғни біз қолданыстағы security group ішінен таңдаймыз, жаңасын құрудың қажеті жоқ. Біз үшін алдын ала құрылған security group бар, ол Web Security Group деп аталады. Оны таңдау керек және біз келесі бөлімге көшеміз. Ең соңғы бөлім - бұл Key pair, яғни біз мұнда Amazon EC2 инстанстарына SSH арқылы қосылуға болатын кілтті көрсетеміз. Зертханалық жұмыстың аясында біз SSH бойынша қосылмаймыз, бірақ best practice ретінде біз бұл кілтті көрсетеміз. Key pair options-та Choose an existing key pair опциясын таңдап, сосын қолданыстағы vockey кілтін таңдаймыз. Сондай-ақ, осы кілтті пайдаланып Amazon EC2 инстанстарына қосылатынымызды растайтын құсбелгіні қою керек. Бұл соңғы бөлім болды, енді парақшаның төменгі жағындағы Create launch configuration батырмасын басу керек. Ол құрылғаннан кейін біз Auto Scaling group құруға өте аламыз. Ол үшін Launch configurations тізімінде бұрын жасалған LabConfig таңдау керек, содан кейін Actions батырмасын басып, ашылмалы мәзірден Create Auto Scaling group опциясын таңдаймыз. Сізді кіріс деректерін енгізу парақшасына қайта бағыттайды. Auto Scaling group name өрісі үшін Lab Auto Scaling Group деп теріп, Next батырмасын басайық. Келесі парақша Network, яғни желі параметрлерін енгізу керек. Ең алдымен, VPC көрсету керек, біздің жағдайда бұл LabVPC, біз оны ашылмалы тізімнен таба аламыз. Әрі қарай, біз Availability zones and subnets көрсетуіміз керек. Мұнда ашылмалы тізімінен Private Subnet 1 және Private Subnet 2 таңдау керек. Неліктен біз Private Subnets таңдайтынымызды мен алдыңғы видеода зертханалық жұмыстарға шолу жасаған кезде түсіндірдім. Қажетті subnets таңдағаннан кейін біз келесі бөлімге, келесі параметрлер парақшасына өтеміз, Next батырмасын басамыз.
Келесі парақшада Load balancing бөлімі бар, мұнда Attach to an existing load balancer опциясын таңдау керек. Келесі бөлімде Choose from your load balancer target groups және ашылмалы тізімнен Load Balancer LabGroup таңдау керек. Кішкене төмен жылжыту керек және Additional settings бөлімінде, сонымен қатар мониторинг үшін Enable group metrics collection within CloudWatch белгілеу керек. Бұл барлық метрикаларды CloudWatch сервисінде біріктіретінімізді көрсетеді. Бұл парақшада біз барлық қажетті кіріс деректерін шығардық, енді Next батырмасын басу керек. Біз группа өлшемдерін конфигурациялау және scaling policy парақшасына өтеміз. Біріншіден, біз capacity-ді толтырамыз, үш опциясы бар - Desired capacity, Minimum capacity және Maximum capacity. Олардың да бір-бірінен айырмашылығын біз алдыңғы зертханалық жұмысты шолу белсенділігінде талдадық. Мұнда біз 2, 2 және 6 мәнін енгізіп, әрі қарай жүруіміз керек. Келесі бөлім - Scaling policies, мұнда Target tracking scaling policy таңдау керек. Бұл Auto Scaling group кейбір метрикаға қарайтынын және осы метрикаға байланысты өзінің өлшемдерінде ұлғаятынын немесе кішірейетінін көрсетеді. Scaling policy name ретінде LabScalingPolicy және Metric type ретінде Average CPU utilization енгізейік, яғни біз Amazon EC2 инстанстарындағы процессорларымыздың жүктемесіне қараймыз және Target value ретінде 60 көрсетеміз. Осымен біз осы парақшада барлық қажетті параметрлерді енгіздік. Төмен жылжытып, Next батырмасын басайық.
Келесі парақшада әртүрлі хабарландыруларды енгізу ұсынылады. Мұнда біз зертханалық жұмыс аясында мұны реттемейміз, әрі қарай жүреміз. Кіріс деректерін енгізетін келесі және соңғы қадам - бұл тегтер енгізетін қадам. Lab Instance мәні бар Tag Name қосайық және Tag new instances өрісінде құсбелгі қалдырайық. Бұл Auto Scaling group атынан жасалған барлық инстанстар үшін Auto Scaling group-та бар тегтер берілетінін көрсетеді. Біз осы парақшаны баптауды аяқтадық, ең соңғы парақшаға  өту үшін Next батырмасын басайық.
Мұнда ешқандай деректерді енгізудің қажеті жоқ, біз бұрын енгізген барлық кіріс деректері көрсетіледі. Егер кейбір деректер дәл болмаса немесе оларды өзгерткіңіз келсе, онда әр бөлімнің жанында қажетті парақшаға жылдам өту үшін Edit батырмасы бар. Егер бәрі жақсы болса, сіз парақшаның төменгі жағына жылжып, Create Auto Scaling group батырмасын басуыңызға болады. Сізді барлық Auto Scaling groups бар парақшаға бағыттайды, сіз Updating capacity күйін және осы сәтте Instances саны 0 екенін көресіз. Егер біз біраз уақыт күтіп, парақшаны тағы бір рет жаңартатын болсақ, онда инстанстар саны Desired capacity санына теңеседі, яғни екі жаңа инстанс құрылады және күйі Ready болады. Сіз мұны өзіңіз жасай аласыз, ал қазір біз әрі қарай жылжимыз, біз инстанстар шынымен жасалып жатқанын тексергіміз келеді. Ол үшін сол жақ навигациялық мәзірде біз Instances тармағын басуымыз керек және сіз осы AWS аккаунтында инстанстар тізімін көресіз. Екі жаңа инстанс пайда болды, екеуі де Lab Instance деп аталады және сіз Initializing күйін көресіз, яғни олар енді ғана құрыла бастады. Біраз уақыттан кейін олар да толығымен бапталып, реттеліп, барлық статус тексерілуінен өтіп, қолданыстағы инстанстармен бірдей мәнді қабылдайды.
Енді төменгі жағындағы сол жақ навигация мәзірінде біз жасаған Target group-та қандай таргеттер бар екенін көру үшін Target Groups қойындысына өтейік. Бізде жалғыз Target group бар, оны таңдайық, экранның төменгі жағында толық мәліметтер бар қосымша қойындылар пайда болады. Біз Targets қойындысына өтуіміз керек және қазір бізде Registered targets ретінде екі инстанс бар екенін көресіз. Бұл Auto Scaling group жасаған екі инстанс және сіз healthy күйін көресіз, бұл Elastic Load Balancer трафикті бағыттауға дайын екенін және бұл инстанстар бұл трафикті қабылдауға дайын екенін көрсетеді. Elastic Load Balancing, Auto Scaling және Amazon EC2 инстанстары байланысы шынымен жұмыс істеп тұрғанын тексеру үшін біз қосымшамызға кіре аламыз. Ол үшін сол жақ навигациялық мәзірден Load Balancers қойындысын таңдау керек және біз бұрын жасаған жалғыз Load Balancer таңдағанда экранның төменгі жағында қосымша қойындылар пайда болады. Бірінші Description қойындысында біз DNS name мәнін көшіре аламыз және бұл мәнді веб-браузердегі жаңа қойындыға енгізе аламыз. Сіз қандай да бір парақшаның көрсетілгенін көресіз, бұл сіздің сұрауыңызды Load Balancer қабылдағанын көрсетеді. Load Balancer сіздің сұрауыңызды веб-серверге жіберді, веб-сервер оны өңдеді және қандай да бір жауапты қайтарды. Бұл жауап сізге веб-парақша ретінде көрсетіледі. Сонымен қатар, сіз сұрауыңызды қандай инстанс өңдегені туралы ақпаратты көресіз. Бұл екінші availability zone-дағы, атап айтқанда us-east-1b инстансы. Жақсы, енді біз Auto Scaling group дұрыс жұмыс істеп тұрғанын, оның масштабталып, үлкейіп, кішірейіп жатқанын тексеруіміз керек. Мұны тексеру үшін алдымен CloudWatch сервисіне өту керек. CloudWatch деп теруді бастайық немесе сервистерді іздеу жолағына Watch деп теруді бастайық, біз қажетті сілтемені көреміз. CloudWatch сервисіне өткеннен кейін сол жақ навигация мәзірінде All alarms опциясын таңдау керек. Осы AWS аккаунтында бар барлық alarms тізімі көрсетіледі. Біздің жағдайда екі alarms болады. Біріншісінде AlarmHigh атауы, екіншісінде AlarmLow атауы бар. Бұл қарама-қарсы alarms. Идея мынада, егер CPU utilization 3 минут ішінде әр минут үшін 60%-дан асатын болса, AlarmHigh in alarm мәнін қабылдайды, яғни бұл 3 datapoints. Егер біз AlarmLow туралы айтатын болсақ, егер CPU utilization 15 минут ішінде 54%-дан аз болса, бұл жағдайда ол in alarm мәнін қабылдайды, яғни ол 15 минут бақылайды, егер 15 минут ішінде мән азайса, ол alarm күйіне өтеді. Екі alarms та Auto Scaling group-ты қарама-қарсы бағытта іске қосады. Бізде AlarmHigh іске қосылған жағдайда, Auto Scaling group жаңа инстансты қосады. Alarm Low іске қосылған жағдайда, Auto Scaling group артық инстансты жояды. Егер сізде бұл alarms көрсетілмесе, онда келесі әрекетті орындау қажет. Біз Amazon EC2 сервисіне өтуіміз керек, содан кейін сол жақ навигациялық мәзірде Auto Scaling Group опциясын таңдаймыз, тізімнен Lab Auto Scaling таңдаймыз. Осы Auto Scaling group туралы ақпарат бар қойындыларда Automatic scaling қойындысын таңдау керек. Мұнда барлық scaling policy көрсетіледі. Бізде жалғыз scaling policy бар, оны таңдау керек, содан кейін Actions батырмасын басып, ашылмалы мәзірде оны өңдеу үшін Edit батырмасын  басамыз. Мұнда alarms қайта құруды бастау үшін мәнді өзгерту жеткілікті, 50 мәнін қойып, Update батырмасын  басу ұсынылады. Мұны жасағаннан кейін CloudWatch сервисіне қайта оралуға болады және сіз жасалып жатқан alarm-ды көруіңіз керек. AlarmHigh таңдайық. Біз келесі парақшаға өтеміз, оның ортасында барлық бар alarms тізімі болады және экранның оң жағында таңдалған alarm туралы толығырақ ақпарат көрсетіледі. Біздің жағдайда бұл AlarmHigh, сіз қызыл сызықты көресіз, яғни бұл threshold 50% және CPU-дағы ағымдағы жүктеме мәнін көресіз. Бұл қазір біздің инстанстарымызға ең аз жүктеме. Бұл анық, өйткені жүктеме қазір біздің инстанстарымызға түспейді. Енді біз не істейміз? Біз қосымшаға қайта ораламыз және жоғарғы жағында Load Test батырмасы бар екенін көресіз. Оны басайық. Біз оны басқаннан кейін Amazon EC2 инстанстарына жүктеме генерациясын жасай бастаймыз. Парақша әр 5 минут сайын жаңартылып отырады және біздің Amazon EC2 инстанстарындағы процессорлардағы ағымдағы жүктемені көрсетеді. Бұл парақшаны жабуға болмайды, егер сіз оны жапсаңыз, скрипттер жұмысын тоқтатады және жүктеме төмендейді. Бұл қойындыны ашық ұстау керек. Енді біз қайтып оралуымыз керек және сіз біраз уақыттан кейін 5 минут ішінде графиктердің қалай өзгеретінін бақылай аласыз және AlarmHigh in alarm күйіне ауысқанын көресіз. Неліктен? Себебі біздің Amazon EC2 инстанстарына жүктеме біз таңдаған әрекетке байланысты 50 немесе 60%-дан асты. Ал егер бұрын In Sufficient Data немесе In alarm мәнін қабылдаған AlarmLow-ды айтатын болсақ, ол қазір OK мәнін, яғни қарама-қарсы күйді қабылдады. Енді біздің Auto Scaling group қосымша инстанстарды жасағанына көз жеткізу үшін EC2-ге өтуіміз керек. Ол үшін сол жақ навигациялық мәзірде Instances қойындысына өту керек және сіз 3 немесе 4 инстансты көресіз, оның 2-і Initializing күйінде болады. Біраз уақыттан кейін барлық 4 инстанс трафикті қабылдайтын болады және Load Balancer-ден келген барлық сұрауларды өңдейді.
Осымен біз барлық негізгі тапсырмаларды аяқтадық. Қосымша эксперимент ретінде мен сізге келесі әрекеттерді орындауға кеңес бергім келеді. Сіз өзіңіздің Amazon EC2 инстанстарыңызға жүктемені тоқтата аласыз. Жүктеме азайғаннан кейін, біраз уақыттан кейін 15 минут ішінде Auto Scaling group инстанстарды жоюды бастайды, яғни Auto Scaling group-тағы инстанстарды өшіріп, бастапқы күйіне келеді, бізде 2 Lab Instance болады. Енді біз не істей аламыз? Біз екеуін де немесе Lab Instance-тың біреуін қолмен жойып не болатынын көре аламыз. Сонымен келесі жағдай орын алады. Инстанстардың бірін өшіріп тастағаннан кейін, жалпы таргеттер саны, яғни Auto Scaling group атындағы инстанстар минималды мәннен аз болады. Естеріңізде болса, минималды мән 2 болды. Бұл жағдайда Auto Scaling іске қосылады, қандай да бір себептермен инстанстар саны минимумнан аз болғанын көреді және жаңа инстанстар құруды бастайды. Біраз уақыттан кейін инстанстар саны Auto Scaling groups параметрлеріндегі инстанстардың ең аз санына тең болуы үшін ол жаңа инстанстардың қажетті санын жасайды.
Біз соңғы тапсырмаға жеттік. Бұл өте қарапайым, оның идеясы келесідей. Біз бұрын жүктемені, сұраныстарды қабылдайтын және біздің қосымшамызға қызмет көрсететін Web server 1 инстансынан AMI құрдық. Енді ол бізге қажет емес, біз оны қауіпсіз түрде жоя аламыз, өшіре аламыз. Ол үшін тізімнен Web Server 1 таңдау керек, басқа инстанстар таңдалмағанына көз жеткізіңіз. Әрі қарай, жоғарғы бөлігінде Instance state батырмасын басып, ашылмалы тізімнен Terminate instance опциясын таңдау керек. Сіз өзіңіздің инстансыңызды шынымен өшіргіңіз келетіндігі туралы хабарлама шығады, Terminate-ті басып, инстансты өшіріп жатқаныңызды растауыңыз керек. Инстанс жойылғаннан кейін, бәрі шынымен жұмыс істейтінін қайта тексеріп, қосымшаның парақшасын ашуға болады. Онда Elastic Load Balancer-ге сілтеме тұрады және қосымша да жұмысын жалғастырады.
        Осымен біз зертханалық жұмысымызды аяқтаймыз. Енді біз барлық жүйелерден сәтті шығуымыз керек. Біріншісі - AWS Management Console, жоғарғы оң жақта пайдаланушы атын басу керек, ашылмалы тізімде Sign out батырмасын басамыз. Әрі қарай, AWS Academy-де зертханалық жұмысты дұрыс аяқтау керек, ол үшін End Lab батырмасын басу керек. Бізден зертханалық жұмысты шынымен аяқтағымыз келетінін растау сұралады, біз "Yes" батырмасын басамыз және қалқымалы терезеде біз осы хабарламаны жаба аламыз деген хабарламаны күтуіміз керек, барлық жасалған ресурстарды жою басталды. Сіз бұл қалқымалы терезені жаба аласыз, сонымен қатар AWS Academy парақша қойындысын жаба аласыз.
        Осымен біз зертханалық жұмыстың соңына жеттік, сіз Elastic Load Balancing және Auto Scaling сервистері туралы толық түсінік алдыңыз деп үміттенемін. Бұл біздің инфрақұрылымды жүктемеге, сыртқы факторларға байланысты мөлшері өзгеруі, ұлғаюы және азаюы мүмкін, абстрактты организмге айналдыруға мүмкіндік беретін негізгі сервистер. Бұл компанияға үлкен мүмкіндіктер береді, ең алдымен, бұл сіздің қосымшаңызды пайдаланушыларының барлық сұрауларын өңдеу және келесі, сіздің қосымшаңыздағы жүктеме азайған кезде оның өлшемдері де автоматты түрде азаяды, осылайша IT-инфрақұрылымының шығындарын азайту үшін қолданылады.
        Зертханалық жұмысты талдау сізге пайдалы болды деп үміттенемін. Назар аударғаныңыз үшін рахмет және келесі белсенділіктерімізде кездескенше.
