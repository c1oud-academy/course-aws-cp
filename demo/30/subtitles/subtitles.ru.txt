Добрый день, уважаемые студенты! Я рад вас встретить на следующей нашей демо сессии и сегодня мы с вами поговорим про Billing Dashboard. На предыдущих демо мы с вами уже разбирали AWS Management Console, как авторизоваться, какие есть нюансы и на текущий момент вы уже должны знать, как доходить до основной страницы AWS Management Console. С этого места мы продолжим знакомство с Billing Dashboard. Существует два варианта, как можно добраться до страницы Billing Dashboard: 1. Воспользоваться меню сверху справа и в выпадающем меню выбрать Billing Dashboard. 2 вариант: в строке поиска начать вводить Billing, нет необходимости вводить до конца, алгоритм уже выдаст вам подходящие сервисы и, обычно, самый первый это тот сервис, который нам нужен. Мы перешли на Billing Dashboard страницу, вы можете видеть вверху слева, что мы находимся на пункте меню Home. И давайте подробно разберём каждый блок этой основной страницы. Самое первое это AWS Summary: основная информация по нашим расходам на облако. Первое – это Current month’s total forecast. Мы с вами уже проговаривали, как рассчитывается прогноз, и вы видите, что, если мы сохраним темпы потребления ресурсов в облаке, то итоговые траты за весь месяц на облако составит $82. Если же мы говорим про фактические расходы до текущего момента с начала месяца, то нужно посмотреть на второй блок, элемент, это – Current MTD Balance, MTD – это month-to-date. Следующее, последнее, на которое тоже интересно обратить внимание, это сравнение фактически проведённых дней с начала месяца с предыдущим месяцем. Например, сегодня у нас четвёртое число месяца и мы в этом месяце потратили на 56% больше, нежели до четвёртого числа предыдущего месяца, то есть чуть больше чем $6.
Следующий блок это Highest cost и на этом слайде мы можем видеть топ 1 сервис, который больше всего истратил до текущего момента с начала месяца, т.е. за полные 4 дня мы потратили $10 и из них $5 потратили на Amazon Route 53. Это на 42% больше по сравнению с предыдущим месяцем, в котором сумма, которую мы потратили на Amazon Route 53 была $3,5. Эта информация больше предоставляется как preview, т.е. предпросмотр. В самом низу этого блока вы видите ссылку View your bill, т.е. посмотреть ваш общий выставленный счёт и, по нажатию которой, вы переходите на страницу, которая стоит второй строчкой в меню, расположенном в левой части экрана. Следующий блок, который я бы хотел с вами рассмотреть, это наиболее часто используемые 5 самых дорогих сервисов. Вы можете видеть график, в котором за последние 3 месяца проиллюстрированы расходы на каждый из сервисов. С правой стороны этого блока вы видите более точную информацию, например, самая первая, где больше всего мы потратили на Registrar это Amazon Route 53, т.е. покупка доменов. Вы видите на графике, что в июне и в июле была покупка доменов, а в августе не было, поэтому, соответственно, там нет никакого значения. Если мы говорим, как пример, про следующие два сервиса это AWS Elemental MediaConvert красная линия, зелёная линия это Amazon EC2 (Amazon Elastic Compute Cloud), то, в среднем, за 3 месяца расходы были порядка $10, в августе месяце, порядка $20. Мы видим, что почти в 2 раза увеличились расходы на конкретные эти два сервиса.
Последний блок на странице Billing Dashboard, который я хотел бы вам показать, это тренды расходов на 5 самых популярных аккаунтов, которые у нас есть. Этот блок отображается в том случае, когда вы являетесь пользователем сервиса AWS Organizations. Этот аккаунт является админом, т.е. центрально с этого AWS Account администрируются другие AWS Account и на этом аккаунте собирается consolidated billing, т.е. собирается всё использование ресурсов AWS со всех аккаунтов и суммируются  в один общий счёт. Здесь есть возможность сравнить ваши Account. По логике, это абсолютно такой же как и предыдущий блок: можно между собой сравнить, увидеть среднее значение за последние 3 месяца, а также сколько ушло на конкретный аккаунт за последний месяц.
Мы переходим к следующей странице в меню с левой стороны. Это страница Bills, т.е. ваши счета на оплату. На текущем слайде показан пример расходов за сентябрь 2022 года, он ещё не окончился. Здесь есть возможность видеть наши расходы, как по сервисам, так и по аккаунтам. Давайте посмотрим один из примеров сервисов, как она выглядит. Если развернём, например, сервис AWS CodeBuild, то увидим, что вначале происходит разбивка по регионам, дальше, если раскрываем регион, то  каждый регион разбит на определённые группы, которые меняются в зависимости от выбранного вами сервиса. Внутри этой группы есть определённые операции, в которых максимально, насколько возможно, указывается какое было потребление и соответствующая оплата на это потребление в денежном выражении. Давайте рассмотрим подробнее вторую строчку, там, где указано 100 минут, за которые оплачиваем $0 и в тексте написано AWS CodeBuild Free Tier. Мы с вами поговорили о том, что такое AWS Free Tier, это возможность для новых AWS Account попробовать AWS. В течение одного года на каждый месяц даются определённые кредиты. Кредиты, это как купоны, которые можете тратить. В нашем случае купонами являются 100 минут суммарно на работу AWS CodeBuild проектов и за это, как вы видите, мы ничего не оплачиваем. Все то, что произошло поверх, а в нашем случае 3276 минут отработали ещё AWS CodeBuild проекты и за них мы по тарифной сетке оплатили чуть больше чем $16.
Хорошо, мы с вами двигаемся дальше. Следующий сервис, который есть в рамках Billing and Cost Management, это AWS Cost and Usage Reports. Как мы помним, это сервис, который позволяет генерировать информацию по расходам на облако с максимально полной информацией со всеми деталями. Для того, чтобы сгенерировать отчёт нужно выбрать несколько разных параметров. Надо начать с нажатия кнопки Create report, дальше, в зависимости от необходимости, выбираете формат, в котором выгружается, указываете куда выгружается, с какой интенсивностью, в каком виде идёт – с накоплением либо без. Эта информация для того, чтобы вы уже привязались к этим данным и построили своё собственное решение.
Перед тем как перейдём к описанию и обзору AWS Cost Explorer, я бы хотел вам показать Cost Allocation tags. Это такой функционал, который позволяет вам определить набор ключей тегов, которые вы можете в AWS Cost Explorer использовать для лучшей фильтрации или лучшей разбивки ваших данных по тратам на облако. Давайте я вам подробнее расскажу, что такое теги на примере живого человека. Представьте, стоит девушка, попробуем подготовить для неё теги: Тэг ключ (tag key) – волосы, значение – длинные; Тэг ключ – цвет волос, значение – красные, еще пример, платье это ключ и значение – длинное. Таким образом, мы можем описать человека. В нашем случае, мы можем таким же образом передать какую-то полезную информацию для конкретного AWS ресурса. Например, создаём виртуальный сервер и привязываем к нему тэг environment, например, dev или environment, например, prod. Далее, в этом виртуальном сервере крутится Application, то  будет  Tag key – Application и Tag  value будет, например, Application 1 или Application 2  и так далее. То есть, вы понимаете, что таким образом можете максимальное количество информации про этот ресурс сохранить в тэгах для того, чтобы, во-первых, когда вы откроете этот ресурс, вы понимали для чего он был создан, для чего он используется. Более того, когда мы в Cost Allocation tags активируем конкретный Тэг, то есть, скорее всего, у вас будет какой-то определённый набор ключей тегов, которые вы создаёте на все ресурсы, то, таким образом, когда мы здесь его активируем в AWS Cost Explorer уже у вас будет возможность фильтровать или группировать по вот этим тегам. Там, где у некоторых ресурсов конкретный тэг не указан, то он отмечается как не указано и так же суммарно показываются затраты по вот этой группе, то есть по группе ресурсов, у которых тэг не указан.
Следующая страница это Free Tier. На этой странице отображается информация о том, какие ресурсы, участвующие в программе Free Tier, вы используете. Также по каждому ресурсу информация о том, на сколько вы потребили кредиты, которые даны для каждого сервиса. Например, когда мы говорим CodeBuild, 3 строчка, то видно, что все 100 минут, которые даны в рамках Free Tier, уже были 100% использованы. Таким образом, если вы используете Free Tier, и не хотите переплачивать, то периодически проверяйте эту страницу: если где-то вы уже подходите к 100%, то либо следует приостановить использование этого сервиса, либо попытаться где-то оптимизировать. Другой вариант, вы можете зарегистрировать новый аккаунт и уже там продолжить своё использование этого сервиса. Это не запрещается, такой вариант тоже возможен. И ещё один вариант: наши кредиты в рамках Free Tier выдаются в начале каждого месяца, и, если у вас нет никакой срочности, вы можете дождаться конца месяца и первого числа каждого месяца, в течение одного года, вам будут начислять новые кредиты. Таким образом, в следующем месяце мы для проекта CodeBuild получим ещё бесплатные 100 минут.
Далее рассмотрим AWS Cost Explorer, это очень интересный сервис, он мне очень нравится, потому как вы можете, используя достаточно простой и симпатичный инструмент, видеть очень многое, посмотреть на ваши расходы с разных сторон для того, чтобы принять какое-то правильное решение либо выявить какие-то чересчур большие траты в рамках вашей облачной инфраструктуры. Итак, с левой стороны есть меню, нажимаете на AWS Cost Explorer открывается страница AWS Cost Explorer, но она вас направляет ссылкой уже на Dashboard самого AWS Cost Explorer, по нажатии которой открывается следующая страница. Не будем рассматривать страницу Dashboard, потому как она нечасто используется, а перейдём непосредственно в Cost Explorer. Это можно сделать 2 путями: 1. Использовать в меню с левой стороны экрана вторую ссылку, которая называется Cost Explorer либо в Dashboard этого сервиса нажать на кнопку View in Cost Explorer после чего вы перейдёте на страницу Cost Explorer. Давайте посмотрим, что здесь можно сделать. Самое первое, вверху можно выбрать период, можно выбрать гранулярность, т.е. информацию по дням, либо за месяц. Оба варианта могут быть полезны в зависимости от того, что вы ищете, что вы хотите посмотреть. Ниже есть информация по группировкам, т.е. если мы нажмём на один из вариантов предложенных, то он группирует в рамках дня, если мы смотрим по дням расходы, поделённые на сервисы. На следующем слайде это все будет видно. Давайте посмотрим, какие группировки есть ещё. Помимо того, что уже предложено из популярных во вкладке more можно увидеть дополнительные варианты, по которым можно сгруппировать. Более того, вы можете увидеть здесь Тэг. Здесь находятся все те теги, которые были включены ранее в Cost Allocation tags, здесь отобразятся, те которые active. С правой стороны Cost Explorer вы можете видеть фильтры, это очень удобно, если, например, вы хотите посмотреть затраты в рамках одного сервиса, либо затраты в рамках одного аккаунта, региона и так далее, вы видите все варианты, которые здесь есть. Давайте теперь попробуем сделать группировку по сервису. Вы видите, какая она красочная, настроение поднимается, давайте сделаем небольшой анализ. Самые заметные, это коричневые части столбиков, которые относятся к Amazon Route 53, это было 1 Августа и 31 Августа, видимо были какие-то расходы на этот сервис, который привязан конкретно к этому дню. Если мы говорим о следующем, это фиолетовые, AWS Elemental MediaConvert и этот сервис активно использовался в последних днях Августа. По такой же логике вы можете посмотреть расходы на все другие сервисы. Все остальные маленькие столбики – это ярко-зелёное Others, это все те другие сервисы, которые объединены в Others, и являются меньшей частью по сравнению с другими популярными сервисами, на которые мы много потратили. Ниже вы можете уже посмотреть конкретно по каждому дню, по каждому сервису сколько долларов вы потратили на конкретную позицию. После того, как вы подготовили необходимый для вас вид на данные по расходам, вы можете все те настройки, которые вы произвели по группировкам, по фильтрам и так далее, можете сохранить как отчёт.  Наверху сверху увидите кнопку Save as... Далее, когда вы через какое-то время возвращаетесь, можно уже сохранённый отчёт открыть и посмотреть в том виде, где  те же настройки, но уже на новом периоде, на новых данных и посмотреть как меняется картина уже в динамике по вашим расходам. Вернемся на  страницу  Billing Dashboard, это в меню с левой стороны, с которого мы перешли на Cost Explorer. И давайте теперь двигаться дальше.
Это AWS Budgets. Это тот сервис, который также мы на лекции с вами обсуждали. Здесь его можно найти. На этом аккаунте настроен один бюджет, если стоит статус ОК, то значит бюджет не превышен. Давайте посмотрим, что именно заложено в бюджет: фиксированная сумма $150, по достижении которой либо происходит какое-то действие, либо приходит уведомление. В этом случае, например, приходит уведомление и владелец аккаунта видит, что приближается к тем расходам, которые были заложены и надо что-то с этим делать или, по крайней мере, это как дополнительная информация о том, что мы потратили денег столько на сколько рассчитывали. Можно внутри этого сервиса настраивать огромное количество сервисов, не обязательно привязываться к определённой сумме в долларах. Также можно привязаться к usage, например, можно настроить бюджет на сервис AWS CodeBuild. Если общее количество часов суммарной работы AWS CodeBuild проектов достигнет, например, 10 000 минут, то придёт уведомление, либо произойдёт какое-то действие. Более того, внутри каждого бюджета вы можете настраивать некоторые шаги, они тоже гибко настраиваются. Но идея в том, что если у нас  фиксированное количество для AWS CodeBuild проектов 10 000 минут и это доходит до 50 % до середины месяца, это говорит о том, что из рассчитанных 10 000 минут на весь месяц половину мы уже потратили, но 15 дней ещё не прошло. Таким образом, мы заранее знаем, что при таких же темпах мы превысим эти 10 000 минут и что-то с этим нужно сделать. Можно настраивать не только 50 %, а любое количество %, это очень гибкий инструмент. Рекомендую вам его использовать. Возможно, в таком сложном виде он вам не понадобится. Но я вам рекомендую, когда вы открываете свой собственный AWS Account, вы планируете делать там какой-то проект, обязательно не забудьте настроить фиксированную сумму на Total budget и про это можете забыть. Поставьте любую сумму, условно $50 или $100 и вы будете знать, что если за это время, пока вы работали, не приходят уведомления от AWS Budgets,  это говорит о том,  что в течение месяца вы находитесь внутри этого бюджета, это ваши расходы. Если же приходит уведомление, то соответственно вы можете в любой момент, используя эту информацию, принять какие-то соответствующие меры.
Мы с вами заканчиваем это Демо, мы рассмотрели основные моменты, т.е. начиная от Billing Dashboard, заканчивая всеми теми сервисами, которые есть внутри меню Billing Dashboard. И рассмотрели именно те кейсы, которые достаточно часто используются в работе облачного инженера. Я надеюсь, это видео, демо сессия, была полезной, и вы сможете в будущем лучше использовать, точнее скажем, следить за вашими затратами в облаке.
