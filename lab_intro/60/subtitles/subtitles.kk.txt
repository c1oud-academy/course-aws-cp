Қайырлы күн, құрметті студенттер! Барлықтарыңызды келесі «Зертханалық жұмысқа кіріспе» сессиясында көргеніме қуаныштымын. Бүгін Amazon VPC сервисімен тығыз жұмыс істейтін боламыз. Ендеше, бастайық. Зертханалық жұмысты орындау үшін алдымен жұмыстың парақшасын ашу керек. Оған жету үшін AWS Academy-ге кіріп, сәйкес Cloud Foundations курсын ашайық. Содан кейін курстың сол жақ шарлау мәзіріндегі Modules қойындысын ашыңыз. Әрі қарай, біз бесінші модульге көшуіміз керек - бұл Networking and Content Delivery. Егер біз бесінші модульдің барлық белсенділіктерін кеңейтетін болсақ, онда біз төменгі жағында «Build your VPC and Launch your web server» деп аталатын екінші зертханалық жұмысты көреміз. Зертханалық жұмыстың негізгі парақшасына өту үшін осы сілтемені басайық. Біз зертханалық жұмыстың негізгі парақшасына жеттік. Қажет болса, сессияңыз үшін AWS аккаунтын жасауды бастауға болады. Ол үшін Start Lab батырмасын басыңыз. Сондай-ақ, зертханалық жұмыстың тапсырмасы бар ақпарат бүкіл парақшада көрсетілу үшін Terminal терезесін жабуды ұсынамын. Бұл зертханалық жұмыста біз Amazon VPC сервисімен толығырақ жұмыс істейміз. Amazon VPC — дәстүрлі дата-центрінің ішінде құрастыратын сияқты AWS бұлтында желі құруға мүмкіндік беретін сервис. Барлық қажетті компоненттер мен параметрлер қол жетімді. Осы зертханалық жұмысты аяқтағаннан кейін біз AWS Management Console пайдаланып VPC жасауды, subnets жасауды, Security groups-тарды конфигурациялауды және VPC-лерімізде EC2 инстанстарын іске қосуды үйренеміз. Орташа алғанда, бұл зертханалық жұмысты орындауға 30 минут кетеді. Егер сізге көбірек уақыт қажет болса, онда ешқандай шектеулер жоқ, әдепкі бойынша бұл жұмысқа бір жарым сағат беріледі. Зертханалық жұмыс сессиямыз үшін уақытша нақты AWS аккаунты арнайы жасалғанын еске саламын. Ол кейбір шектеулермен жасалған, сондықтан зертханалық жұмыста қарастырылмаған сервисті ашуға әрекеттенсеңіз немесе қарастырылмаған функцияларды пайдалансаңыз, кіру қателерін көруіңіз мүмкін. Бұл қалыпты және күтілетін жағдай, сондықтан зертханада берілген тапсырмаға назар аудару ұсынылады және осы мақсаттар үшін барлық қажетті ресурстар белсендірілген және қолжетімді. Бұл диаграммада зертханадағы элементтерді сәтті орындағаннан кейін соңғы нәтижені көруге болады. Бір қарағанда, бұл күрделі болып көрінуі мүмкін, бірақ алаңдамаңыз, өйткені біз әр қадамды бірге орындаймыз, онда тиісті түсініктемелер беріледі және осы қадамдардың барлығын бірге орындағаннан кейін, AWS бұлтының ішінде осы диаграмманы қайта жасай аламыз. Ең бірінші тапсырма - AWS Management Console-дің негізгі парақшасына өту. Ол үшін зертханалық жұмыстың негізгі мәзірінде Lab Start батырмасын басу керек, қалқымалы терезе пайда болады, біраз уақыттан кейін Lab Status: Ready хабары пайда болады. Бұл уақытша AWS аккаунты сәтті жасалғанын және осы қалқымалы терезені жабуға болатынын көрсетеді, содан кейін AWS батырмасын басу керек. Бұл батырманы басу AWS Management Console ашады және әдетте келесі қадамдарға өту үшін барлық әрекеттерді жасайсыз. Бір ұсыныс, тапсырмаға AWS Management Console-інен ыңғайлырақ ауысу үшін осы батырманың сілтемесін көшіріп, AWS Management Console-ін инкогнито режимінде немесе басқа браузерде ашуға болады. AWS Management Console-інің негізгі парақшасына өткеннен кейін, жоғарғы сол жақтағы Services батырмасын басып, VPC сервисін таңдау ұсынылады. Жылдамырақ нұсқа - сервистерді іздеу үшін арнайы жолға VPC деп енгізу және ең бірінші сілтеме бізге қажет сервиске сілтеме болады. VPC сервисіне көшейік. Amazon VPC сервисінің негізгі парақшасы ашылған бойда сол жақ шарлау мәзірінде New VPC Experience опциясы қосылғанына көз жеткізуіміз керек. Егер ол қосылмаған болса, Amazon VPC сервисінің жаңа интерфейсіне ауысу үшін қосқышты басыңыз. Ауысқаннан кейін сол жақ шарлау мәзіріндегі VPC Dashboard қойындысына өту керек. Жаңа VPC құруды бастау үшін пайда болған парақшада Create VPC батырмасын басу керек. Ашылатын жаңа парақшада сол жақ шарлау мәзірінде VPC Settings, VPC and more таңдау керек. Әрі қарай, Name Tag жолында мәндерді енгізу керек, Project орнына Lab деп жазуыңыз керек, сонымен қатар Auto-generate опциясын қосулы қалдыруыңыз керек, яғни құсбелгіні қойыңыз. Егер аздап төмен өтсеңіз, біздің IPv4 CIDR блогын енгізу мүмкіндігі бар. 10.0.0.0/16 мәнін енгізейік. Әрі қарай, бізде бір Availability аймағы болатынын көрсетеміз. Сондай-ақ, бізде бір Public Subnet және бір Private Subnet болады. Төменде CIDR блоктарын реттеу бөлімі бар, қай CIDR блоктары біздің Subnet-терімізге жататынын нақты көрсету үшін оны кеңейту керек. Public Subnet үшін 10.0.0.0/24, Private Subnet үшін 10.0.1.0/24 көрсетейік. Мұның бәрі us-east-1a Availability аймағында. Әрі қарай, бізге бір Availability аймағында NAT Gateway қажет екенін көрсетеміз, сондықтан In 1 AZ опциясын таңдаймыз. VPC Endpoints үшін None параметрін таңдаймыз, себебі бұл зертханада VPC Endpoints пайдаланбаймыз. Одан да төменірек DNS hostnames және DNS Resolution параметрі бар, біз бұл опцияларды enabled, яғни қосулы қалдыруымыз керек. Preview-ді оң жақта көре аласыз және барлығы сәйкес келетінін тексеру керек, атап айтқанда VPC - lab-vpc. Әрі қарай, Subnets us-east-1a Availability аймағында орналасқан. Public Subnet атауы - lab-subnet-public1-us-east-1a, Private Subnet атауы - lab-subnet-private1-us-east-1a. Әрі қарай, бізде екі Route table бар, біріншісі lab-rtb-public, екіншісі lab-rtb-private1-us-east-1a. Яғни әр Subnet түріне сәйкес Route table бар. Әрі қарай, біздің Network Connections lab-igw, яғни Internet Gateway, ал екіншісі lab-nat-public1-us-east-1a, яғни 1a Availability аймағында орналасқан NAT Gateway екеніне көз жеткізуіңіз керек. Мұнда барлық қажетті параметрлер сәйкес, біз төменгі жағындағы Create VPC батырмасын басуымыз керек. Сіз біздің VPC ішіндегі ресурстардың әрқайсысының жасау күйлері бар парақшаға өтесіз. NAT Gateway жасау бірнеше минутты алады, сондықтан барлық ресурстар сәтті жасалғанша және төменгі жағында View VPC батырмасы көрсетілгенше күтуіміз керек. Бұл батырма пайда болған кезде және қол жетімді болған кезде біз оны басуымыз керек, содан кейін біз VPC бар парақшаға өтеміз. Осылайша біз екі subnets бар VPC сәтті құрдық, біреуі Public, екіншісі Private. Екі subnets бірдей Availability аймағында және әрбір subnet үшін route table жасалған. Осы құрамдастардан басқа Internet Gateway және NAT Gateway құрылды. Тиісті компоненттерді көру үшін сол жақ шарлау мәзірінде сәйкес қойындыларға өтуге болады. Мысалы, Subnets қойындысы - бар subnets-терден жасалған subnets мәліметтерін көру үшін немесе осы AWS аккаунтында қандай Route tables бар екенін көру үшін - Route tables қойындысы. Бұл диаграммада сіз осы уақытқа дейін жасаған бөлікті көре аласыз. Қалғанын келесі тапсырмаларда AWS Management Console-інде жасаймыз. Бұл жерде мен назар аударғым келетін жайт, Internet Gateway VPC ішіндегі ресурс болып табылады, ол біздің EC2 инстанстарымызға Интернетке қол жеткізуге мүмкіндік береді, сонымен қатар Интернеттен қол жетімді болады. Бізде public subnet бар, ол lab-subnet-public1-us-east-1a деп аталады. Оның CIDR блогы 10.0.0.0/24. Бұл IP мекенжайының 32 битінің 24 биті бекітілгендігін білдіреді. Сондықтан соңғы 8 бит өзгеруі мүмкін. Егер 8 бит десек, бұл бірінші IP мекенжайынан басталатын, яғни 10.0.0.0, екінің 8 дәрежесі = 256 бірегей IP мекенжай. Және бұл CIDR блогы қабылдай алатын ең соңғы мән 10.0.0.255 болып табылады. Сонымен қатар, осы subnet үшін келесі масканы көрсетеді, ол 10.0.0.x, ол соңғы блок үшін кез келген мүмкін мәнді қабылдауға болатынын айтады. Біздің есімізде, IPv4 мекенжайының бір бөлігі болып табылатын әрбір блок 8 биттен тұрады, бұл 256 бірегей мәнге тең. Бұл 0-ден 255-ке дейінгі мәнді білдіреді. VPC бөлігі ретінде біз жасаған келесі құрамдас NAT Gateway болып табылады, ол private subnet-тегі EC2 инстанстарына Интернетке кіруге мүмкіндік береді. Бірақ NAT Gateway-дің айрықша ерекшелігі private subnet ішіндегі инстанстарға Интернеттен қол жеткізу мүмкін емес. Осылайша, олар тікелей өңдеуден қорғалған. Егер private subnet туралы айтатын болсақ, ол lab-subnet-private1-us-east-1a деп аталады, оның CIDR блогы кішкене ерекшеленеді, бұл 10.0.1.0/24. /24 сонымен қатар осы CIDR блогында 10.0.1.0-ден басталып, 10.0.1.255-те аяқталатын 256 IP мекенжайы бар екенін білдіреді. Сондай-ақ бұл CIDR блогы 10.0.1.x ретінде белгіленеді. Екінші тапсырмаға да жеттік. Мұнда біз VPC ішінде қосымша subnets жасаймыз. Бұл жаңа VPC екінші availability аймағында болады. Сондай-ақ, VPC ішінде бізде бірнеше availability аймақтары болса, онда біздің шешіміміз, инфрақұрылымымыз highly available деп айтамыз, бұл AWS best practices-ке сәйкес келеді. Көмекші арқылы VPC және оның құрамдастарын жасаған кезде, бұрын жасағандай, барлық жасалған құрамдастарды жоюға, өзгертуге, сонымен қатар осы VPC ішінде жаңа құрамдастарды жасауға болады. Қосымша subnets жасайық. Мұны істеу үшін сол жақ шарлау мәзіріндегі Subnets қойындысына өтіңіз. Енді біз екінші public subnet жасаймыз. Subnets-тер тізімі бар ашылған парақшада Create subnet батырмасын басыңыз. Жаңа subnet құру үшін ашылатын парақшада келесі кіріс деректерін енгізу керек. VPC ID ретінде біз lab-vpc көрсетеміз, ашылмалы мәзірден таңдаңыз. Subnet name ретінде lab-subnet-public2 көрсетеміз. Availability zone ретінде біз алдыңғысынан басқа Availability zone таңдауымыз керек. Мысал ретінде us-east-1b таңдайық. CIDR блогы ретінде біз алдыңғы subnets-термен қиылыспайтын CIDR блогын көрсетеміз, атап айтқанда 10.0.2.0/24. Бұл CIDR блогында сонымен қатар 256 IP мекенжайы бар. Парақшаның төменгі жағында оны жасау үшін Create subnet батырмасын басу керек. Енді екінші private subnet жасайық. Ол үшін Create subnet батырмасын басып, келесі мәндерді енгізейік. VPC ID ретінде ашылмалы тізімнен жасалған VPC lab-vpc файлын таңдауыңыз керек. Әрі қарай subnet name ретінде lab-subnet-private2 көрсетеміз. Availability zone ретінде екінші availability zone таңдаймыз, us-east-1b. Ал CIDR блогы ретінде келесі қолжетімді CIDR блогын, келесі 256 IP мекенжайлар жинағын, атап айтқанда 10.0.3.0/24 көрсету керек. Барлығын толтырғаннан кейін осы private subnet құру үшін Create subnet батырмасын басу керек. Екінші private subnet-тегі инстанстарға Интернетке қол жеткізуді қамтамасыз ету үшін біз бұл трафикті NAT gateway арқылы жіберуіміз керек. NAT gateway-ді біз бірінші availability аймағында жасағанбыз. Бұл трафикті NAT gateway-ге бағыттау үшін біз Route table қолданамыз. Route table - бұл біздің VPC ішінде трафиктің қалай қозғалатынын анықтайтын routes деп аталатын ережелер жиынтығы. Әрі қарай, сол жақ шарлау мәзіріндегі Route tables қойындысына өтуіміз керек. Ашылған парақшада lab-rtb-private1-us-east-1a деп аталатын Route table таңдаймыз. Бұл VPC-мен бірге жасалған Route table. Осы Route table таңдаған кезде, төменгі жағында қосымша ақпарат шығады және Routes қойындысын басу керек. Бұл қойындыда target ретінде біздің NAT gateway көрсететін жалғыз Route болады, ал destination ретінде Интернетті көрсетеді. Бұл Route NAT gateway арқылы осы Route table-ге байланыстырылған барлық private subnets-терге Интернетке кіруге мүмкіндік береді. Осылайша, Интернет private subnet ішіндегі барлық инстанстар үшін қолжетімді болады, бірақ бұл инстанстарға Интернеттен де, сырттан да жету мүмкін емес. Біз орындау керек әрекет: екінші жасалған private subnet-ті осы Route table-ге байланыстыру керек. Мұны істеу үшін Subnet associations қойындысын және пайда болатын қойындыда Edit subnet associations батырмасын басыңыз. Біз subnets тізімін көреміз, сонымен қатар осы Route table-ге бұрыннан байланыстырылған subnets белгіленеді. Біздің жағдайда, бұл бірінші private subnet, VPC-мен бірге құрылған lab-subnet-private1-us-east-1a. Ол таңдалып тұрады. Қосымша құрылған subnet таңдауымыз керек – lab-subnet-private2. Біз оны белгілеп Save associations батырмасын басамыз. Енді біз екінші жасалған public subnet-ке екінші Route table-ді байланыстыруымыз керек. Ол үшін lab-rtb-public Route table таңдаймыз. Егер сіз Routes қойындысын ашсаңыз, біз сондай-ақ бір Route, бір жолды көреміз, онда destination ретінде Интернет және target ретінде Internet gateway көрсетілген. Бізге қандай әрекет істеу керек: екінші public subnet-ті осы Route table-ге байланыстыру. Ол үшін Subnet associations қойындысына өтіп, Edit subnet associations батырмасын басу керек. Мұнда сіз бар subnets тізімін көресіз және осы Route table-мен байланыстырылған subnets белгіленеді. Атап айтқанда, бұл - lab-subnet-public1-us-east-1a. Бізге қосымша екінші жасалған public subnet-тің жанындағы құсбелгіні қою керек, ол lab-subnet-public2 деп аталады. Одан кейін Save associations батырмасын басыңыз. Осы қадамдардың барлығын орындағаннан кейін, диаграммадағы AWS аккаунтындағы жасалған барлық нәрселерді келесідей көрсетуге болады. Бізде сәйкес Route tables байланыстырылған және екінші availability аймағында орналасқан екі қосымша subnets бар екенін көреміз. Біз үшінші тапсырмаға келдік және мұнда біздің VPC ішінде Security group құру керек. Security group дегеніміз не? Бұл EC2 инстанстары үшін виртуалды firewall ретінде әрекет ететін және қажетсіз интернет трафигінен қорғайтын және тек рұқсат етілген трафикке рұқсат беретін ресурс. Security group жасау үшін сол жақ шарлау мәзіріндегі Security groups қойындысына өту керек. Ашылған парақшада Create security group батырмасын басу керек. Әрі қарай, жаңа security group үшін қажетті деректерді көрсетіңіз. Аты ретінде Web Security Group көрсетеміз. Description ретінде Enable HTTP access көрсетеміз. VPC ретінде ұсынылған VPC опциясын алып тастап, ашылмалы мәзірде жасалған VPC - lab-vpc таңдаңыз. Әрі қарай, Inbound rules-та Add rule батырмасын басып, келесі мәндерді қосу керек. Type ретінде біз HTTP көрсетеміз, source ретінде Anywhere-IPv4, яғни бүкіл Интернетті көрсетеміз және description ретінде Permit web requests деп жаза аламыз. Төмен жылжып, Create security group батырмасын басыңыз. Осылайша, біз security group жасадық, оны EC2 инстанстарына байланыстырамыз. Біз төртінші тапсырмаға көшеміз, онда Web Server жасау керек. Web Server - это EC2 инстанс және біз оны веб-сервер ретінде әрекет ету үшін конфигурациялауымыз керек. EC2 инстансын жасау үшін осы сервиске ауысуымыз керек. Бұл әрекетті орындаудың бірнеше жолы бар. Зертханалық жұмыста Services батырмасын басып, сол жерден Amazon EC2 сервисін табу ұсынылады. Тезірек және оңайырақ опция - біздің жағдайда қажет EC2 сервисін сервисті іздеу жолағында енгізу. Теруді бастаған бойда төменде сәйкес сервистерге сілтеме көрсетіледі. Ал ең бірінші сілтеме бізге қажет сілтеме болады. Енді соған көшейік. Amazon EC2 сервисінің негізгі парақшасына кірген бойда жаңа инстансты жасау үшін Launch instance батырмасын басу керек. Ашылған парақшада Web Server 1 атауын енгізейік. Сондай-ақ, біз қазір енгізген мән name кілті бар тегтің мәні болатынын есте ұстаған жөн, яғни тегтердің ішінде мәндік кілттер жұбы жасалады, өйткені кілт ретінде name, value ретінде бұл өріске енгізген мән көрсетіледі. Әрі қарай, біз AMI туралы шешім қабылдауымыз керек. AMI - Amazon Machine Instance және біз оны EC2 инстансына қандай операциялық жүйе орнатылатынын түсіну үшін таңдаймыз. Барлық әдепкі мәндерді қалдырайық, атап айтқанда Amazon Linux және екінші өріс - Amazon Linux 2 AMI (HVM). Келесі параметр - инстанс түрі. t2.micro әдепкі мәнін қалдыру ұсынылады. Инстанс түрінің мәнін таңдаған кезде, біздің инстансқа қандай hardware қосылатынын анықтаймыз. Бұл күшті қуатты сервер немесе әлсіз, бірақ арзан сервер болуы мүмкін. Әрі қарай, біздің серверге SSH арқылы қосыла алу үшін key pair, яғни кілттерді таңдау керек. Ашылмалы мәзірде vockey таңдайық - бұл біз үшін бұрын жасалған SSH кілті. Содан кейін біз желі параметрлеріне көшеміз. Ол үшін Network settings бөлімінде тиісті өзгерістерді енгізу үшін Edit батырмасын басыңыз. Network ретінде lab-vpc таңдаймыз. Әрі қарай, Subnet ретінде біз қолмен жасаған public subnet таңдаңыз, бұл lab-subnet-public2. Әрі қарай, Auto-assign public IP пунктінде Enable пәрменін таңдаңыз, осылайша Интернеттен кіре алатын осы сервер үшін уақытша public IP бөлінеді. Әрі қарай, security group параметрлері бар, яғни Firewall бөлімінде Select an existing security group тармағын таңдау керек, яғни бұрыннан бар security group таңдап, Common security groups үшін Web security group белгілеңіз. Бұл біз бұрын жасаған security group. Осы security group-ты байланыстырғаннан кейін, осы EC2 инстансына дейін Интернеттен HTTP арқылы кіруге рұқсат етіледі. Біз желіні баптау тапсырмасын аяқтаймыз. Енді біз қатқыл диск параметрлерін баптауға көшеміз. Мұнда ешқандай параметрлерді өзгертудің қажеті жоқ, біз барлығын әдепкі бойынша қалдырамыз. Әдепкі бойынша, root volume, яғни түбірлік қатқыл диск ретінде general purpose SSD қатқыл дискісі жасалады және 8 гигабайт жады бөлінеді. Қажет болса, көбірек қатқыл дискілерді қосуға болады немесе 8 гигабайттың орнына үлкенірек мәнді таңдауға болады, бірақ бұл зертханалық жұмыс аясында қажет емес. Сәл төменірек бізде User data деп аталатын Advanced details бөлімінде орналасқан арнайы параметр бар. User data - инстансты бірінші іске қосқан кезде бір рет орындалатын командаларды, скрипттерді енгізуге болатын арнайы өріс. Егер біз келесі код бөлігін, яғни командалар жинағын көшіріп, қойсақ, инстансты іске қосу кезінде жүктеп орнатамыз, сонымен қатар PHP веб-қосымшасын іске қосамыз. User data параметрлерін аяқтағаннан кейін оң жақтағы Launch instance батырмасын басайық. Сіз операцияның сәтті аяқталғаны туралы хабарламаны көресіз және жаңа парақшада View all instances батырмасын басыңыз. Сіз AWS аккаунтындағы және сәйкес аймақтағы барлық инстанстары бар парақшаға қайта бағытталасыз. Бұл тізімде сіз сондай-ақ біз жасаған инстансты көресіз, ол Web Server 1 деп аталады. Status check бағаны 2-нің 2 мәнімен толтырылғанша, барлық тексерулерден өткенше бірнеше минут күтуіміз керек. Күйді жаңарту үшін сәйкес жаңарту белгішесін басуға болады. Бірнеше минут өткен соң және Status check жаңартылған соң, инстансымызды таңдайық және мұны істегеннен кейін, осы инстансқа қатысты қосымша ақпарат төменгі жағында көрсетіледі. Details қойындысында Public IPv4 DNS көшіру керек, содан кейін көшірілген IP мекенжайды жаңа терезеде браузерде инкогнито режимінде іздеу жолағына енгізіп, Enter батырмасын басыңыз. Оны басқаннан кейін біз жасаған парақша ашылады және веб-серверіміз оған қызмет көрсетеді және сіз AWS логотипін және біздің инстансымыз туралы кейбір мета ақпаратты көресіз. Егер сіз мұның бәрін көрген болсаңыз, бұл барлық қадамдарды дұрыс орындағаныңызды білдіреді. Сіздерді зертханалық жұмысымыздың аяқталуымен құттықтаймын. Төменде сіз біздің зертханамызда жасаған барлық компоненттерді тізімдейтін диаграмманы көре аласыз. Осымен тағы да құттықтаймыз, біз зертханалық жұмысты аяқтадық. Енді зертхананы қауіпсіз жауып, аяқтауымыз керек. Ол үшін, зертханалық жұмысымыз бар AWS Academy парақшасында мәзірдің жоғарғы оң жақ бөлігінде End lab батырмасын басыңыз. Растайтын қалқымалы терезе пайда болады, сіз Yes батырмасын басуыңыз керек, содан кейін мәтіндік ақпарат бар басқа терезе пайда болады. «DELETE has been initiated... You may close this message box now» деген хабарды көрген бойда бұл парақшаны және зертханалық жұмысты тұтастай жауып, AWS Academy-ден шығуға болатынын білдіреді. Осымен зертханалық жұмысқа кіріспеміз аяқталды. Ал біз келесі белсенділіктерімізде кездесеміз.