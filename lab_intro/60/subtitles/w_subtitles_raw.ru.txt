Добрый день, уважаемые студенты!
Я рад вас всех видеть на очередной сессии «Введение
в лабораторную работу».
В сегодняшней лабораторной работе мы с вами тесно
поработаем с сервисом Amazon VPC.
Итак, давайте начнем.
Для того, чтобы начать выполнять лабораторную работу, нам
необходимо её предварительно открыть.
Для того, чтобы до него добраться, давайте авторизуемся
в AWS Academy, откроем соответствующий курс Cloud Foundations.
Далее откроем в левом навигационном меню курса вкладку Modules.
Далее нам необходимо перейти на пятый модуль — это Networking
and Content Delivery.
Если мы раскроем все активности пятого модуля, то мы увидим
в нижней части лабораторную работу вторую, которая
называется «Build your VPC and Launch your web server».
Давайте нажмем на эту ссылку для того, чтобы перейти
на основную страницу лабораторной работы.
Мы добрались до основной страницы лабораторной
работы.
Оптонально вы можете иницировать создание AWS аккаунта для
вашей сессии.
Для этого необходимо нажать на кнопку Start Lab.
Также я рекомендую закрыть окно терминала для того,
чтобы информация с заданием лабораторной работы отобразилась
на всю страницу.
В этой лабораторной работе мы с вами подробнее поработаем
с сервисом Amazon VPC.
Amazon VPC — это сервис, который позволяет вам внутри облачных
облаков AWS построить такую же сеть, которую мы строим
в традиционном дата-центре, только в облаке.
Все необходимые компоненты и настройки доступны.
После выполнения этой лабораторной работы мы с вами научимся
с использованием AWS Management Console создавать VPC, создавать
сабнеты, конфигурировать security-группы, а также запускать
EC2-инстанции в VPC.
В среднем выполнение этой лабораторной работы занимает
30 минут.
Если вам требуется больше времени, никаких ограничений
и проблем с этим нет, по умолчанию для выполнения
этой лабораторной работы уделяется полтора часа.
Я вам напоминаю, что специально для нашей сессии лабораторной
работы создается временный реальный AWS-аккаунт.
Он создается с некоторыми ограничениями, поэтому
при попытке открыть сервис, который не предусмотрен
лабораторной работой, либо использовании функционала,
который также не предусмотрен лабораторной работой, вы
можете видеть ошибки доступа.
Это нормально, такое следует ожидать, поэтому рекомендуется
сконцентрироваться на той задаче, которая дана
в рамках лабораторной работы, и для этих целей все необходимые
ресурсы активированы и доступны.
На этой диаграмме вы можете увидеть конечный результат
после успешного выполнения всех пунктов лабораторной
работы.
На первый взгляд может показаться сложной, но
ни в коем случае не следует переживать, потому как мы
пройдемся по каждому шагу, там где необходимы будут
данные соответствующие комментарии, и после выполнения
всех этих шагов вместе мы сможем воссоздать эту
диаграмму внутри облака AWS.
Самая первая задача, необходимо добраться до основной страницы
AWS Management Console.
Для этого в основном меню лабораторной работы необходимо
нажать на кнопку Lab Start, появится всплывающее окно,
в котором через некоторое время появится сообщение
Lab Status Ready.
Это говорит о том, что временный AWS аккаунт успешно создан
и вы можете закрывать это всплывающее окно, после
чего необходимо нажать на кнопку AWS.
По нажатию этой кнопки вы откроете AWS Management Console
и в целом делаете все необходимое, чтобы перейти к следующим
шагам.
Здесь одна рекомендация, для того чтобы удобнее
переключаться к заданию и обратно в AWS Management Console
есть возможность скопировать ссылку этой кнопки и открыть
AWS Management Console либо в Inkognito режиме, либо в другом браузере.
Как только мы перешли на главную страницу AWS Management
Console, в лабораторной работе рекомендуется нажать на
кнопку сверху слева Services и выбрать сервис VPC.
Более быстрый вариант это в специальной строке для
поиска сервисов ввести VPC и самая первая ссылка будет
ссылка на необходимый нам сервис.
Давайте перейдем на сервис VPC.
Как только откроется основная страница сервиса Amazon VPC,
нам необходимо в левом навигационном меню убедиться, что включена
опция New VPC Experience.
Если она не включена, то нажмите на переключатель,
для того чтобы вы переключились на новый интерфейс сервиса
Amazon VPC.
Как только вы переключились, необходимо там же в левом
навигационном меню перейти на вкладку VPC Dashboard.
В отобразившейся странице необходимо нажать на кнопку
Create VPC для того, чтобы начать иницировать создание нового
VPC.
В новой открышейся странице, в левом навигационном
меню VPC Settings, нам необходимо выбрать VPC End Morph.
Далее в Name Tag необходимо ввести значения вместо
Project написать Lab, а также оставить включенную опцию
After Generate, то есть флажок.
Если посмотреть чуть ниже, есть возможность ввести
наш IPv4 CIDR блок.
Давайте введем значение 10.3.0.16.
Далее укажем, что у нас будет одна Availability зона.
Также у нас будет по одному Public Subnet и Private Subnet.
Ниже есть секция Customize Subnets CIDR blocks, необходимо ее
развернуть для того, чтобы явно указать, какие CIDR
блоки относятся к нашим сабнетам.
Для Public Subnet давайте укажем 10.0.0.0.0.24, для Private Subnet укажем
10.0.1.0.24.
Это все в Availability зоне US East 1A.
Далее мы укажем, что нам нужен NAT Gateway в одной Availability
зоне, поэтому выберем опцию In 1AZ.
Для VPC Endpoints выберем вариант None, так как мы в этой лаборатурной
работе не будем использовать VPC Endpoints.
Еще ниже есть настройка DNS Host Name и DNS Resolution, нам
необходимо эти варианты оставить включенными,
то есть enabled.
Вы можете увидеть с правой стороны превью и необходимо
проверить, что все совпадает, а именно VPC это Lab-VPC.
Далее сабнеты у нас находятся в Availability зоне US East 1A.
Название Public Subnet Lab-Subnet-Public1 US East 1A, Private Subnet Lab-Subnet Private1 US East 1A.
Далее у нас есть два road table, первый Lab-RTB-Public, второй
Lab-RTB-Private1 US East 1A.
То есть два road table на каждый из видов сабнетов.
Далее необходимо удостовериться, что наши Network Connections это
Lab-IGV, то есть интернет-гейтвей, а второй это Lab-NAT Public1 US East 1A,
то есть NAT-гейтвей, который находится в Availability зоне
1A.
Здесь все необходимые настройки совпадают, нам необходимо
в нижней части нажать на кнопку Create VPC.
Вы перейдете на страницу со статусами создания
каждого из ресурсов внутри нашего VPC.
Создание NAT-гейтвей потребует несколько минут, поэтому
нам необходимо подождать пока все ресурсы будут
успешно созданы и внизу отобразится кнопка View VPC.
Как только отобразится и станет доступна эта кнопка,
нам необходимо на нее нажать, после чего мы перейдем
на страницу с нашим VPC.
Мы с вами таким образом успешно создали VPC, в котором есть
два сабнета, один Public, другой Private.
Оба сабнета находятся в одной Availability зоне и для
каждого сабнета было создано отдельный road table.
Помимо этих компонентов также были созданы интернет-гейтвей
и NAT-гейтвей.
Для того, чтобы посмотреть соответствующие компоненты,
в левом навигационном меню вы можете перейти на соответствующие
вкладки.
Например, сабнеты для того, чтобы посмотреть детали
созданных из существующих сабнетов, либо road tables для
того, чтобы посмотреть какие road tables есть на этой
AWS аккаунте.
В этой диаграмме вы можете видеть ту часть, которую
мы на текущий момент создали.
Оставшуюся часть мы будем создавать в AWS Management Console
в следующих наших задачах.
Здесь бы хотелось бы также обратить внимание и напомнить,
что интернет-гейтвей это тот ресурс в рамках VPC,
который дает возможность нашим EC2-инстанцам выходить
в интернет, а также быть доступными из интернета.
У нас есть public subnet, который называется lab-subnet public1-useast1a.
У него CIDR блок 10.0.0.0.0-24.
Это говорит о том, что 24 бита среди 32 битов IP-адреса
они зафиксированы.
Значит, 8 битов в последних они могут меняться.
Если мы говорим 8 битов, это значит 2 в степени 8 256
уникальных IP-адресов, которые начинаются с первого IP-адреса,
это 10.0.0.0.
И самое последнее значение, которое может принимать
этот CIDR блок, это 10.0.0.255.
Таким образом, также для этого subnet указывает следующую
маску, это 10.0.0.x, который говорит о том, что для последнего
блока может приниматься любое возможное значение.
А как мы с вами помним, каждый блок, часть IP V4-адреса,
это 8 битов, что равносильно уникальным 256 значениям.
А это значит значение от 0 до 255 включительно.
Следующий компонент, который мы создали в рамках VPC, это
NAT-гейтвей, который позволяет для instance и C2-инстенсов
внутри private subnet выходить в интернет.
Но отличительная особенность NAT-гейтвей, это то, что эти
инстенсы внутри private subnet недоступны из интернета.
Таким образом, они защищены от прямого обращения.
Если мы говорим про наш private subnet, который называется
lab-subnet-private-1-useast-1a, то у него CIDR блок немножко
отличается, это 10.0.1.0.24.
Слеш 24 означает также, что в этом CIDR блоке у нас есть
256 IP-адресов, которые начинаются с 10.0.1.0 и заканчивается
10.0.1.255.
Также этот CIDR блок обозначает как 10.0.1.x.
Мы с вами добрались до второй задачи.
Здесь мы будем создавать дополнительные subnets внутри
нашего VPC.
Эти новые VPC будут находиться во второй availability zone.
Также здесь хотелось бы отметить, что если внутри
VPC у нас находится несколько availability zone, то мы говорим
про наше решение, наша инфраструктура, она highly available, что соответствует
best practices AWS.
Когда мы создаем VPC и ее компоненты, используя помощник, как
мы сделали ранее, то все те компоненты, которые создались,
они могут быть удалены, изменены, а также можем создавать
новые компоненты внутри этого VPC.
Давайте создадим дополнительные subnets.
Для этого необходимо в левом навигационном меню перейти
на вкладку subnets.
Мы сейчас будем создавать второй public subnet.
Необходимо на открытой странице со списком subnets нажать
на кнопку create subnet.
На открытой странице по созданию нового subnet необходимо
ввести следующие входные данные.
Как VPC ID мы указываем lab VPC, выбираем lab VPC из выпадающего
меню.
Далее как subnet name мы указываем lab subnet public to.
Как availability zone нам необходимо выбрать отличную от предыдущей
availability zone.
Как пример давайте выберем US East 1B.
Как cedar block укажем не пересекающийся cedar block с предыдущими
subnets, а именно 10.2.0.24.
В этом cedar block также присутствует 256 IP адресов.
В нижней части страницы необходимо нажать на кнопку
create subnet для того чтобы ее создать.
Давайте теперь создадим второй private subnet.
Для этого также необходимо нажать на кнопку create subnet
и ввести следующие значения.
Как VPC ID необходимо в выпадающем списке выбрать наш созданный
VPC lab VPC.
Далее как subnet name указать lab subnet private to.
Как availability zone необходимо выбрать вторую availability
зону, а именно US East 1B.
И как cedar block необходимо указать следующий доступный
cedar block следующий набор из 256 IP адресов, а именно
10.0.3.0.24.
Как только мы это все заполняем необходимо нажать на кнопку
create subnet для того чтобы этот private subnet создался.
Для того чтобы предоставить доступ в интернет для инстенсов
внутри второго private subnet нам необходимо этот трафик
пустить через NAT gateway.
NAT gateway как мы с вами помним мы создавали в первой availability
зоне.
Для того чтобы этот трафик направить на NAT gateway мы
будем использовать road table.
Road table это некий набор правил или так называемых
root roots of root, который определяет каким образом трафик может
двигаться внутри нашей VPC.
Далее нам необходимо перейти на вкладку road tables в левом
навигационном меню.
На открывшейся странице необходимо выбрать road table
lab-rtb-private1-useast1.
Это тот road table который создался вместе с созданием
VPC.
Как только мы выбираем этот road table внизу выходит дополнительная
информация и необходимо нажать на вкладку roads.
В этой вкладке будет один единственный road который
как target указывает наш NAT gateway, а как destination указывает
интернет.
Этот road позволяет всем сабнетам, private сабнетам, которые
привязаны к этому road table через NAT gateway выходить
в интернет.
Таким образом для всех инстинсов внутри private сабнета становится
доступным интернет, но из интернета и извне до этих
инстинсов добраться невозможно.
Что нам необходимо сделать так это второй созданный
private сабнет привязать к этому road table.
Для этого необходимо нажать на вкладку subnet associations и
в отобразившейся вкладке необходимо нажать на кнопку
edit subnet associations.
Мы увидим список сабнетов, а также те сабнеты которые
уже привязаны к этому road table они будут отмечены.
В нашем случае это первый private subnet который мы создавали
вместе с VPC это lab subnet private 1 use east 1a.
Он уже будет выбран.
Нам необходимо дополнительно выбрать созданный нами
subnet lab subnet private 2.
Отмечаем ее галочкой и нажимаем на кнопку save associations.
Теперь нам необходимо ко второму road table привязать
второй созданный public subnet.
Для этого выбираем road table lab rtb public.
Если открыть вкладку roads то мы увидим там также
один road один путь где как destination указан интернет
и как target интернет gateway.
Что нам необходимо сделать это второй public subnet привязать
к этому road table.
Для этого необходимо перейти на вкладку subnet associations
и также нажать на кнопку edit subnet associations.
Здесь вы увидите список существующих сабнетов
и те сабнеты которые уже привязаны к этому road table
будут отмечены галочкой.
А именно это lab subnet public 1 use east 1a.
Нам дополнительно необходимо поставить галочку возле
второго созданного public subnet который называется lab subnet
public 2.
После чего нажать на кнопку save associations.
Как только мы завершим все эти действия то все
то что мы создали внутри AWS аккаунта в диаграмме
можно отобразить следующим образом.
Мы видим что у нас появились два дополнительных сабнета
которые привязаны к соответствующим road table и находятся в
во второй availability зоне.
Мы добрались до третьего задания и здесь нам необходимо
создать security группу внутри нашего VPC.
Что такое security группа?
Это тот ресурс который выступает как виртуальный
firewall для наших EC2 инстенсов и защищает от нежелательного
интернет трафика и разрешает только тот трафик который
разрешен.
Для того чтобы создать security группу нам необходимо
в левом навигационном меню перейти на вкладку
security groups.
В открывшейся вкладке необходимо нажать страницы необходимо
нажать на кнопку create security group.
Далее указать необходимые данные для нашей новой
security группы.
Как имя укажем web security group.
Как description можем добавить enable HTTP access.
Как VPC необходимо убрать предложенный вариант VPC
и в выпадающем меню выбрать наш созданный VPC lab VPC.
Далее в inbound рулах необходимо нажать на кнопку add rule
и добавить следующие значения.
Как тип мы указываем HTTP, как source указываем anyway IPv4
то есть весь интернет и как description описание
можно написать перемист web requests.
Необходимо прокрутить ниже и нажать на кнопку
create security group.
Таким образом мы создали с вами security группу которую
привяжем к ec2 instance.
Мы переходим к четвертому заданию где нам необходимо
создать наш веб сервер.
Веб сервер это ec2 instance и нам необходимо его сконфигурировать
чтобы он выступал как веб сервер.
Для того чтобы создать ec2 instance нам необходимо перейти
на этот сервис.
Для этого есть несколько путей.
В лабораторной работе рекомендуется нажать на кнопку services и
там найти сервис ec2.
Более быстрый и простой вариант это в специальной
строке поиска сервисов начать вводить нужный нам
сервис в нашем случае ec2.
Как только вы начнете вводить отобразится ниже ссылка
на соответствующие сервисы.
И самая первая ссылка будет та ссылка которая нам нужна.
Давайте на нее перейдем.
Как только мы перейдем на основную страницу сервиса
ec2 нам необходимо нажать на кнопку launch instance чтобы
создать новый instance.
В открывшейся странице давайте введем как имя
веб сервер one.
Следует иметь в виду также что то значение которое
мы сейчас ввели оно будет значением для тега с ключом
name.
То есть создается пара ключ значения внутри тегов
как ключ выступает name как value значение выступает
то значение которое мы ввели в этом поле.
Следующее нам необходимо определиться с AMI.
AMI это Amazon Machine Instance и мы выбираем ее для того чтобы
понять какая операционная система будет установлена
в нашем EC2 instance.
Давайте оставим все значения по дефолту а именно Amazon
Linux и второе поле это Amazon Linux 2 AMI в скобках HVM.
Следующая настройка это тип instance.
Предлагается оставить дефолтовое значение t2.micro.
Когда мы выбираем значение instance type мы определяем какое
железо какое hardware будет подключено к нашему instance.
Это может быть сильный мощный сервер либо какой то слабый
но дешевый сервер.
Далее необходимо выбрать key player то есть ключи для
того чтобы иметь возможность подключаться по SSH к нашему
серверу.
Давайте в выпадающем меню выберем walk key это тот SSH
ключ который предварительно был для нас создан.
Далее мы переходим к настройкам сетей.
Для этого необходимо в секции network settings нажать
на кнопку edit для того чтобы ввести соответствующие
правки.
Как network мы выбираем labvpc.
Далее как subnet выбираем созданный нами вручную
публичный subnet это lab-subnet-public2.
Далее в пункте auto assign public IP выбираем enable для
того чтобы для этого сервера выделился временный public
IP на который мы сможем с интернета обращаться.
Далее есть настройки security group то есть нам необходимо
в секции firewall выбрать select an existing security group то
есть выбрать security группу которая уже существует
и для common security groups отметить галочкой web security группу.
Это та security группа которую мы создавали с вами ранее.
После того как мы привяжем эту security группу то до
этого EC2 instance будет разрешен доступ по HTTP из интернета.
Мы заканчиваем настройку сетей дальше мы переходим
к настройкам жестких дисков.
Здесь нет необходимости менять какие либо настройки
мы все оставляем по умолчанию.
По умолчанию как root volume то есть корневой жесткий
диск создается SSD жесткий диск общего назначения
general purpose и выделяется 8 гигабайт памяти.
По необходимости вы можете добавлять больше жестких
дисков также вы можете вместо 8 гигабайт выбрать
большее значение но в рамках лабораторной работы это
не требуется.
Чуть ниже у нас также есть специальная настройка
которая находится в секции Advanced details называется user
data.
User data это специальное поле куда вы можете ввести ваши
команды скрипты которые запустятся ровно один
раз в момент первого запуска вашего instance.
Если мы скопируем и ставим следующий кусок кода то
есть набор команд то мы в момент запуска нашего
instance загрузим и установим а также запустим php веб-приложение.
Как только мы закончили с настройками user data нам
необходимо в правой части нажать на кнопку launch instance
вы увидите сообщение о том что операция была выполнена
успешно и в новой странице необходимо нажать на кнопку
view all instances.
Вас перенаправить на страницу со всеми instance в этом AWS
аккаунте и соответствующем регионе.
В этом списке вы также увидите созданный нами instance который
называется web server 1.
Нам необходимо подождать несколько минут до того
момента как колонка status check не будет заполнена значением
2 из 2 все проверки пройдены.
Для того чтобы обновлять состояние вы можете нажимать
на соответствующий иконку обновления.
Как только пройдет несколько минут и status check обновится
давайте выберем наш instance и как только мы это сделаем
нижней части отобразится дополнительная информация
об этом инстанции.
Во вкладке details нам необходимо будет скопировать public ipv4
DNS далее скопировать скопированный ip-адрес необходимо в режиме
incognito в браузере в новом окне ставить строку поиска
и нажать enter.
Как только вы это нажмете откроется страница созданная
нами которая обслуживается нашим веб сервером и вы
должны увидеть логотип AWS и также некоторую мета информацию
о нашем инстанции.
Если вы все это увидели это говорит о том что вы
все шаги выполнили верно.
Я вас поздравляю с окончанием нашей лабораторной работы.
Ниже вы видите диаграмму в котором указаны все компоненты
которые мы создали в рамках нашей лабораторной работы.
На этом еще раз поздравляю мы закончили лабораторную
работу.
Теперь нам необходимо безопасно закрыть и завершить лабораторную
работу.
Для этого необходимо в странице AWS Академии с лабораторной
работы в верхней правой части меню нажать на кнопку
end lab.
Выдет всплывающее окно с подтверждением необходимо
нажать на yes после чего выйдет другое окно с некоторой
текстовой информацией.
Как только вы там увидите сообщение что delete has been
initiated you may close this message box now то это говорит о том
что вы можете закрыть эту страницу и можете закрывать
в целом лабораторную работу и выходить с AWS Академии.
На этом мы завершили сессию ведения в лабораторную
работу.
Я вас поздравляю.
А мы с вами увидимся на следующих наших активностях.
