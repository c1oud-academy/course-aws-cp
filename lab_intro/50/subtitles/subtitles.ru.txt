Добрый день, уважаемые студенты! Я рад вас всех видеть на нашей сессии «Введение в лабораторную работу». Тема лабораторной работы – это подробное знакомство с сервисом AWS IAM. Итак, давайте начнем. 
Для того чтобы добраться до лабораторной работы, нам необходимо в AWS Academy открыть курс AWS Academy Cloud Foundations. Далее, во вкладке Modules, спозиционироваться на четвертом модуле, и когда мы откроем активности четвертого модуля, в самом внизу вы увидите «Lab 1 – Introduction to AWS IAM». По нажатию на эту ссылку, возможно, вам отобразится страница с условиями использования сервиса vocareum. Это тот сервис, который предоставляет нам лабораторные работы. Вы можете не спеша ознакомиться с этими условиями. Как только будете готовы, в самом внизу будет кнопка «I Agree», по нажатию которой мы с вами перейдем на основную страницу лабораторной работы. 
На основной странице лабораторной работы нам по умолчанию отображается окно README и окно Terminal. Давайте отключим окно Terminal, для того чтобы на всю страницу развернуть окно README, в котором указываются все шаги, которые нам нужно выполнить в рамках лабораторной работы. Опционально вы можете нажать на кнопку «Start Lab», чтобы параллельно началось создание нового AWS аккаунта для вашей сессии. 
Итак, мы начинаем. Мы пройдемся по всем частям этого README документа, для того чтобы вам было понятнее, о чем эта лабораторная работа, что необходимо вам выполнить, чтобы успешно ее завершить. Тема лабораторной работы – это AWS IAM. Как мы с вами помним, это сервис Identity and Access Management, который позволяет нам настраивать все наши identity, т.е. пользователи, роли, группы, также дает возможность настроить все наши security credentials, т.е. логины, пароли, access keys, MFA и так далее, а также дает возможность для наших identity настроить доступы к AWS ресурсам. На этой схеме отображены AWS ресурсы, с которыми нам предстоит работать. В рамках лабораторной работы мы ознакомимся, какие пользователи и группы были созданы. Также посмотрим, какие policy были прикреплены к созданным IAM группам. Далее, выполним активность, а именно добавим пользователей к некоторым IAM группам, для того чтобы предоставить им доступ к AWS сервисам. После этого мы с вами узнаем, где можно найти ссылку для авторизации в вашем облаке для ваших IAM пользователей. Ну и самое последнее, мы поэкспериментируем с различными policy. Следует также отметить, что в рамках этой лабораторной работы доступ к другим AWS сервисам заблокирован. Вы будете видеть соответствующее сообщение, что доступ запрещен, и это никак не будет влиять на результат выполнения вашей лабораторной работы. 
Здесь передана краткая информация, что есть AWS IAM сервис. Мы с вами знаем, что мы можем управлять и создавать IAM пользователей, роли, а также настраивать permissions, т.е. доступы для этих identity. Другой момент, есть возможность работать с так называемыми federated users. Это те пользователи, которые используют сторонний логин-пароль, обычно с корпоративной среды, для авторизации в облаке AWS. Всего для выполнения лабораторной работы выделяется 40 минут. Этого в большинстве случаев хватает. Я напоминаю, что если этого времени вам не хватает, то, не завершая лабораторную работу, вам необходимо нажать на Start lab. Таким образом, таймер обновится, и у вас появится дополнительные 40 минут для завершения этой лабораторной работы. 
Мы с вами начинаем лабораторную работу. Здесь я бы хотел отметить, что есть сквозная нумерация всех шагов, начиная от 1. Также несколько шагов могут быть объединены в группу. Как пример, с 1-4 шаги мы проделываем некоторые действия, для того чтобы открыть главную страницу Management Console. В 1 шаге говорится о том, что нам необходимо нажать на кнопку Start lab, для того чтобы инициировать создание нового AWS аккаунта. Далее, нам необходимо в отобразившемся окне дождаться "Lab status: ready", который говорит о том, что AWS аккаунт создан. Мы закрываем это окно, после чего нажимаем на кнопку AWS. После этого мы переходим на главную страницу AWS Management Console. В 4 шаге нам говорится о том, что нам необходимо работать с двумя страницами. Первая страница – это AWS Management Console, а вторая – это страница AWS Academy, в которой прописаны все шаги, которые необходимо сделать в рамках лабораторной работы. Для того чтобы удобно работалось, мы можем открыть два окна браузера, либо открыть AWS Management Console в другом браузере, для того чтобы иметь возможность переключаться быстро между двумя этими страницами. Мы двигаемся дальше. 
Task 1: нам необходимо посмотреть, какие пользователи и группы есть в созданном AWS аккаунте. В 5 шаге говорится о том, что нам необходимо открыть сервис IAM. Далее нам необходимо открыть в левом навигационном меню вкладку Users, для того чтобы открылась страница со всеми пользователями в этом AWS аккаунте. Мы увидим, что у нас есть три пользователя. Это user-1, user-2 и user-3. Давайте нажмем на пользователя user-1 и откроем вкладку Permissions. Мы увидим, что нет прикрепленных Permissions для этого пользователя. Далее, давайте откроем вкладку Groups и посмотрим, к каким группам относится этот пользователь. Мы увидим, что этот пользователь не относится к ни одной из групп. Далее нажмем на вкладку Security credentials и увидим, что у этого пользователя есть установленный пароль для AWS Management Console. На 11 шаге нам необходимо в левом меню нажать на вкладку User groups и мы увидим все группы, которые есть в этом AWS аккаунте. Всего будут предсозданных три группы в рамках нашей лабораторной работы. Это EC2-Admin, EC2-Support и S3-Support. Давайте откроем группу EC2-Support. Мы окажемся на странице этой группы. Внизу давайте выберем вкладку Permissions и мы увидим, какие policy прикреплены к этой группе. Для этой группы прикреплена одна Managed Policy, которая называется AmazonEC2ReadOnlyAccess. Это Managed Policy от AWS, которая разрабатывается и обслуживается самим AWS. Вы можете использовать эти policies по необходимости. Еще один момент, который необходимо здесь отметить, это то, что изменения в policy вступают в силу сразу в момент сохранения этого policy. Таким образом, все те identity, которые привязаны к этому policy, сразу же получают новые доступы. На 14-м шаге нам необходимо нажать на кнопку "+" для того, чтобы развернуть policy документ AmazonEC2ReadOnlyAccess. Напоминаю, что policy документ – это тот документ, который предоставляет информацию о том, что разрешен или запрещен, тот или иной ресурс, доступ к тому или иному ресурсу. Если мы говорим про конкретно этот policy, то мы видим, что мы предоставляем доступ к действиям начинающийся на List либо Describe, на сервис Amazon EC2, Elastic Load Balancing, CloudWatch и Auto Scaling. Таким образом, эта policy идеально подходит для роли support специалиста. Внутри IAM policy мы видим, что она состоит из нескольких частей, т.е. есть некоторая структура. Первый блок, который необходимо описать – это Effect, может принимать два значения Allow или Deny. Далее Action – мы расписываем, какие действия либо операции мы разрешаем или запрещаем. Обратите внимание, что в Action через двоеточие разделены названия сервиса и операция к действию в рамках конкретного сервиса. Третий блок – это Resource, который описывает список AWS ресурсов, на которые этот доступ разрешается либо запрещается. На этом мы закончили просмотр policy документа. Давайте нажмем на кнопку "-" и перейдем в левом навигационном меню на вкладку User groups. На 17-м шаге нам необходимо открыть следующую группу S3-Support. Необходимо перейти на вкладку Permissions и убедиться, что к этой группе привязана policy AmazonS3ReadOnlyAccess. Давайте подробнее ознакомимся с содержимым этого policy, нажав на иконку "+". Мы увидим с вами, что эта policy предоставляет доступ к сервису Amazon S3 на действия, начинающиеся на Get и List. Как только мы ознакомились с содержанием нашего policy, нам необходимо нажать на иконку "-" для того, чтобы свернуть содержимое policy. И мы двигаемся дальше. 
Нам необходимо в левом навигационном меню нажать на вкладку User groups для того, чтобы посмотреть подробнее третью нашу группу EC2-Admin. Нам необходимо перейти на вкладку Permissions и посмотреть, какие policy привязаны к этой группе. Вы видите, что Permissions у этой группы отличаются от предыдущих групп, а именно в предыдущих двух группах была Managed Policy. В случае группы EC2-Admin мы видим Inline Policy. Что такое Inline Policy? Это когда мы на identity, т.е. User, Group или Role привязываем какую-то уникальную роль, которая живет в рамках этого ресурса. Inline Policy мы обычно используем для того, чтобы выдать какой-то уникальный доступ для конкретного identity. В случаях, когда нам необходимо создать policy, которая может быть привязана к нескольким identity, то рекомендуется создать отдельно стоящий policy, после чего мы привязываем ее к роли, к группам либо к пользователю. Давайте нажмем на иконку "+" для того, чтобы ознакомиться с содержимым Inline policy. Мы с вами видим, что предоставляется доступ к сервису Amazon EC2 на действие начинающиеся на Describe, а также у нас есть возможность стартовать и останавливать инстансы. Как только мы ознакомились с Inline Policy группой EC2-Admin, нам необходимо нажать на иконку "-" и мы двигаемся дальше. 
В оставшейся части лабораторной работы мы будем выполнять некоторый business case, т.е. практическую задачу, которая выполняется облачными инженерами. Представим, что у нас есть быстро растущая компания, вся IT-инфраструктура хостится на AWS, и эта компания активно использует сервис Amazon EC2 и S3. Также представим, что к нам устроились новые сотрудники и нам необходимо в зависимости от их должностных обязанностей выдать необходимые доступы внутри нашего облака. А именно, для user-1 необходимо выдать доступ к сервису Amazon S3 Read Only доступ, т.е. режим чтения, добавив его в группу S3-Support. Второго пользователя, т.е. user-2, добавить в группу EC2-Support для того, чтобы предоставить доступ в режиме чтения к сервису Amazon EC2. И третьего нашего пользователя добавить в группу EC2-Admin для того, чтобы помимо доступа в режиме чтения к сервису Amazon EC2, у него также была возможность останавливать и стартовать Amazon EC2 Instance. 
Теперь мы с вами проделаем все то, что мы проговорили чуть выше и по шагам будем двигаться. Самым первым нам необходимо user-1 добавить в группу S3-Support для того, чтобы у него появилась policy AmazonS3ReadOnlyAccess. Для этого на 24 шаге нам необходимо слева в навигационном меню выбрать вкладку User groups. В открывшейся странице необходимо выбрать группу S3-Support. Далее на этой странице необходимо выбрать вкладку Users. Мы не увидим ни одного пользователя в этой группе, поэтому нажмем на кнопку Add users, после чего нас перенаправят на страницу со всеми возможными identity, т.е. пользователями, которые мы можем добавить к этой группе. В списке пользователей нам необходимо выбрать user-1 и нажать на кнопку Add Users, после чего пользователь user-1 будет добавлен в группу S3-Support. Далее нам необходимо проделать абсолютно те же действия и добавить user-2 в группу EC2-Support, user-3 добавить в группу EC2-Admin. После того, как мы проделали все эти действия, нам необходимо убедиться, что мы все сделали правильно. Для этого слева в навигационном меню необходимо нажать на вкладку User groups для того, чтобы отобразились все имеющиеся группы на данном AWS аккаунте. Также вы видите дополнительную информацию для каждой группы, а именно колонку с количеством пользователей в каждой группе. Нам необходимо, чтобы в каждой группе было по одному пользователю. Если это так, то вы правильно выполнили второе задание и мы переходим к третьему. 
На третьем задании нам необходимо авторизоваться под нашими пользователями, т.е. IAM users в AWS аккаунте для того, чтобы проверить выданные для них policy. Для этого нам необходимо в левом навигационном меню нажать на вкладку Dashboard в самой верхней части. Как только откроется страница, с правой стороны вы увидите ссылку IAM users sign-in link, т.е. это ссылка, которую вы передаете вашим сотрудникам, чтобы они могли авторизоваться под IAM пользователями в вашем AWS аккаунте. Давайте скопируем эту ссылку куда-нибудь отдельно, так как она нам понадобится еще несколько раз. Вам необходимо открыть любой другой браузер, либо в этом же браузере новое окно в режиме инкогнито и открыть ту ссылку, которую мы скопировали. На открывшейся странице авторизации в AWS Management Console как пользователь ведем user-1, как пароль Lab-Password1. Оно может отличаться для вас, поэтому вы смотрите на страницу с лабораторной работой, открытой у вас в вашей AWS Academy. После успешной авторизации нам необходимо перейти на сервис Amazon S3 для того, чтобы проверить, действительно ли policy, выданные для этого пользователи через группу S3-Support работают. Вы должны увидеть один единственный созданный bucket в рамках этой лабораторной работы, а также у вас не должно возникнуть проблем при открытии содержания этого bucket. Так как в этом bucket не было создано объектов, вы ничего не увидите, но по крайней мере провалиться внутри этого bucket у вас получится и не должно выйти никакого сообщения о запрете доступа. Как только мы убедились, что есть необходимые права доступа у этого пользователя, давайте проверим, есть ли у этого пользователя доступ к сервису Amazon EC2. Напоминаю, что для этого пользователя мы не выдавали доступа к сервису Amazon EC2, поэтому если вы откроете этот сервис, в левом навигационном меню перейдете на вкладку Instances, то вы увидите, что доступ запрещен и появится сообщение, что "You are not authorized to perform this operation", т.е. у вас нет прав для выполнения этой операции. 
Хорошо, давайте теперь выйдем из AWS Management Console под пользователем user-1 и авторизуемся уже под другим пользователем. Для этого в верхней правой части AWS Management Console нам необходимо нажать на кнопку с названием нашего пользователя и Account ID, в выпадающем меню нажать на кнопку Sign Out, т.е. разлогиниться. Как только мы вышли из AWS Management Console под первым пользователем, нам необходимо воспользоваться той же ссылкой, но уже ввести credentials, т.е. логин и пароль от второго пользователя. Пользователь - это user-2, а Password - Lab-Password2. У вас, напоминаю, пароль может отличаться, поэтому вы обязательно перепроверьте на открытой странице AWS Academy. Давайте после успешной авторизации перейдем на сервис Amazon EC2. Напоминаю, что для этого пользователя мы выдали только права на сервис Amazon EC2 в режиме чтения. Как только мы перейдем на вкладку Instances, отобразится список существующих инстансов в этом AWS аккаунте. Если вы не видите список существующих инстансов, вполне возможно, что вы находитесь в другом регионе. В рамках этой лабораторной работы все инстансы были созданы в регионе North Virginia или us-east-1. Если у вас другой регион, то в верхней правой части AWS Management Console выберите нужный регион, после чего отобразится список инстансов. Среди нескольких инстансов вы увидите, что есть инстанс с названием LabHost. Давайте попробуем его остановить. Для этого нужно выбрать сервис LabHost, далее нажать на кнопку Instance state и в выпадающем списке действий нажать на пункт Stop instance. В всплывающем окне с подтверждением, действительно ли вы хотите остановить этот инстанс, нам необходимо нажать на Stop для подтверждения этого действия. После чего вы увидите сообщение о том, что этот пользователь не авторизован выполнить эту операцию. Действительно это так, мы эти права для этого пользователя не выдавали, поэтому все policy работают корректно. Давайте теперь проверим, что будет, если мы под пользователем user-2 попробуем открыть сервис Amazon S3. Здесь также напоминаю, что мы не выдавали никаких доступов для сервиса Amazon S3, поэтому при открытии этого сервиса вы увидите сообщение, что у вас нет прав для отображения списка buckets. Более того, вы заметите, что кнопка Create Bucket также не активна, что говорит о том, что прав на это действие у этого пользователя не имеется. 
Хорошо, давайте теперь авторизуемся по третьим пользователям. Для этого нам необходимо разлогиниться под пользователем user-2. Нам необходимо в верхней правой части нажать на кнопку с Account ID, отобразится выпадающий список и необходимо там выбрать самый последний пункт Sign Out для того, чтобы разлогиниться. Теперь, воспользовавшись той же ссылкой авторизации в AWS Management Console, мы попробуем авторизоваться под пользователем user-3. Для этого необходимо в поле IAM user name ввести user-3, пароль lab-Password3. Он у вас может отличаться, поэтому перепроверьте на открытой странице AWS Academy. Как только мы успешно авторизуемся, давайте перейдем на сервис Amazon EC2. Вам отобразится список существующих EC2. Если этот список не отображается, проверьте, что вы находитесь на правильном регионе. Нам нужен регион North Virginia или us-east-1. Как только мы увидели список необходимых инстансов, нам необходимо выбрать инстанс с названием LabHost, после чего попробовать его остановить. Для этого нажмем на кнопку Instance state и в выпадающем списке нажмем на действие Stop instance. Отобразится всплывающее окно с подтверждением этого действия. Мы подтверждаем это действие, для этого нажимаем на кнопку Stop. После чего мы увидим, что наше действие было успешно выполнено, инстанс остановлен, а также мы видим в списке инстансов, что instance LabHost перешел в состояние stopping. Если мы подождем еще какое-то время и нажмем на иконку обновить список, мы увидим, что наш сервис перешел в состояние stopped, т.е. полностью остановился. На этом мы можем разлогиниться под этим пользователем и закрыть наше окно в режиме инкогнито. 
На этом мы завершили нашу лабораторную работу. Я бы хотел вам напомнить, что необходимо правильно выйти также с лабораторной работы внутри AWS Academy. Для этого в основном меню нажмем на кнопку End Lab. В всплывающем окне необходимо подтвердить это действие и нажать на кнопку Yes. Далее отобразится еще одно всплывающее окно, в котором вы должны увидеть сообщение "You may close this message box now...", т.е. сообщение о том, что мы можем закрывать это сообщение, а также выходить из AWS Academy. 
На этом мы завершили сессию обзора лабораторной работы. Я вас поздравляю. Надеюсь, у вас не возникнет проблем при самостоятельном выполнении этой лабораторной работы. Если же возникнут некоторые сложности, вы всегда можете вернуться, либо параллельно просматривать эту активность, т.е. обзор лабораторной работы. Если также возникают некоторые сложности, вы можете воспользоваться и посмотреть активность разбор лабораторной работы, в которой мы подробно уже выполняя фактически эту лабораторную работу, видим, что необходимо сделать. Если же не получается выполнить самостоятельно, я вам рекомендую в любом случае пересмотреть разбор лабораторной работы, чтобы как минимум увидеть, как весь этот процесс происходит, и получить общее понимание и впечатление работы в AWS Management Console. Резюмируя, что мы научимся в рамках этой лабораторной работы, это мы посмотрели, какие пользователи, какие группы есть в предварительно созданном для нас AWS аккаунте. Далее посмотрели, какие policy есть у этих групп, после чего выполнили практическое действие, практическую работу, с которым сталкивается каждый облачный инженер, а именно попробовали добавить пользователей в соответствующие IAM группы в рамках должностных обязанностей этих пользователей. Также мы с вами научились находить IAM sign-In URL, т.е. специальную ссылку для логина IAM пользователей внутри AWS аккаунта. Мы несколько раз с вами это проделали, а также поэкспериментировали, какие есть доступы у тех или иных пользователей в рамках данных для них доступов внутри сервиса AWS IAM. 
На этом мы завершаем нашу сессию обзора лабораторной работы и увидимся на следующих наших активностях.
