WEBVTT

00:00:00.000 --> 00:00:03.000
Добрый день, уважаемые студенты!

00:00:03.000 --> 00:00:06.680
Я рад вас всех видеть на очередной сессии обзора

00:00:06.680 --> 00:00:08.080
лабораторной работы.

00:00:08.080 --> 00:00:12.640
Тема сегодняшней лабораторной работы это Scale and load balance

00:00:12.640 --> 00:00:13.640
your architecture.

00:00:13.640 --> 00:00:17.160
Итак, давайте начнем.

00:00:17.160 --> 00:00:23.740
Самым первым делом нам необходимо в AWS Academy открыть

00:00:23.740 --> 00:00:27.240
соответствующий курс Cloud Foundations, далее в левом

00:00:27.240 --> 00:00:31.360
навигационном меню перейти в Models.

00:00:31.360 --> 00:00:34.520
На открывшейся странице спозиционируется на 10-ом

00:00:34.520 --> 00:00:38.480
модуле Auto Scaling and Monitoring и вы увидите активность

00:00:38.480 --> 00:00:42.000
Lab 6 Scale and load balance your architecture.

00:00:42.000 --> 00:00:46.000
Давайте на нее нажмем, чтобы перейти на основную страницу

00:00:46.000 --> 00:00:47.000
лабораторной работы.

00:00:47.000 --> 00:00:55.720
Здесь мы можем скрыть окно терминала, убрав галочку

00:00:55.720 --> 00:00:59.040
соответствующего пункта и оставить только readme,

00:00:59.040 --> 00:01:06.560
для того чтобы удобнее было читать задание нашей лабораторной

00:01:06.560 --> 00:01:07.560
работы.

00:01:07.560 --> 00:01:11.080
Также вы можете параллельно нажать на кнопку Start Lab,

00:01:11.080 --> 00:01:15.600
для того чтобы начать инницирование временного AWS аккаунта

00:01:15.600 --> 00:01:16.600
для вашей сессии.

00:01:16.600 --> 00:01:23.880
В этой лабораторной работе мы подробнее изучим сервисы

00:01:23.880 --> 00:01:28.800
Elastic Load Balancing ELB и Auto Scaling.

00:01:28.800 --> 00:01:32.640
ELB мы используем для того, чтобы балансировать трафик

00:01:32.640 --> 00:01:37.060
на наши таргеты, а Auto Scaling используем для того, чтобы

00:01:37.060 --> 00:01:41.480
динамически увеличивать либо уменьшать наши IT-ресурсы.

00:01:41.480 --> 00:01:44.900
Самый частый сервис, который используется в связке

00:01:44.900 --> 00:01:48.880
с ACG, то есть Auto Scaling Group, это EC2-инстанции.

00:01:48.880 --> 00:01:52.720
Что мы сегодня будем с вами делать?

00:01:52.720 --> 00:02:00.640
Первое, мы создадим копию AMI от уже работающего инстанса.

00:02:00.640 --> 00:02:04.520
Далее мы создадим Load Balancer, сконфигурируем и запустим

00:02:04.520 --> 00:02:09.000
Auto Scaling группу, а также посмотрим, как все эти сервисы работают

00:02:09.000 --> 00:02:13.840
в связке, как происходит Auto Scaling, и мы можем также

00:02:13.840 --> 00:02:18.680
увидеть эти изменения в алармах и промониторить

00:02:18.680 --> 00:02:22.520
этот процесс в Amazon CloudWatch.

00:02:22.520 --> 00:02:28.240
Для выполнения этой лабораторной работы рекомендуется потратить

00:02:28.240 --> 00:02:29.240
30 минут.

00:02:29.240 --> 00:02:32.080
Я напоминаю, что если вам нужно больше времени, то

00:02:32.080 --> 00:02:36.120
вы всегда можете обнулить счетчик и продолжить выполнение

00:02:36.120 --> 00:02:41.560
лабораторной работы.

00:02:41.560 --> 00:02:45.200
До начала нашей лабораторной работы мы видим, что текущая

00:02:45.200 --> 00:02:49.480
архитектура внутри AWS, она имеет следующий вид.

00:02:49.480 --> 00:02:53.280
Что будет сделано в рамках этой лабораторной работы?

00:02:53.280 --> 00:03:00.160
Это мы создадим Load Balancer, перенесем наш веб-инстанц,

00:03:00.160 --> 00:03:04.000
который находился в Public Subnet 2, сверху справа, на Private

00:03:04.000 --> 00:03:09.000
Subnet и настроим связку Load Balancer и Auto Scaling.

00:03:09.000 --> 00:03:12.080
Таким образом у нас будут создаваться инстанцы по

00:03:12.080 --> 00:03:16.760
необходимости в обеих Availability Zones, то есть Availability Zone

00:03:16.760 --> 00:03:24.520
A и Availability Zone B.

00:03:24.520 --> 00:03:27.040
Самым первым делом для того, чтобы начать выполнение

00:03:27.040 --> 00:03:30.960
лабораторной работы, нам нужно добраться до AWS Management

00:03:30.960 --> 00:03:31.960
Console.

00:03:31.960 --> 00:03:34.320
Для этого, если вы еще не сделали, вам необходимо

00:03:34.320 --> 00:03:38.480
нажать на кнопку Start Lab вверху справа.

00:03:38.480 --> 00:03:42.680
Как только вы на нее нажмете, появится всплывающее окошко,

00:03:42.680 --> 00:03:47.280
в котором будет указан статус лабораторной работы,

00:03:47.280 --> 00:03:49.120
то есть Lab Status in Creation.

00:03:49.120 --> 00:03:52.240
Как только поменяется статус на Ready, вы можете закрывать

00:03:52.240 --> 00:03:55.800
это окно и далее вам необходимо будет нажать на кнопку

00:03:55.800 --> 00:04:00.520
AWS, чтобы перейти на созданный для вашей сессии лабораторной

00:04:00.520 --> 00:04:07.840
работы временный AWS Account.

00:04:07.840 --> 00:04:11.000
Как только вы добрались до AWS Management Console, мы можем

00:04:11.000 --> 00:04:13.440
переходить к выполнению первого задания.

00:04:13.440 --> 00:04:16.960
Здесь нам необходимо создать копию AMI.

00:04:16.960 --> 00:04:21.600
Этот AMI будет использоваться для создания новых инстанцев

00:04:21.600 --> 00:04:23.520
под автоскейлинг группой.

00:04:23.520 --> 00:04:27.920
Для этого нам необходимо в строке поиска сервисов

00:04:27.920 --> 00:04:32.780
начать вводить EC2, либо нажать на кнопку Services и в выпадающем

00:04:32.780 --> 00:04:35.440
меню найти сервис EC2.

00:04:35.440 --> 00:04:38.080
Как только мы перейдем в левом навигационном меню,

00:04:38.080 --> 00:04:41.240
нам необходимо выбрать Инстанцы и отобразить список

00:04:41.240 --> 00:04:46.880
всех инстанцев в нашем AWS Account в конкретном регионе.

00:04:46.880 --> 00:04:52.040
Если вы не видите инстанции, то проверьте, что у вас стоит

00:04:52.040 --> 00:04:59.520
регион North Virginia или US East 1.

00:04:59.520 --> 00:05:06.640
Вы должны увидеть инстанс с названием Web Server 1.

00:05:06.640 --> 00:05:11.040
Нужно проверить, что в колонке Status Checks стоит два из двух,

00:05:11.040 --> 00:05:14.220
что говорит о том, что сервер был успешно создан и готов

00:05:14.220 --> 00:05:15.320
к работе.

00:05:15.320 --> 00:05:19.840
Как только вы это увидите, необходимо выбрать этот

00:05:19.840 --> 00:05:20.840
инстанс.

00:05:20.840 --> 00:05:25.160
Далее в пункте меню Actions выбрать опцию Image and Templates.

00:05:25.160 --> 00:05:27.960
Далее нажать на опцию Create Image.

00:05:27.960 --> 00:05:31.340
В открывшейся странице нам необходимо указать

00:05:31.340 --> 00:05:34.840
как имя Image, Web Server, AMI.

00:05:34.840 --> 00:05:40.000
Далее как description указать Lab AMI for Web Server и в самом

00:05:40.000 --> 00:05:42.600
внизу нажать на кнопку Create Image.

00:05:42.600 --> 00:05:48.520
Вы увидите новый созданный AMI и его соответствующий

00:05:48.520 --> 00:05:49.520
ID.

00:05:49.520 --> 00:05:52.800
Вам необходимо этот ID скопировать, так как мы ее будем использовать

00:05:52.800 --> 00:05:57.440
чуть позднее в следующем задании.

00:05:57.440 --> 00:06:00.000
Мы переходим ко второму заданию и здесь нам необходимо

00:06:00.000 --> 00:06:01.720
создать Load Balancer.

00:06:01.720 --> 00:06:06.200
Я напоминаю, что Load Balancer это тот IT ресурс, который

00:06:06.200 --> 00:06:10.280
помогает нам балансировать нагрузку на наши вычислительные

00:06:10.280 --> 00:06:11.280
мощности.

00:06:11.280 --> 00:06:14.720
В нашем случае это EC2 Instance и мы настроим Load Balancer таким

00:06:14.720 --> 00:06:20.200
образом, чтобы оно балансировало трафик на несколько Availability

00:06:20.200 --> 00:06:21.200
Zones.

00:06:21.200 --> 00:06:25.120
Самым первым делом нам необходимо создать Target

00:06:25.120 --> 00:06:32.040
Group, то есть это те ресурсы, которые показывают куда

00:06:32.040 --> 00:06:34.760
будет направляться трафик от Load Balancer.

00:06:34.760 --> 00:06:41.160
Необходимо в левом навигационном меню выбрать Target Groups.

00:06:41.160 --> 00:06:45.340
Далее в открывшейся странице нажать на кнопку Create Target

00:06:45.340 --> 00:06:49.120
Group.

00:06:49.120 --> 00:06:52.720
Как Target Type нам необходимо выбрать Instances, как Target

00:06:52.720 --> 00:06:56.680
Type Name давайте укажем Lab Group и также нам необходимо

00:06:56.680 --> 00:06:57.920
указать VPC.

00:06:57.920 --> 00:07:03.120
В выпадающем меню давайте выберем Lab VPC.

00:07:03.120 --> 00:07:07.440
Далее нам необходимо нажать на кнопку Next и вы увидите

00:07:07.440 --> 00:07:12.440
Register Targets секцию.

00:07:12.440 --> 00:07:15.440
На текущий момент у нас не созданы наши таргеты,

00:07:15.440 --> 00:07:19.080
поэтому мы можем пропустить этот шаг и нажать на кнопку

00:07:19.080 --> 00:07:22.080
Create Target Group.

00:07:22.080 --> 00:07:26.920
Теперь мы переходим непосредственно к созданию Load Balancer.

00:07:26.920 --> 00:07:30.120
Для этого в левом навигационном меню необходимо выбрать

00:07:30.120 --> 00:07:31.120
Load Balancers.

00:07:31.120 --> 00:07:34.360
В открывшейся странице нажмем на кнопку Create Load

00:07:34.360 --> 00:07:37.780
Balancer, откроется еще одна страница, в которой вам

00:07:37.780 --> 00:07:41.680
нужно будет выбрать тип нового создаваемого Load

00:07:41.680 --> 00:07:42.680
Balancer.

00:07:42.680 --> 00:07:45.440
Нас интересует Application Load Balancer, давайте нажмем на

00:07:45.440 --> 00:07:49.360
кнопку Create под этой опцией.

00:07:49.360 --> 00:07:56.960
Укроется страница для ввода свойств нового Load Balancer.

00:07:56.960 --> 00:08:00.040
Как имя давайте укажем Lab ELB.

00:08:00.040 --> 00:08:04.520
Далее в настройках сети NetOrq необходимо выбрать

00:08:04.520 --> 00:08:09.040
VPC, в нашем случае это Lab VPC.

00:08:09.040 --> 00:08:12.360
Далее после этого нам необходимо выбрать Evolubility Зоны, для

00:08:12.360 --> 00:08:16.840
этого выбираем первую Evolubility Зону US East 1A.

00:08:16.840 --> 00:08:23.480
Здесь нам необходимо выбрать PubLic Subnet 1, то же самое необходимо

00:08:23.480 --> 00:08:27.880
проделать для второй Evolubility Зоны и выбрать PubLic Subnet

00:08:27.880 --> 00:08:28.880
2.

00:08:28.880 --> 00:08:33.160
В результате у вас должно быть выбрано два Subnet, это

00:08:33.160 --> 00:08:37.480
PubLic Subnet 1 и PubLic Subnet 2.

00:08:37.480 --> 00:08:41.680
Мы переходим к следующей секции, это Security группы.

00:08:41.680 --> 00:08:44.680
Здесь нам необходимо в выпадающем меню выбрать

00:08:44.680 --> 00:08:47.760
опцию Web Security Group.

00:08:47.760 --> 00:08:50.880
Также вы видите, что выбрана дефолтовая Security группа,

00:08:50.880 --> 00:08:54.200
она нам не нужна, поэтому необходимо нажать на кнопку

00:08:54.200 --> 00:08:58.360
X и удалить дефолтовую Security группу.

00:08:58.360 --> 00:09:00.840
В результате у нас останется одна-единственная Security

00:09:00.840 --> 00:09:05.400
группа, которая называется Web Security групп.

00:09:05.400 --> 00:09:08.400
Самая последняя настройка это Listener, то есть на какой

00:09:08.400 --> 00:09:12.480
порт, по какому протоколу будет приходить трафик.

00:09:12.480 --> 00:09:15.560
В нашем случае это HTTP 80.

00:09:15.560 --> 00:09:18.880
И также здесь нам необходимо указать как дефолтовый

00:09:18.880 --> 00:09:23.240
action, перенаправлять трафик на Lab группу.

00:09:23.240 --> 00:09:28.280
На этом мы завершили ввод всех настроек для LoadBouncer.

00:09:28.280 --> 00:09:31.780
Сейчас необходимо прокрутить самый низ страницы и нажать

00:09:31.780 --> 00:09:34.240
на кнопку Create LoadBouncer.

00:09:34.240 --> 00:09:37.840
Вы увидите сообщение о том, что LoadBouncer был успешно

00:09:37.840 --> 00:09:38.840
создан.

00:09:38.840 --> 00:09:41.520
Также вы можете нажать на кнопку View LoadBouncer для

00:09:41.520 --> 00:09:45.680
того, чтобы открыть страницу нашего LoadBouncer.

00:09:45.680 --> 00:09:49.240
Вы видите, что состояние сейчас provisioning.

00:09:49.240 --> 00:09:52.720
Через некоторое время оно поменяется на состояние

00:09:52.720 --> 00:09:54.520
ready либо success.

00:09:54.520 --> 00:09:58.240
И таким образом будет готово к работе.

00:09:58.240 --> 00:10:02.240
Нам нет необходимости ждать того момента, когда

00:10:02.240 --> 00:10:04.440
LoadBouncer будет готов, так как следующее задание

00:10:04.440 --> 00:10:11.640
оно создает следующие IT ресурсы в сервисе Autoscaling.

00:10:11.640 --> 00:10:14.760
Поэтому мы можем, не дождавшись изменения статуса, переходить

00:10:14.760 --> 00:10:19.440
к следующему заданию.

00:10:19.440 --> 00:10:22.000
Мы с вами переходим к третьему заданию.

00:10:22.000 --> 00:10:23.320
Это объемное задание.

00:10:23.320 --> 00:10:26.880
Здесь мы будем создавать Launch Configuration и Autoscaling

00:10:26.880 --> 00:10:27.880
группу.

00:10:27.880 --> 00:10:32.880
Я вам напоминаю, что Autoscaling группа это тот IT ресурс,

00:10:32.880 --> 00:10:35.920
который позволяет нам в зависимости от определенной

00:10:35.920 --> 00:10:42.240
метрики, например, нагрузка на CPU, изменять количество

00:10:42.240 --> 00:10:43.240
таргетов.

00:10:43.240 --> 00:10:48.920
В нашем случае это вычислительные мощности или EC2 инстанции.

00:10:48.920 --> 00:10:54.000
Таким образом, если повышается нагрузка на наши EC2 инстанции,

00:10:54.000 --> 00:10:57.920
то Autoscaling группа автоматически создает новый инстанц

00:10:57.920 --> 00:11:00.240
для того, чтобы нагрузку распределить.

00:11:00.240 --> 00:11:04.600
В случае, если нагрузка она минимальная, то и Autoscaling

00:11:04.600 --> 00:11:08.120
группа видит, что у нас есть избыточное количество

00:11:08.120 --> 00:11:15.120
EC2 инстанцев, то лишние EC2 инстанции, они будут автоматически

00:11:15.120 --> 00:11:16.120
отключаться.

00:11:16.120 --> 00:11:22.800
Итак, первым делом нам необходимо создать Launch Configuration.

00:11:22.800 --> 00:11:26.040
Для этого в левом навигационном меню необходимо выбрать

00:11:26.040 --> 00:11:28.280
опцию Launch Configuration.

00:11:28.280 --> 00:11:30.880
На подкроющейся странице нажать на кнопку Create Launch

00:11:30.880 --> 00:11:36.520
Configuration и начать вводить данные по этому IT ресурсу.

00:11:36.520 --> 00:11:39.800
Как имя укажем Launch Lab Config.

00:11:39.800 --> 00:11:44.600
Далее, как EMI, выберем ранее созданный нами EMI, это Web

00:11:44.600 --> 00:11:46.240
Server EMI.

00:11:46.240 --> 00:11:49.960
Как instance type выберем T3-micro.

00:11:49.960 --> 00:11:54.040
Если же эта опция недоступна, то мы можем выбрать T2-micro.

00:11:54.040 --> 00:12:04.800
В следующей секции Additional Configuration и под секцией Monitoring

00:12:04.800 --> 00:12:09.080
необходимо поставить галочку возле Enable EC2 instance detailed

00:12:09.080 --> 00:12:10.960
monitoring within CloudWatch.

00:12:10.960 --> 00:12:16.680
Это для того, чтобы Autoscaling быстрее реагировал на изменение

00:12:16.680 --> 00:12:19.800
нагрузки на наши инстанции.

00:12:19.800 --> 00:12:22.000
Следующая секция это Security группы.

00:12:22.000 --> 00:12:27.440
Здесь нам необходимо выбрать опцию Select an existing security

00:12:27.440 --> 00:12:31.000
group, то есть уже ранее созданный Security группу и в выпадающем

00:12:31.000 --> 00:12:34.920
меню выбрать Web Security Group.

00:12:34.920 --> 00:12:36.360
Двигаемся дальше.

00:12:36.360 --> 00:12:42.240
Секция Key Pair это тот приватный ключ, который позволяет

00:12:42.240 --> 00:12:47.400
нам по SSH подключаться к нашим EC2-инстанциям.

00:12:47.400 --> 00:12:50.820
Здесь нам необходимо выбрать опцию Choose an existing key pair

00:12:50.820 --> 00:12:55.160
и в выпадающем списке выбрать Key Pair в OK.

00:12:55.160 --> 00:12:58.400
Также поставить галочку о том, что вы подтверждаете

00:12:58.400 --> 00:13:03.080
привязку этого ключа к создаваемым EC2-инстанциям и нажать на

00:13:03.080 --> 00:13:09.080
кнопку Create Launch Configuration.

00:13:09.080 --> 00:13:12.040
Как только мы завершили создание Launch Configuration,

00:13:12.040 --> 00:13:14.920
мы на базе Neo можем создать Autoscaling группу.

00:13:14.920 --> 00:13:18.080
Здесь вам необходимо проверить, что вы находитесь в нужном

00:13:18.080 --> 00:13:22.320
регионе, нужный регион это Норрс-Верженье либо US East

00:13:22.320 --> 00:13:23.320
One.

00:13:23.320 --> 00:13:27.960
Нам необходимо выбрать Lab Config из списка и нажать

00:13:27.960 --> 00:13:32.240
на кнопку Actions в выпадающем меню выбрать опцию Create

00:13:32.240 --> 00:13:34.000
Autoscaling Group.

00:13:34.000 --> 00:13:36.640
Как только вы на нее нажмете, вас перенаправит на страницу

00:13:36.640 --> 00:13:39.200
создания Autoscaling группы.

00:13:39.200 --> 00:13:43.800
На этой странице в поле Name введем Lab Autoscaling Group,

00:13:43.800 --> 00:13:45.920
нажмем на кнопку Next.

00:13:45.920 --> 00:13:48.240
Далее в настройках сети нам необходимо выбрать

00:13:48.240 --> 00:13:51.720
VPC, в нашем случае это Lab VPC.

00:13:51.720 --> 00:13:55.720
Здесь если вы увидите сообщение No public IP-адрес, то можете

00:13:55.720 --> 00:13:58.840
игнорировать это сообщение.

00:13:58.840 --> 00:14:03.880
Чуть ниже, там где необходимо выбрать сабнеты, нам необходимо

00:14:03.880 --> 00:14:07.440
выбрать Private Subnet 1 и Private Subnet 2.

00:14:07.440 --> 00:14:10.040
Почему Private Subnet не Public Subnet?

00:14:10.040 --> 00:14:13.520
Это связано с тем, что ранее у нас был один-единственный

00:14:13.520 --> 00:14:21.160
EC2-инстанс, который не увеличивался в размерах, не в количестве

00:14:21.160 --> 00:14:23.960
и это был статичный инстанс.

00:14:23.960 --> 00:14:28.160
В случае увеличения нагрузки, инстанс бы не выдержал

00:14:28.160 --> 00:14:30.520
эту нагрузку и отключался бы.

00:14:30.520 --> 00:14:35.520
Сейчас мы добавляем возможность динамического изменения

00:14:35.520 --> 00:14:38.800
наших вычислительных мощностей в зависимости от нагрузки

00:14:38.800 --> 00:14:44.720
и в этом случае ресурсом, который будет принимать

00:14:44.720 --> 00:14:49.160
трафик будет Load Balancer и Autoscale группа.

00:14:49.160 --> 00:14:53.640
То есть они уже будут находиться в Public Subnet.

00:14:53.640 --> 00:14:58.640
Таким образом для большей безопасности все наши инстанции

00:14:58.640 --> 00:15:06.520
под Load Balancer мы можем расположить в Private Subnet.

00:15:06.520 --> 00:15:11.400
После того, как мы выберем Subnet необходимо нажать

00:15:11.400 --> 00:15:18.640
на кнопку Next и в открывшейся странице там, где Load Balancing

00:15:18.640 --> 00:15:23.120
Option необходимо выбрать Attach to an Existing Load Balancer.

00:15:23.120 --> 00:15:27.040
Как только мы на нее нажмем появится выпадающее меню,

00:15:27.040 --> 00:15:28.800
необходимо выбрать Lab Group.

00:15:28.800 --> 00:15:35.960
В секции Additional Settings необходимо выбрать опцию и поставить

00:15:35.960 --> 00:15:39.760
галочку Enable Group Metrics Collection within CloudWatch.

00:15:39.760 --> 00:15:45.560
Это нужно для того, чтобы метрики снимались каждую

00:15:45.560 --> 00:15:49.640
минуту, а это в свою очередь позволит быстрее реагировать

00:15:49.640 --> 00:15:52.480
нашей Autoscale группе.

00:15:52.480 --> 00:15:53.920
Нажмем на кнопку Next.

00:15:53.920 --> 00:15:57.520
Здесь нам необходимо будет выбрать размеры нашей группы.

00:15:57.520 --> 00:16:02.400
Есть три параметра, это Desired Capacity, Minimum Capacity и Maximum

00:16:02.400 --> 00:16:03.400
Capacity.

00:16:03.400 --> 00:16:07.080
Desired Capacity это то количество таргетов, которое будет

00:16:07.080 --> 00:16:10.720
создано в самом начале создания автоскейлинг группы.

00:16:10.720 --> 00:16:15.400
Minimum и Maximum Capacity соответственно это минимальное и максимальное

00:16:15.400 --> 00:16:19.720
количество таргетов, которые может создавать автоскейлинг

00:16:19.720 --> 00:16:20.720
группа.

00:16:20.720 --> 00:16:26.120
И здесь такой момент, нужно понимать какое правильное

00:16:26.120 --> 00:16:31.760
значение выставить для минимума и в частности для максимума,

00:16:31.760 --> 00:16:36.560
чтобы не израсходовать средства компании слишком много,

00:16:36.560 --> 00:16:40.160
но при этом обработать максимально возможное количество

00:16:40.160 --> 00:16:42.200
запросов от ваших пользователей.

00:16:42.200 --> 00:16:47.500
Представим, что вы указали Maximum Capacity 6 и нагрузка

00:16:47.500 --> 00:16:53.440
она внезапно увеличилась и даже 6 инстенсов не смогли

00:16:53.440 --> 00:16:57.480
обработать запросы всех ваших пользователей.

00:16:57.480 --> 00:17:01.280
В этом случае вам рекомендуется настроить дополнительные

00:17:01.280 --> 00:17:09.400
уведомления о том, что 6 инстенсов недостаточно

00:17:09.400 --> 00:17:13.260
для обработки текущей нагрузки, поэтому необходимо подключиться

00:17:13.260 --> 00:17:15.320
и вручную поменять это значение.

00:17:15.320 --> 00:17:19.760
Либо изначально получить добро от руководства о

00:17:19.760 --> 00:17:23.760
том, что при увеличении нагрузки мы в приоритет

00:17:23.760 --> 00:17:27.320
ставим обслуживание всех запросов от пользователей,

00:17:27.320 --> 00:17:31.320
при этом количество инстанцев может быть увеличено до

00:17:31.320 --> 00:17:33.360
10-20 инстанцев.

00:17:33.360 --> 00:17:36.040
Это будет стоить дороже, но вы получите гарантию

00:17:36.040 --> 00:17:40.120
того, что все ваши пользователи будут соответствующие

00:17:40.120 --> 00:17:42.840
обработаны вашим приложением.

00:17:42.840 --> 00:17:43.840
Двигаемся дальше.

00:17:43.840 --> 00:17:50.520
В секции Scaling Policies нам необходимо выбрать Target Tracking

00:17:50.520 --> 00:17:53.920
Scaling Policy и его настроить.

00:17:53.920 --> 00:17:59.160
Как Lab Policy Name укажем Lab Scaling Policy, как Metric Type выберем

00:17:59.160 --> 00:18:02.800
Average CPU Utilization, то есть мы будем смотреть на нагрузку

00:18:02.800 --> 00:18:04.160
на наши процессоры.

00:18:04.160 --> 00:18:06.640
И как Target Value укажем 60.

00:18:06.640 --> 00:18:10.280
Когда мы указываем 60, это говорит о том, что автоскейлинг

00:18:10.280 --> 00:18:14.440
будет стремиться к тому, чтобы нагрузка на все наши

00:18:14.440 --> 00:18:18.280
таргеты была в районе 60%.

00:18:18.280 --> 00:18:22.880
Если оно увеличивается, это говорит о том, что нагрузка

00:18:22.880 --> 00:18:26.160
поднялась и нам необходимо добавить дополнительные

00:18:26.160 --> 00:18:27.160
таргеты.

00:18:27.160 --> 00:18:32.040
Если же нагрузка упала порядка 40 либо ниже процентов,

00:18:32.040 --> 00:18:36.560
то в этом случае автоскейлинг группа понимает, что текущие

00:18:36.560 --> 00:18:39.400
таргеты с легкостью справляются с нагрузкой и оно может

00:18:39.400 --> 00:18:44.160
один или несколько таргетов удалить.

00:18:44.160 --> 00:18:47.960
Мы переходим к заключительной части этого задания.

00:18:47.960 --> 00:18:51.120
Нам необходимо нажать на кнопку Next.

00:18:51.120 --> 00:18:53.560
Здесь нам необходимо указать теги.

00:18:53.560 --> 00:18:56.680
Давайте добавим один тег, как ключ укажем Name и как

00:18:56.680 --> 00:18:59.920
значение укажем LabInstance.

00:18:59.920 --> 00:19:04.680
Нажмем на кнопку Next и на этом откроется страница,

00:19:04.680 --> 00:19:07.600
где мы можем пересмотреть все введенные нами настройки.

00:19:07.600 --> 00:19:11.020
Если все указано верно, мы можем нажать в самом

00:19:11.020 --> 00:19:15.440
низу на кнопку Create Autoscaling Group.

00:19:15.440 --> 00:19:19.960
Если же вы получите ошибку Fail to Create Autoscaling Group, необходимо

00:19:19.960 --> 00:19:24.200
нажать на появившуюся кнопку Retry Failure Tasks, после чего

00:19:24.200 --> 00:19:27.220
автоскейлинг группа должна быть успешно создана.

00:19:27.220 --> 00:19:30.000
Обратите внимание, что в самом начале количество

00:19:30.000 --> 00:19:37.980
инстенсов будет равно нулю и со временем будут подниматься

00:19:37.980 --> 00:19:41.600
новые инстенсы в количестве равном Desired Capacity.

00:19:41.600 --> 00:19:45.680
То есть в итоге у нас будет два инстенса поднятых

00:19:45.680 --> 00:19:48.880
и готовых к работе.

00:19:48.880 --> 00:19:51.940
Мы переходим к четвертому заданию и здесь мы будем

00:19:51.940 --> 00:19:55.840
проверять, что связка всех IT ресурсов, созданных нами

00:19:55.840 --> 00:19:57.680
ранее, работает корректно.

00:19:57.680 --> 00:20:01.960
Самым первым делом нам необходимо перейти в левом

00:20:01.960 --> 00:20:04.680
навигационном меню, в пункт Instances.

00:20:04.680 --> 00:20:07.640
Здесь вы увидите, что появятся дополнительные два новых

00:20:07.640 --> 00:20:10.880
инстенса с названием LabInstance.

00:20:10.880 --> 00:20:13.200
Почему LabInstance?

00:20:13.200 --> 00:20:17.980
При создании автоскейлинг группы мы давали ей tag Name

00:20:17.980 --> 00:20:19.640
со значением LabInstance.

00:20:19.640 --> 00:20:24.960
Таким образом автоскейлинг группа для всех созданных

00:20:24.960 --> 00:20:29.600
от себя инстенцев передала свои теги.

00:20:29.600 --> 00:20:33.360
Здесь необходимо дождаться, что хеллс чеки для этих

00:20:33.360 --> 00:20:36.720
двух LabInstance будут пройдены.

00:20:36.720 --> 00:20:40.160
Как только это будет готово, вы можете в левом навигационном

00:20:40.160 --> 00:20:45.520
меню переходить к следующей вкладке, это Target Groups.

00:20:45.520 --> 00:20:48.200
Вы увидите, что в списке есть одна единственная

00:20:48.200 --> 00:20:49.880
target группа, это LabGroup.

00:20:49.880 --> 00:20:55.120
Давайте на нее нажмем и в вкладке Target, Targets вы увидите

00:20:55.120 --> 00:20:59.800
наши два инстенса.

00:20:59.800 --> 00:21:04.080
Здесь нам необходимо дождаться, что статус обоих инстенцев

00:21:04.080 --> 00:21:06.160
перейдет в состояние Healthy.

00:21:06.160 --> 00:21:08.560
Для этого время от времени вы можете нажимать на кнопку

00:21:08.560 --> 00:21:12.120
Refresh.

00:21:12.120 --> 00:21:14.800
Как только они перейдут в состояние Healthy, это говорит

00:21:14.800 --> 00:21:24.640
о том, что они сейчас доступны для приема запросов от

00:21:24.640 --> 00:21:28.200
LoadBalancer и, соответственно, LoadBalancer готов направлять

00:21:28.200 --> 00:21:32.720
трафик на эти таргеты.

00:21:32.720 --> 00:21:35.200
Теперь давайте посмотрим все ли нормально с точки

00:21:35.200 --> 00:21:42.200
зрения автоскейлинг группы и LoadBalancer.

00:21:42.200 --> 00:21:44.760
Нам необходимо в левом и вигационном меню нажать

00:21:44.760 --> 00:21:53.280
на LoadBalancer и в нижней части скопировать DNS Name, созданного

00:21:53.280 --> 00:22:00.280
нами LoadBalancer.

00:22:00.280 --> 00:22:03.580
Как только вы ее скопируете, вы можете ее вставить в

00:22:03.580 --> 00:22:07.200
новую вкладку в вашем веб-браузере и открыть эту страницу.

00:22:07.200 --> 00:22:10.560
Откроется подготовленная специально для этой лабораторной

00:22:10.560 --> 00:22:20.680
работы простое приложение и вы увидите какой-то ответ.

00:22:20.680 --> 00:22:26.000
Это говорит о том, что мы отправили запрос LoadBalancer,

00:22:26.000 --> 00:22:28.840
LoadBalancer направил трафик на инстанции, созданные

00:22:28.840 --> 00:22:32.400
автоскейлинг группы, инстанс обработал этот запрос и

00:22:32.400 --> 00:22:34.120
вернул какой-то ответ.

00:22:34.120 --> 00:22:38.160
Этот ответ вы видите в виде вашей страницы, на

00:22:38.160 --> 00:22:41.240
котором отображается приложение.

00:22:41.240 --> 00:22:46.920
Таким образом мы подтвердили для себя, что связка автоскейлинг

00:22:46.920 --> 00:22:51.160
группа и LoadBalancer работает корректно.

00:22:51.160 --> 00:22:56.720
Теперь мы переходим к последнему заданию, это тестирование

00:22:56.720 --> 00:22:58.160
нашего автоскейлинга.

00:22:58.160 --> 00:23:01.640
То есть нам необходимо проверить, что при увеличении

00:23:01.640 --> 00:23:04.980
нагрузки на наши инстанции, автоскейлинг автоматически

00:23:04.980 --> 00:23:09.480
добавляет новые инстанции, чтобы эту нагрузку распределить

00:23:09.480 --> 00:23:14.520
по большему количеству таргетов.

00:23:14.520 --> 00:23:17.440
Для этого нам необходимо перейти на другой сервис,

00:23:17.440 --> 00:23:19.520
это CloudWatch.

00:23:19.520 --> 00:23:22.720
Давайте в строке поиска сервисов начнем вводить

00:23:22.720 --> 00:23:29.920
CloudWatch, либо можете начать вводить Watch, она в принципе

00:23:29.920 --> 00:23:31.560
работает полнотекстовый поиск.

00:23:31.560 --> 00:23:37.560
Поэтому любое сочетание символов она будет искать

00:23:37.560 --> 00:23:38.560
в названии сервиса.

00:23:38.560 --> 00:23:50.040
Как только вы переходите на страницу сервиса CloudWatch

00:23:50.040 --> 00:23:53.040
в левом навигационном меню, вам необходимо выбрать

00:23:53.040 --> 00:23:55.520
опцию All Alarms.

00:23:55.520 --> 00:23:58.640
Вам должны быть отображены два аларма, обе они были

00:23:58.640 --> 00:24:03.480
автоматически созданы автоскейлинг группой.

00:24:03.480 --> 00:24:07.640
Эти два аларма по очереди тригерят автоскейлинг

00:24:07.640 --> 00:24:11.520
группу в зависимости от нагрузки на ваши инстанции,

00:24:11.520 --> 00:24:17.080
что в свою очередь иницирует удаление или создание новых

00:24:17.080 --> 00:24:20.400
инстанцев в автоскейлинг группе.

00:24:20.400 --> 00:24:24.600
Если же эти алармы не отображаются, обратите внимание, сидите

00:24:24.600 --> 00:24:26.920
ли вы в корректном регионе.

00:24:26.920 --> 00:24:31.800
Нам нужен регион Нож свержения либо US East 1.

00:24:31.800 --> 00:24:35.000
Если же вы сидите в правильном регионе, тем не менее эти

00:24:35.000 --> 00:24:38.880
алармы не отображаются, нам необходимо проделать

00:24:38.880 --> 00:24:41.300
некоторые действия.

00:24:41.300 --> 00:24:45.160
Эти действия необходимо производить только в временно

00:24:45.160 --> 00:24:46.760
созданном AWS аккаунте.

00:24:46.760 --> 00:24:49.920
В реальном AWS аккаунте подобных проблем не будет.

00:24:49.920 --> 00:24:53.280
Итак, если аларм не отображается, вам необходимо перейти

00:24:53.280 --> 00:24:56.680
в сервис EC2, далее в левом навигационном меню выбрать

00:24:56.680 --> 00:25:00.960
опцию Auto Scaling Groups, выбрать автоскейлинг группу, созданную

00:25:00.960 --> 00:25:04.840
ранее нами, называется Lab Auto Scaling Group.

00:25:04.840 --> 00:25:07.560
Далее, как только мы ее выберем, в нижней части

00:25:07.560 --> 00:25:09.660
экрана отобразятся несколько вкладок.

00:25:09.660 --> 00:25:14.960
Нам необходимо открыть вкладку Automatic Scaling.

00:25:14.960 --> 00:25:20.520
Необходимо там в списке выбрать Lab Scaling Policy, нажать

00:25:20.520 --> 00:25:26.000
на кнопку Actions и в выпадающем меню выбрать опцию Edit.

00:25:26.000 --> 00:25:28.760
Сбивается всплывающее окно и как target value необходимо

00:25:28.760 --> 00:25:31.440
указать 50 и нажать на кнопку Update.

00:25:31.440 --> 00:25:36.480
Это инициирует повторное создание подресурсов автоскейлинг

00:25:36.480 --> 00:25:44.040
группы и после этого обновления вы в CloudWatch сервисе можете

00:25:44.040 --> 00:25:50.040
увидеть, что эти алармы появились.

00:25:50.040 --> 00:25:52.360
Обратите внимание, что эти алармы появляются не

00:25:52.360 --> 00:25:55.980
сразу и вам необходимо как минимум 1-2 минуты подождать

00:25:55.980 --> 00:26:06.400
после чего обновить страницу.

00:26:06.400 --> 00:26:11.520
Как только наши алармы появились, нам необходимо

00:26:11.520 --> 00:26:17.520
выбрать аларм с названием Alarm High в названии.

00:26:17.520 --> 00:26:20.840
Мы видим, что ее состояние OK.

00:26:20.840 --> 00:26:26.080
Если же отображается не OK, то необходимо подождать

00:26:26.080 --> 00:26:29.120
некоторое время и нажать на кнопку Refresh.

00:26:29.120 --> 00:26:31.640
Оно должно вернуться в состояние OK.

00:26:31.640 --> 00:26:38.720
OK означает то, что нагрузка на наши инстанции на CPU

00:26:38.720 --> 00:26:41.440
меньше 60%.

00:26:41.440 --> 00:26:45.440
Как только оно увеличивается и становится больше 60%, то

00:26:45.440 --> 00:26:48.600
этот аларм из состояния OK переходит в состояние

00:26:48.600 --> 00:26:54.080
Alarm и отправляет соответствующую информацию автоскейлинг

00:26:54.080 --> 00:26:55.080
группе.

00:26:55.080 --> 00:27:01.640
Сейчас нам необходимо протестировать, что действительно автоскейлинг

00:27:01.640 --> 00:27:02.640
группа работает.

00:27:02.640 --> 00:27:05.760
Для этого нам необходимо вернуться в наше приложение,

00:27:05.760 --> 00:27:10.520
открытое ранее в веб-браузере в отдельной вкладке и нажать

00:27:10.520 --> 00:27:12.640
на кнопку Load Test.

00:27:12.640 --> 00:27:17.320
Как только вы на нее нажмете, то запустятся скрипты,

00:27:17.320 --> 00:27:22.880
которые дадут нагрузку на наши инстанции.

00:27:22.880 --> 00:27:25.720
Обратите внимание, что эту страницу закрывать нельзя.

00:27:25.720 --> 00:27:29.940
Если вы закроете эту страницу, то нагрузка прекратится.

00:27:29.940 --> 00:27:34.680
Нам необходимо подождать некоторое время, чтобы

00:27:34.680 --> 00:27:39.600
метрики передались в AWS и соответствующие ресурсы

00:27:39.600 --> 00:27:40.960
были уведомлены.

00:27:40.960 --> 00:27:50.680
Вы можете периодически нажимать на кнопку Refresh

00:27:50.680 --> 00:27:57.000
и вы увидите, что меньше чем за 5 минут, аларм Low,

00:27:57.000 --> 00:28:03.320
он должен поменять свое значение на OK, аларм High,

00:28:03.320 --> 00:28:06.680
наоборот должен поменять свое состояние на In Alarm.

00:28:06.680 --> 00:28:09.160
То есть говорит о том, что сейчас большая нагрузка

00:28:09.160 --> 00:28:13.320
на наши инстанции.

00:28:13.320 --> 00:28:18.520
Также если вы откроете соответствующий аларм, в нашем случае Alarm High,

00:28:18.520 --> 00:28:23.880
то вы увидите увеличивающуюся нагрузку на CPU в виде графика.

00:28:23.880 --> 00:28:28.560
Как только оно переходит 60% либо 50%, если мы пересоздавали

00:28:28.560 --> 00:28:35.080
наши алармы и это длится больше чем 3 минуты, то

00:28:35.080 --> 00:28:39.320
оно триггернет авто скейлинг группу, а оно в свою очередь

00:28:39.320 --> 00:28:42.200
добавит новые инстанции.

00:28:42.200 --> 00:28:46.280
Нам необходимо дождаться, пока аларм High перейдет

00:28:46.280 --> 00:28:48.080
состояние In Alarm.

00:28:48.080 --> 00:28:52.080
Как только оно туда перейдет, вы можете перейти в сервис

00:28:52.080 --> 00:28:57.880
EC2, открыть в левом навигационном меню опцию Instances и убедиться,

00:28:57.880 --> 00:29:02.760
что сейчас у нас количество инстанцев с названием Lab

00:29:02.760 --> 00:29:05.280
High больше двух, три либо четыре.

00:29:05.280 --> 00:29:10.200
Это говорит о том, что авто скейлинг верно работает и для того,

00:29:10.200 --> 00:29:13.160
чтобы распределить нагрузку, оно создало дополнительные

00:29:13.160 --> 00:29:14.160
инстанции.

00:29:14.160 --> 00:29:22.000
Как только вы в этом убедитесь, вы можете закрывать страницу

00:29:22.000 --> 00:29:25.560
с приложением для того, чтобы нагрузка вернулась

00:29:25.560 --> 00:29:28.000
в обычное состояние.

00:29:28.000 --> 00:29:34.800
Также вы можете подождать как минимум пять минут для

00:29:34.800 --> 00:29:40.760
того, чтобы количество инстанцев из трех и четырех вернулось

00:29:40.760 --> 00:29:42.640
обратно к минимальному значению два.

00:29:42.640 --> 00:29:48.200
И как только вы доберете до этого состояния, я хочу

00:29:48.200 --> 00:29:51.400
от себя предложить провести дополнительный эксперимент.

00:29:51.400 --> 00:29:55.200
Вам необходимо в сервисе EC2, в левом навигационном

00:29:55.200 --> 00:29:59.920
меню Instances, выбрать один из инстанцев с названием

00:29:59.920 --> 00:30:04.780
Lab Instance и через кнопку Actions этот инстанс terminating, то

00:30:04.780 --> 00:30:05.920
есть отключить.

00:30:05.920 --> 00:30:14.200
Как только вы ее отключите, вы увидите в Load Balancer, что

00:30:14.200 --> 00:30:19.320
один из таргетов стал unhealthy и после чего трафик перестает

00:30:19.320 --> 00:30:21.840
направляться на этот инстанс.

00:30:21.840 --> 00:30:25.800
Автоскейлинг соответственно видит, что количество инстанцев

00:30:25.800 --> 00:30:30.200
стало меньше, чем минимальное значение и иницирует создание

00:30:30.200 --> 00:30:31.320
нового инстанца.

00:30:31.320 --> 00:30:34.160
Через некоторое время вы увидите, что был создан

00:30:34.160 --> 00:30:38.400
еще один дополнительный инстанс и будет отображено

00:30:38.400 --> 00:30:41.500
два инстанца.

00:30:41.500 --> 00:30:44.640
Мы переходим к последнему заданию.

00:30:44.640 --> 00:30:49.280
Мы в самом начале создавали AMI от инстанца с названием

00:30:49.280 --> 00:30:51.280
Web Server One.

00:30:51.280 --> 00:30:55.240
Вы видите, что этот сервер нам уже не нужен, так как

00:30:55.240 --> 00:31:00.080
сейчас трафик он направляется не на этот веб-сервер, а

00:31:00.080 --> 00:31:01.440
на Load Balancer.

00:31:01.440 --> 00:31:04.120
Таким образом мы можем этот сервер удалять.

00:31:04.120 --> 00:31:06.800
Для этого необходимо в списке инстанцев выбрать

00:31:06.800 --> 00:31:12.600
Web Server One, далее нажать на кнопку Instance State и выбрать

00:31:12.600 --> 00:31:15.000
опцию Terminate Instance.

00:31:15.000 --> 00:31:17.560
Также в всплывающем меню необходимо подтвердить

00:31:17.560 --> 00:31:23.120
о том, что мы отключаем этот инстанс.

00:31:23.120 --> 00:31:28.040
На этом мы добрались до конца нашей лаборатурной

00:31:28.040 --> 00:31:29.040
работы.

00:31:29.040 --> 00:31:32.440
Я вам напоминаю, что вам необходимо корректно отключить

00:31:32.440 --> 00:31:38.080
разлагиниться из временного AWS аккаунта.

00:31:38.080 --> 00:31:44.480
Также вам необходимо в AWS Academy на странице лаборатурной

00:31:44.480 --> 00:31:47.520
работы нажать на кнопку End Lab, подтвердить и дождаться

00:31:47.520 --> 00:31:53.120
сообщения о том, что delete has been initiated, you may close this

00:31:53.120 --> 00:31:56.600
message box now, что говорит о том, что процесс удаления

00:31:56.600 --> 00:32:00.600
всех созданных ресурсов и аккаунтов он инициирован,

00:32:00.600 --> 00:32:03.320
и вы можете закрывать это окно.

00:32:03.320 --> 00:32:05.800
Вы закрываете это всплывающее окно, также можете закрывать

00:32:05.800 --> 00:32:10.120
вкладку AWS Academy, и на этом вы успешно завершили лаборатурную

00:32:10.120 --> 00:32:11.120
работу.

00:32:11.120 --> 00:32:14.440
Еще раз хотел бы вас поздравить завершением лаборатурной

00:32:14.440 --> 00:32:15.440
работы.

00:32:15.440 --> 00:32:21.920
Я очень надеюсь, что многие вопросы были отвечены, вы

00:32:21.920 --> 00:32:28.200
получили более полное представление о сервисах ELB и автоскейлинг.

00:32:28.200 --> 00:32:30.640
Если будут вопросы, то задавайте.

00:32:30.640 --> 00:32:45.000
Мы с вами увидимся на следующих наших активностях.