WEBVTT

00:00:00.000 --> 00:00:06.680
Добрый день, уважаемые студенты! Я рад 
вас всех видеть на очередной сессии обзора

00:00:06.680 --> 00:00:12.640
лабораторной работы. Тема сегодняшней 
лабораторной работы — это Scale & Load Balance

00:00:12.640 --> 00:00:17.160
your Architecture.
Итак, давайте начнем.

00:00:17.160 --> 00:00:23.740
Самым первым делом, нам 
необходимо в AWS Academy открыть

00:00:23.740 --> 00:00:27.240
соответствующий курс Cloud 
Foundations, далее в левом

00:00:27.240 --> 00:00:34.520
навигационном меню перейти в Modules. На 
открывшейся странице спозиционируется на 

00:00:34.520 --> 00:00:38.480
Module 10 – Auto Scaling and 
Monitoring, и вы увидите активность

00:00:38.480 --> 00:00:42.000
Lab 6 – Scale & Load 
Balance your Architecture.

00:00:42.000 --> 00:00:47.000
Давайте на нее нажмем, чтобы перейти 
на основную страницу лабораторной работы.

00:00:47.000 --> 00:00:55.720
Здесь мы можем скрыть 
окно Terminal, убрав галочку

00:00:55.720 --> 00:00:59.040
соответствующего пункта и 
оставить только README,

00:00:59.040 --> 00:01:07.560
для того чтобы удобнее было читать 
задание нашей лабораторной работы.

00:01:07.560 --> 00:01:11.080
Также вы можете параллельно 
нажать на кнопку Start Lab,

00:01:11.080 --> 00:01:16.600
для того чтобы начать инициирование 
временного AWS аккаунта для вашей сессии.

00:01:16.600 --> 00:01:23.880
В этой лабораторной работе 
мы подробнее изучим сервисы

00:01:23.880 --> 00:01:32.640
Elastic Load Balancing – ELB и Auto Scaling. 
ELB мы используем для того, чтобы балансировать

00:01:32.640 --> 00:01:37.060
трафик на наши таргеты, а Auto Scaling 
используем для того, чтобы

00:01:37.060 --> 00:01:41.480
динамически увеличивать либо 
уменьшать наши IT-ресурсы.

00:01:41.480 --> 00:01:44.900
Самый частый сервис, 
который используется в связке

00:01:44.900 --> 00:01:48.880
с ACG, т.е. Auto Scaling Group – 
это Amazon EC2 инстансы.

00:01:48.880 --> 00:02:00.640
Что мы сегодня будем с вами делать? Первое, мы 
создадим копию AMI уже работающего инстанса.

00:02:00.640 --> 00:02:04.520
Далее мы создадим load balancer, 
сконфигурируем и запустим

00:02:04.520 --> 00:02:09.000
Auto Scaling group, а также посмотрим, 
как все эти сервисы работают в связке,

00:02:09.000 --> 00:02:18.680
как происходит Auto Scaling, и мы можем также
увидеть эти изменения в alarms и промониторить

00:02:18.680 --> 00:02:28.240
этот процесс в Amazon CloudWatch. Для выполнения 
этой лабораторной работы рекомендуется потратить

00:02:28.240 --> 00:02:32.080
30 минут. Я напоминаю, что если 
вам нужно больше времени, то

00:02:32.080 --> 00:02:41.560
вы всегда можете обнулить счетчик и 
продолжить выполнение лабораторной работы.

00:02:41.560 --> 00:02:45.200
До начала нашей лабораторной 
работы мы видим, что текущая

00:02:45.200 --> 00:02:49.480
архитектура внутри AWS 
имеет следующий вид.

00:02:49.480 --> 00:02:53.280
Что будет сделано в рамках 
этой лабораторной работы

00:02:53.280 --> 00:03:00.160
это: мы создадим Load Balancer, 
перенесем наш Web Instance,

00:03:00.160 --> 00:03:04.000
который находился в Public Subnet 2, 
сверху справа, на Private Subnet

00:03:04.000 --> 00:03:09.000
и настроим связку Load 
Balancer и Auto Scaling.

00:03:09.000 --> 00:03:12.080
Таким образом у нас будут 
создаваться инстансы по

00:03:12.080 --> 00:03:24.520
необходимости в обеих Availability Zones, 
т.е. Availability Zone A и Availability Zone B.

00:03:24.520 --> 00:03:27.040
Самым первым делом для того, 
чтобы начать выполнение

00:03:27.040 --> 00:03:31.960
лабораторной работы, нам нужно 
добраться до AWS Management Console.

00:03:31.960 --> 00:03:34.320
Для этого, если вы еще не сделали,
вам необходимо нажать на

00:03:34.320 --> 00:03:42.680
кнопку Start Lab, вверху справа. Как только вы 
на нее нажмете, появится всплывающее окошко,

00:03:42.680 --> 00:03:49.120
в котором будет указан статус лабораторной 
работы, т.е. "Lab Status: in creation".

00:03:49.120 --> 00:03:52.240
Как только поменяется статус 
на Ready, вы можете закрывать

00:03:52.240 --> 00:03:55.800
это окно и далее вам необходимо 
будет нажать на кнопку AWS,

00:03:55.800 --> 00:04:00.520
чтобы перейти на созданный 
для вашей сессии лабораторной

00:04:00.520 --> 00:04:11.000
работы временный AWS Account. Как только вы 
добрались до AWS Management Console, мы можем

00:04:11.000 --> 00:04:16.960
переходить к выполнению первого задания.
Здесь нам необходимо создать копию AMI.

00:04:16.960 --> 00:04:23.520
Этот AMI будет использоваться для создания 
новых инстансов под Auto Scaling group.

00:04:23.520 --> 00:04:27.920
Для этого нам необходимо 
в строке поиска сервисов

00:04:27.920 --> 00:04:32.780
начать вводить EC2, либо нажать на 
кнопку Services и в выпадающем

00:04:32.780 --> 00:04:38.080
меню найти сервис EC2. Как только 
мы перейдем, в левом навигационном меню,

00:04:38.080 --> 00:04:41.240
нам необходимо выбрать 
Instances и отобразиться список

00:04:41.240 --> 00:04:46.880
всех инстансов в нашем AWS
Account в конкретном регионе.

00:04:46.880 --> 00:04:52.040
Если вы не видите инстансы, 
то проверьте, что у вас стоит

00:04:52.040 --> 00:05:06.640
регион North Virginia или us-east-1. Вы должны 
увидеть инстанс с названием Web Server 1.

00:05:06.640 --> 00:05:11.040
Необходимо проверить, что в 
колонке Status Checks стоит 2/2,

00:05:11.040 --> 00:05:15.320
что говорит о том, что сервер был 
успешно создан и готов к работе.

00:05:15.320 --> 00:05:20.840
Как только вы это увидите, 
необходимо выбрать этот инстанс.

00:05:20.840 --> 00:05:25.160
Далее в пункте меню Actions 
выбрать опцию Image and Templates.

00:05:25.160 --> 00:05:31.340
Далее нажать на опцию Create Image. В 
открывшейся странице нам необходимо указать

00:05:31.340 --> 00:05:40.000
как Image name: WebServerAMI. Далее как Image 
description указать Lab AMI for Web Server и 

00:05:40.000 --> 00:05:42.600
в самом внизу нажать 
на кнопку Create Image.

00:05:42.600 --> 00:05:49.520
Вы увидите новый созданный 
AMI и его соответствующий ID.

00:05:49.520 --> 00:05:52.800
Вам необходимо этот ID скопировать, 
так как мы ее будем использовать

00:05:52.800 --> 00:06:00.000
чуть позднее в следующем задании. Мы переходим 
ко второму заданию и здесь нам необходимо

00:06:00.000 --> 00:06:06.200
создать Load Balancer. Я напоминаю, что 
Load Balancer — это тот IT-ресурс, который

00:06:06.200 --> 00:06:11.280
помогает нам балансировать нагрузку 
на наши вычислительные мощности.

00:06:11.280 --> 00:06:14.720
В нашем случае - это Amazon EC2 Instances 
и мы настроим Load Balancer таким

00:06:14.720 --> 00:06:21.200
образом, чтобы оно балансировало 
трафик на несколько Availability Zones.

00:06:21.200 --> 00:06:25.120
Самым первым делом, нам 
необходимо создать Target Groups,

00:06:25.120 --> 00:06:34.760
т.е. это те ресурсы, которые показывают куда
будет направляться трафик от Load Balancer.

00:06:34.760 --> 00:06:41.160
Необходимо в левом навигационном 
меню выбрать Target Groups.

00:06:41.160 --> 00:06:49.120
Далее в открывшейся странице 
нажать на кнопку Create target group.

00:06:49.120 --> 00:06:52.720
Как target type нам необходимо 
выбрать Instances, как Target

00:06:52.720 --> 00:06:57.920
group name давайте укажем LabGroup, 
и также нам необходимо указать VPC.

00:06:57.920 --> 00:07:03.120
В выпадающем меню 
давайте выберем Lab VPC.

00:07:03.120 --> 00:07:12.440
Далее нам необходимо нажать на кнопку 
Next и вы увидите секцию Register targets.

00:07:12.440 --> 00:07:15.440
На текущий момент у нас 
не созданы наши targets,

00:07:15.440 --> 00:07:22.080
поэтому мы можем пропустить этот шаг 
и нажать на кнопку Create target group.

00:07:22.080 --> 00:07:26.920
Теперь мы переходим непосредственно 
к созданию Load Balancer.

00:07:26.920 --> 00:07:31.120
Для этого в левом навигационном меню 
необходимо выбрать Load Balancers.

00:07:31.120 --> 00:07:34.360
В открывшейся странице 
нажмем на кнопку Create Load

00:07:34.360 --> 00:07:37.780
Balancer, откроется еще одна 
страница, в которой вам

00:07:37.780 --> 00:07:42.680
нужно будет выбрать тип нового 
создаваемого Load Balancer.

00:07:42.680 --> 00:07:49.360
Нас интересует Application Load Balancer, 
давайте нажмем на кнопку Create под этой опцией.

00:07:49.360 --> 00:07:56.960
Откроется страница для ввода 
свойств нового Load Balancer.

00:07:56.960 --> 00:08:04.520
Как name давайте укажем LabELB. Далее в 
настройках сети Network необходимо выбрать

00:08:04.520 --> 00:08:12.360
VPC, в нашем случае это Lab VPC. Далее после 
этого нам необходимо выбрать Availability Zones,

00:08:12.360 --> 00:08:16.840
для этого выбираем первую 
Availability Zone – us-east-1a.

00:08:16.840 --> 00:08:23.480
Здесь нам необходимо выбрать Public 
Subnet 1, то же самое необходимо

00:08:23.480 --> 00:08:28.880
проделать для второй Availability Zone 
и выбрать Public Subnet 2.

00:08:28.880 --> 00:08:33.160
В результате у вас должно 
быть выбрано два Subnet, это

00:08:33.160 --> 00:08:41.680
Public Subnet 1 и Public Subnet 2. Мы переходим 
к следующей секции — это Security groups.

00:08:41.680 --> 00:08:47.760
Здесь нам необходимо в выпадающем 
меню выбрать опцию Web Security Group.

00:08:47.760 --> 00:08:50.880
Также вы видите, что выбрана 
default security group,

00:08:50.880 --> 00:08:54.200
она нам не нужна, поэтому 
необходимо нажать на кнопку X 

00:08:54.200 --> 00:09:00.840
и удалить default security group. В 
результате у нас останется одна единственная

00:09:00.840 --> 00:09:05.400
security group, которая 
называется Web Security Group.

00:09:05.400 --> 00:09:08.400
Самая последняя настройка – 
это Listener, т.е. на какой

00:09:08.400 --> 00:09:12.480
порт, по какому протоколу
будет приходить трафик.

00:09:12.480 --> 00:09:18.880
В нашем случае это HTTP:80. И также здесь
нам необходимо указать как Default action,

00:09:18.880 --> 00:09:28.280
перенаправлять трафик на LabGroup. На этом мы
завершили ввод всех настроек для load balancer.

00:09:28.280 --> 00:09:34.240
Сейчас необходимо прокрутить самый низ 
страницы и нажать на кнопку Create load balancer.

00:09:34.240 --> 00:09:38.840
Вы увидите сообщение о том, что 
load balancer был успешно создан.

00:09:38.840 --> 00:09:41.520
Также вы можете нажать на 
кнопку View load balancer для того,

00:09:41.520 --> 00:09:49.240
чтобы открыть страницу нашего load balancer.
Вы видите, что состояние сейчас provisioning,

00:09:49.240 --> 00:09:54.520
через некоторое время оно поменяется 
на состояние ready либо success.

00:09:54.520 --> 00:10:02.240
Таким образом будет готово к работе.
Нам нет необходимости ждать того момента, 

00:10:02.240 --> 00:10:04.440
когда load balancer будет готов, 
так как следующее задание

00:10:04.440 --> 00:10:11.640
создает следующие IT-ресурсы 
в сервисе Auto Scaling.

00:10:11.640 --> 00:10:19.440
Поэтому мы можем, не дождавшись изменения 
статуса, переходить к следующему заданию.

00:10:19.440 --> 00:10:23.320
Мы с вами переходим к третьему 
заданию. Это объемное задание.

00:10:23.320 --> 00:10:27.880
Здесь мы будем создавать Launch 
Configuration и Auto Scaling Group.

00:10:27.880 --> 00:10:32.880
Я вам напоминаю, что Auto 
Scaling Group – это тот IT-ресурс,

00:10:32.880 --> 00:10:35.920
который позволяет нам в 
зависимости от определенной

00:10:35.920 --> 00:10:43.240
метрики, например, нагрузка на 
CPU, изменять количество таргетов.

00:10:43.240 --> 00:10:48.920
В нашем случае это вычислительные 
мощности или Amazon EC2 инстансы.

00:10:48.920 --> 00:10:54.000
Таким образом, если повышается 
нагрузка на наши Amazon EC2 инстансы, то

00:10:54.000 --> 00:11:00.240
Auto Scaling Group автоматически создает новый
инстанс для того, чтобы нагрузку распределить.

00:11:00.240 --> 00:11:04.600
В случае, если нагрузка 
минимальная, то и Auto Scaling Group

00:11:04.600 --> 00:11:08.120
видит, что у нас есть 
избыточное количество

00:11:08.120 --> 00:11:16.120
Amazon EC2 инстансов, то лишние Amazon 
EC2 инстансы будут автоматически отключаться.

00:11:16.120 --> 00:11:22.800
Итак, первым делом нам необходимо 
создать Launch Configuration.

00:11:22.800 --> 00:11:28.280
Для этого в левом навигационном меню 
необходимо выбрать опцию Launch Configurations.

00:11:28.280 --> 00:11:30.880
В открывшейся странице 
нажать на кнопку Create launch

00:11:30.880 --> 00:11:39.800
configuration и начать вводить данные по 
этому IT-ресурсу. Как name укажем LabConfig.

00:11:39.800 --> 00:11:46.240
Далее, как AMI, выберем ранее созданный 
нами AMI — это Web Server AMI.

00:11:46.240 --> 00:11:54.040
Как Instance type выберем t3.micro. Если же эта 
опция недоступна, то мы можем выбрать t2.micro.

00:11:54.040 --> 00:12:04.800
В следующей секции Additional 
configuration и под секцией Monitoring

00:12:04.800 --> 00:12:09.080
необходимо поставить галочку возле 
Enable EC2 instance detailed monitoring

00:12:09.080 --> 00:12:16.680
within CloudWatch. Это нужно для того, чтобы 
Auto Scaling быстрее реагировал на изменение

00:12:16.680 --> 00:12:22.000
нагрузки на наши инстансы. Следующая 
секция – это Security groups.

00:12:22.000 --> 00:12:27.440
Здесь нам необходимо выбрать 
опцию Select an existing security

00:12:27.440 --> 00:12:31.000
group, т.е. уже ранее созданный 
Security group и в выпадающем

00:12:31.000 --> 00:12:36.360
меню выбрать Web Security 
Group. Двигаемся дальше.

00:12:36.360 --> 00:12:42.240
Секция Key pair – это тот приватный 
ключ, который позволяет

00:12:42.240 --> 00:12:47.400
нам по SSH подключаться к 
нашим Amazon EC2 инстансам.

00:12:47.400 --> 00:12:50.820
Здесь нам необходимо выбрать 
опцию Choose an existing key pair

00:12:50.820 --> 00:12:55.160
и в выпадающем списке 
выбрать key pair: vockey.

00:12:55.160 --> 00:12:58.400
Также поставить галочку о 
том, что вы подтверждаете

00:12:58.400 --> 00:13:03.080
привязку этого ключа к создаваемым 
Amazon EC2 инстансам и нажать на

00:13:03.080 --> 00:13:12.040
кнопку Create launch configuration. Как только 
мы завершили создание Launch Configuration,

00:13:12.040 --> 00:13:14.920
мы на базе неё можем 
создать Auto Scaling group.

00:13:14.920 --> 00:13:18.080
Здесь вам необходимо проверить, 
что вы находитесь в нужном

00:13:18.080 --> 00:13:23.320
регионе, нужный регион – 
это North Virginia, либо us-east-1.

00:13:23.320 --> 00:13:27.960
Нам необходимо выбрать 
LabConfig из списка и нажать

00:13:27.960 --> 00:13:34.000
на кнопку Actions, в выпадающем меню 
выбрать опцию Create Auto Scaling group.

00:13:34.000 --> 00:13:36.640
Как только вы на нее нажмете, 
вас перенаправит на страницу

00:13:36.640 --> 00:13:43.800
создания Auto Scaling group. На этой странице 
в поле Name введем Lab Auto Scaling Group,

00:13:43.800 --> 00:13:48.240
нажмем на кнопку Next. Далее в 
настройках сети нам необходимо выбрать

00:13:48.240 --> 00:13:55.720
VPC, в нашем случае это Lab VPC. Здесь если вы 
увидите сообщение "No public IP address", то

00:13:55.720 --> 00:14:03.880
можете игнорировать это сообщение. Чуть ниже, 
там где необходимо выбрать Subnets, нам необходимо

00:14:03.880 --> 00:14:10.040
выбрать Private Subnet 1 и Private Subnet 2.
Почему Private Subnet, не Public Subnet?

00:14:10.040 --> 00:14:13.520
Это связано с тем, что ранее 
у нас был один единственный

00:14:13.520 --> 00:14:21.160
Amazon EC2 инстанс, который не 
увеличивался в размерах, не в количестве,

00:14:21.160 --> 00:14:28.160
и это был статичный инстанс. В случае 
увеличения нагрузки, инстанс бы не выдержал

00:14:28.160 --> 00:14:35.520
эту нагрузку и отключался бы. Сейчас мы 
добавляем возможность динамического изменения

00:14:35.520 --> 00:14:38.800
наших вычислительных мощностей, 
в зависимости от нагрузки,

00:14:38.800 --> 00:14:49.160
и в этом случае ресурсом, который будет принимать
трафик будет Load Balancer и Auto Scaling group,

00:14:49.160 --> 00:14:58.640
т.е. они уже будут находиться в Public Subnet. 
Таким образом для большей безопасности все наши

00:14:58.640 --> 00:15:06.520
инстансы под Load Balancer мы 
можем расположить в Private Subnet.

00:15:06.520 --> 00:15:11.400
После того, как мы выберем 
Subnets необходимо нажать

00:15:11.400 --> 00:15:18.640
на кнопку Next и в открывшейся 
странице там, где Load balancing -

00:15:18.640 --> 00:15:23.120
optional необходимо выбрать 
Attach to an existing load balancer.

00:15:23.120 --> 00:15:28.800
Как только мы на нее нажмем появится 
выпадающее меню, необходимо выбрать LabGroup.

00:15:28.800 --> 00:15:35.960
В секции Additional settings необходимо 
выбрать опцию и поставить

00:15:35.960 --> 00:15:39.760
галочку Enable group metrics 
collection within CloudWatch.

00:15:39.760 --> 00:15:45.560
Это нужно для того, чтобы 
метрики снимались каждую

00:15:45.560 --> 00:15:52.480
минуту, а это в свою очередь позволит 
быстрее реагировать нашей Auto Scaling group.

00:15:52.480 --> 00:15:57.520
Нажмем на кнопку Next. Здесь нам необходимо 
будет выбрать размеры нашей Group.

00:15:57.520 --> 00:16:03.400
Есть три параметра, это Desired Capacity, 
Minimum capacity и Maximum capacity.

00:16:03.400 --> 00:16:07.080
Desired capacity – это то 
количество таргетов, которое будет

00:16:07.080 --> 00:16:10.720
создано в самом начале 
создания Auto Scaling group.

00:16:10.720 --> 00:16:15.400
Minimum и Maximum capacity соответственно — 
это минимальное и максимальное

00:16:15.400 --> 00:16:20.720
количество таргетов, которое 
может создавать Auto Scaling group.

00:16:20.720 --> 00:16:26.120
И здесь такой момент, нужно 
понимать какое правильное

00:16:26.120 --> 00:16:31.760
значение выставить для минимума 
и в частности для максимума,

00:16:31.760 --> 00:16:36.560
чтобы не израсходовать средства 
компании слишком много,

00:16:36.560 --> 00:16:42.200
но при этом обработать максимально возможное 
количество запросов от ваших пользователей.

00:16:42.200 --> 00:16:47.500
Представим, что вы указали 
Maximum capacity:6 и нагрузка

00:16:47.500 --> 00:16:53.440
она внезапно увеличилась и 
даже 6 инстансов не смогли

00:16:53.440 --> 00:16:57.480
обработать запросы всех 
ваших пользователей.

00:16:57.480 --> 00:17:01.280
В этом случае вам рекомендуется 
настроить дополнительные

00:17:01.280 --> 00:17:09.400
уведомления о том, что 6 
инстансов недостаточно

00:17:09.400 --> 00:17:13.260
для обработки текущей нагрузки, 
поэтому необходимо подключиться

00:17:13.260 --> 00:17:19.760
и вручную поменять это значение. Либо 
изначально получить добро от руководства

00:17:19.760 --> 00:17:23.760
о том, что при увеличении 
нагрузки мы в приоритет

00:17:23.760 --> 00:17:27.320
ставим обслуживание всех 
запросов от пользователей,

00:17:27.320 --> 00:17:33.360
при этом количество инстансов может 
быть увеличено до 10-20 инстансов.

00:17:33.360 --> 00:17:36.040
Это будет стоить дороже, 
но вы получите гарантию

00:17:36.040 --> 00:17:40.120
того, что все ваши пользователи 
будут соответствующие

00:17:40.120 --> 00:17:43.840
обработаны вашим приложением.
Двигаемся дальше.

00:17:43.840 --> 00:17:53.920
В секции Scaling Policies нам необходимо выбрать 
Target tracking scaling policy и его настроить:

00:17:53.920 --> 00:17:59.160
как Lab policy name укажем LabScalingPolicy, 
как Metric type выберем

00:17:59.160 --> 00:18:04.160
Average CPU Utilization, т.е. мы будем 
смотреть на нагрузку, на наши процессоры,

00:18:04.160 --> 00:18:10.280
и как Target value укажем 60. Когда мы 
указываем 60, это говорит о том, что Auto Scaling

00:18:10.280 --> 00:18:18.280
будет стремиться к тому, чтобы нагрузка 
на все наши таргеты была в районе 60%.

00:18:18.280 --> 00:18:22.880
Если она увеличивается, 
это говорит о том, что нагрузка

00:18:22.880 --> 00:18:27.160
поднялась и нам необходимо 
добавить дополнительные таргеты.

00:18:27.160 --> 00:18:32.040
Если же нагрузка упала порядка 
40 либо ниже процентов,

00:18:32.040 --> 00:18:36.560
то в этом случае Auto Scaling group 
понимает, что текущие

00:18:36.560 --> 00:18:44.160
таргеты с легкостью справляются с нагрузкой и она
может один или несколько таргетов удалить.

00:18:44.160 --> 00:18:47.960
Мы переходим к заключительной 
части этого задания.

00:18:47.960 --> 00:18:53.560
Нам необходимо нажать на кнопку Next.
Здесь нам необходимо указать теги.

00:18:53.560 --> 00:18:56.680
Давайте добавим один тег, 
как Key укажем Name и как

00:18:56.680 --> 00:19:04.680
Value укажем Lab Instance. Нажмем на 
кнопку Next и на этом откроется страница,

00:19:04.680 --> 00:19:07.600
где мы можем пересмотреть 
все введенные нами настройки.

00:19:07.600 --> 00:19:15.440
Если все указано верно, мы можем нажать в
самом низу на кнопку Create Auto Scaling Group.

00:19:15.440 --> 00:19:19.960
Если же вы получите ошибку Failed to 
create Auto Scaling Group, необходимо

00:19:19.960 --> 00:19:24.200
нажать на появившуюся кнопку 
Retry Failed Tasks, после чего

00:19:24.200 --> 00:19:27.220
Auto Scaling group должна 
быть успешно создана.

00:19:27.220 --> 00:19:30.000
Обратите внимание, что в 
самом начале количество

00:19:30.000 --> 00:19:37.980
инстансов будет равно нулю и 
со временем будут подниматься

00:19:37.980 --> 00:19:41.600
новые инстансы в количестве 
равном Desired capacity,

00:19:41.600 --> 00:19:48.880
т.е. в итоге у нас будет два инстанса 
поднятых и готовых к работе.

00:19:48.880 --> 00:19:51.940
Мы переходим к четвертому 
заданию и здесь мы будем

00:19:51.940 --> 00:19:57.680
проверять, что связка всех IT-ресурсов, 
созданных нами ранее, работает корректно.

00:19:57.680 --> 00:20:01.960
Самым первым делом нам 
необходимо перейти в левом

00:20:01.960 --> 00:20:07.640
навигационном меню в пункт Instances. Здесь вы 
увидите, что появятся дополнительные два новых

00:20:07.640 --> 00:20:13.200
инстанса с названием Lab Instance.
Почему Lab Instance?

00:20:13.200 --> 00:20:19.640
При создании Auto Scaling group мы давали 
ей тег Name со значением Lab Instance.

00:20:19.640 --> 00:20:24.960
Таким образом Auto Scaling 
group для всех созданных

00:20:24.960 --> 00:20:33.360
от себя инстансов передала свои теги. Здесь 
необходимо дождаться, что Health Checks для этих

00:20:33.360 --> 00:20:40.160
двух Lab Instance будут пройдены. Как только это 
будет готово, вы можете в левом навигационном

00:20:40.160 --> 00:20:45.520
меню переходить к следующей 
вкладке – это Target Groups.

00:20:45.520 --> 00:20:49.880 
Вы увидите, что в списке есть одна 
единственная target group – это LabGroup.

00:20:49.880 --> 00:20:59.800
Давайте на нее нажмем и во вкладке 
Targets вы увидите наши два инстанса.

00:20:59.800 --> 00:21:06.160
Здесь нам необходимо дождаться, что статус 
обоих инстансов перейдет в состояние Healthy.

00:21:06.160 --> 00:21:12.120
Для этого время от времени вы 
можете нажимать на кнопку Refresh.

00:21:12.120 --> 00:21:14.800
Как только они перейдут в 
состояние Healthy, это говорит

00:21:14.800 --> 00:21:24.640
о том, что они сейчас доступны 
для приема запросов от

00:21:24.640 --> 00:21:32.720
Load Balancer и соответственно, Load Balancer 
готов направлять трафик на эти таргеты.

00:21:32.720 --> 00:21:35.200
Теперь давайте посмотрим 
все ли нормально с точки

00:21:35.200 --> 00:21:44.760
зрения Auto Scaling group и Load Balancer. Нам 
необходимо в левом навигационном меню нажать

00:21:44.760 --> 00:22:00.280
на Load Balancers и в нижней части скопировать 
DNS Name, созданного нами Load Balancer.

00:22:00.280 --> 00:22:03.580
Как только вы ее скопируете, 
вы можете ее вставить в

00:22:03.580 --> 00:22:07.200
новую вкладку в вашем 
веб-браузере и открыть эту страницу.

00:22:07.200 --> 00:22:10.560
Откроется подготовленная специально 
для этой лабораторной работы

00:22:10.560 --> 00:22:20.680
простое приложение и вы 
увидите какой-то ответ.

00:22:20.680 --> 00:22:26.000
Это говорит о том, что мы 
отправили запрос Load Balancer,

00:22:26.000 --> 00:22:28.840
Load Balancer направил трафик 
на инстансы, созданные

00:22:28.840 --> 00:22:34.120
Auto Scaling group, инстанс обработал 
этот запрос и вернул какой-то ответ.

00:22:34.120 --> 00:22:41.240
Этот ответ вы видите в виде вашей страницы, 
на котором отображается приложение.

00:22:41.240 --> 00:22:46.920
Таким образом мы подтвердили для 
себя, что связка Auto Scaling group

00:22:46.920 --> 00:22:56.720
и Load Balancer работает корректно. Теперь мы 
переходим к последнему заданию — это тестирование

00:22:56.720 --> 00:23:01.640
нашего Auto Scaling, т.е. нам необходимо 
проверить, что при увеличении

00:23:01.640 --> 00:23:04.980
нагрузки на наши инстансы, 
Auto Scaling автоматически

00:23:04.980 --> 00:23:14.520
добавляет новые инстансы, чтобы эту нагрузку 
распределить по большему количеству таргетов.

00:23:14.520 --> 00:23:19.520
Для этого нам необходимо перейти 
на другой сервис, это CloudWatch.

00:23:19.520 --> 00:23:29.920
Давайте в строке поиска сервисов начнем вводить
CloudWatch, либо можете начать вводить Watch,

00:23:29.920 --> 00:23:31.560
в принципе работает 
полнотекстовый поиск.

00:23:31.560 --> 00:23:38.560
Поэтому любое сочетание символов 
она будет искать в названии сервиса.

00:23:38.560 --> 00:23:50.040
Как только вы переходите на 
страницу сервиса CloudWatch

00:23:50.040 --> 00:23:55.520
в левом навигационном меню, вам 
необходимо выбрать опцию All Alarms.

00:23:55.520 --> 00:23:58.640
Вам должны быть отображены
 два alarms, обе они были

00:23:58.640 --> 00:24:07.640
автоматически созданы Auto Scaling group. Эти 
два alarms по очереди тригерят Auto Scaling group

00:24:07.640 --> 00:24:11.520
в зависимости от нагрузки на 
ваши Amazon EC2 инстансы,

00:24:11.520 --> 00:24:20.400
что в свою очередь иницирует удаление или 
создание новых инстансов в Auto Scaling group.

00:24:20.400 --> 00:24:26.920
Если же эти alarms не отображаются, обратите 
внимание, сидите ли вы в корректном регионе.

00:24:26.920 --> 00:24:31.800
Нам нужен регион North 
Virginia, либо us-east-1.

00:24:31.800 --> 00:24:35.000
Если же вы сидите в правильном 
регионе, тем не менее эти

00:24:35.000 --> 00:24:41.300
alarms не отображаются, нам необходимо 
проделать некоторые действия.

00:24:41.300 --> 00:24:46.760
Эти действия необходимо производить 
только во временно созданном AWS аккаунте.

00:24:46.760 --> 00:24:49.920
В реальном AWS аккаунте 
подобных проблем не будет.

00:24:49.920 --> 00:24:53.280
Итак, если alarm не отображается, 
вам необходимо перейти

00:24:53.280 --> 00:24:56.680
в сервис Amazon EC2, далее в левом 
навигационном меню выбрать

00:24:56.680 --> 00:25:00.960
опцию Auto Scaling Groups, выбрать 
Auto Scaling group, созданную

00:25:00.960 --> 00:25:04.840
ранее нами, называется 
Lab Auto Scaling Group.

00:25:04.840 --> 00:25:09.660
Далее, как только мы ее выберем, в нижней 
части экрана отобразятся несколько вкладок.

00:25:09.660 --> 00:25:14.960
Нам необходимо открыть 
вкладку Automatic Scaling.

00:25:14.960 --> 00:25:20.520
Необходимо там в списке 
выбрать LabScalingPolicy, нажать

00:25:20.520 --> 00:25:26.000
на кнопку Actions и в выпадающем 
меню выбрать опцию Edit.

00:25:26.000 --> 00:25:31.440
Откроется всплывающее окно и как Target Value 
необходимо указать 50 и нажать на кнопку Update.

00:25:31.440 --> 00:25:36.480
Это инициирует повторное создание 
подресурсов Auto Scaling group

00:25:36.480 --> 00:25:50.040
и после этого обновления вы в CloudWatch 
сервисе можете увидеть, что эти alarms появились.

00:25:50.040 --> 00:25:52.360
Обратите внимание, что эти 
alarms появляются не сразу

00:25:52.360 --> 00:26:06.400
и вам необходимо как минимум 1-2 минуты 
подождать после чего обновить страницу.

00:26:06.400 --> 00:26:11.520
Как только наши alarms 
появились, нам необходимо

00:26:11.520 --> 00:26:17.520
выбрать alarm с названием 
AlarmHigh в названии.

00:26:17.520 --> 00:26:26.080
Мы видим, что ее состояние OK. Если же 
отображается не OK, то необходимо подождать

00:26:26.080 --> 00:26:31.640
некоторое время и нажать на кнопку refresh.
Оно должно вернуться в состояние OK.

00:26:31.640 --> 00:26:41.440
OK означает то, что нагрузка на 
наши инстансы на CPU меньше 60%.

00:26:41.440 --> 00:26:45.440
Как только оно увеличивается 
и становится больше 60%, то

00:26:45.440 --> 00:26:48.600
этот alarm из состояния 
OK переходит в состояние

00:26:48.600 --> 00:26:55.080
Alarm и отправляет соответствующую 
информацию в Auto Scaling group.

00:26:55.080 --> 00:27:02.640
Сейчас нам необходимо протестировать, 
что действительно Auto Scaling group работает.

00:27:02.640 --> 00:27:05.760
Для этого нам необходимо 
вернуться в наше приложение,

00:27:05.760 --> 00:27:12.640
открытое ранее в веб-браузере в отдельной 
вкладке и нажать на кнопку Load Test.

00:27:12.640 --> 00:27:17.320
Как только вы на нее нажмете, 
то запустятся скрипты,

00:27:17.320 --> 00:27:22.880
которые дадут нагрузку 
на наши инстансы.

00:27:22.880 --> 00:27:25.720
Обратите внимание, что эту 
страницу закрывать нельзя.

00:27:25.720 --> 00:27:29.940
Если вы закроете эту страницу, 
то нагрузка прекратится.

00:27:29.940 --> 00:27:34.680
Нам необходимо подождать 
некоторое время, чтобы

00:27:34.680 --> 00:27:40.960
метрики передались в AWS и 
соответствующие ресурсы были уведомлены.

00:27:40.960 --> 00:27:50.680
Вы можете периодически 
нажимать на кнопку Refresh

00:27:50.680 --> 00:27:57.000
и вы увидите, что меньше 
чем за 5 минут, AlarmLow,

00:27:57.000 --> 00:28:03.320
он должен поменять свое 
значение на OK, а AlarmHigh,

00:28:03.320 --> 00:28:06.680
наоборот должен поменять 
свое состояние на In alarm,

00:28:06.680 --> 00:28:13.320
т.е. говорит о том, что сейчас 
большая нагрузка на наши инстансы.

00:28:13.320 --> 00:28:18.520
Также если вы откроете соответствующий 
alarm, в нашем случае AlarmHigh,

00:28:18.520 --> 00:28:23.880
то вы увидите увеличивающуюся 
нагрузку на CPU в виде графика.

00:28:23.880 --> 00:28:28.560
Как только оно переходит 60% 
либо 50%, если мы пересоздавали

00:28:28.560 --> 00:28:35.080
наши alarms и это длится 
больше чем 3 минуты, то

00:28:35.080 --> 00:28:42.200
оно триггернет Auto Scaling group, а оно 
в свою очередь добавит новые инстансы.

00:28:42.200 --> 00:28:48.080
Нам необходимо дождаться, пока 
AlarmHigh перейдет в состояние In alarm.

00:28:48.080 --> 00:28:52.080
Как только оно туда перейдет, 
вы можете перейти в сервис

00:28:52.080 --> 00:28:57.880
Amazon EC2, открыть в левом навигационном 
меню опцию Instances и убедиться,

00:28:57.880 --> 00:29:05.280
что сейчас у нас количество инстансов с названием
Lab Instance больше двух, три либо четыре.

00:29:05.280 --> 00:29:10.200
Это говорит о том, что Auto Scaling 
верно работает и для того,

00:29:10.200 --> 00:29:14.160
чтобы распределить нагрузку, оно 
создало дополнительные инстансы.

00:29:14.160 --> 00:29:22.000
Как только вы в этом убедитесь, 
вы можете закрывать страницу

00:29:22.000 --> 00:29:28.000
с приложением для того, чтобы нагрузка 
вернулась в обычное состояние.

00:29:28.000 --> 00:29:34.800
Также вы можете подождать 
как минимум 5 минут для

00:29:34.800 --> 00:29:40.760
того, чтобы количество инстансов 
из трех и четырех вернулось

00:29:40.760 --> 00:29:48.200
обратно к минимальному значению 2. Как 
только вы доберете до этого состояния, я хочу

00:29:48.200 --> 00:29:51.400
от себя предложить провести 
дополнительный эксперимент.

00:29:51.400 --> 00:29:55.200
Вам необходимо в сервисе 
Amazon EC2, в левом навигационном

00:29:55.200 --> 00:29:59.920
меню Instances, выбрать один 
из инстансов с названием

00:29:59.920 --> 00:30:05.920
Lab Instance и через кнопку Actions этот 
инстанс терминейтнуть, т.е. отключить.

00:30:05.920 --> 00:30:14.200
Как только вы ее отключите, 
вы увидите в Load Balancer, что

00:30:14.200 --> 00:30:19.320
один из таргетов стал unhealthy 
и после чего трафик перестает

00:30:19.320 --> 00:30:25.800
направляться на этот инстанс. Auto Scaling 
соответственно видит, что количество инстансов

00:30:25.800 --> 00:30:31.320
стало меньше, чем минимальное значение 
и иницирует создание нового инстанса.

00:30:31.320 --> 00:30:34.160
Через некоторое время 
вы увидите, что был создан

00:30:34.160 --> 00:30:41.500
еще один дополнительный инстанс 
и будет отображено два инстанса.

00:30:41.500 --> 00:30:44.640
Мы переходим к 
последнему заданию.

00:30:44.640 --> 00:30:51.280
Мы в самом начале создавали AMI 
от инстанса с названием Web Server 1.

00:30:51.280 --> 00:30:55.240
Вы видите, что этот сервер 
нам уже не нужен, так как

00:30:55.240 --> 00:31:01.440
сейчас трафик он направляется не на 
этот Web server, а на Load Balancer.

00:31:01.440 --> 00:31:06.800
Таким образом мы можем этот сервер удалять.
Для этого необходимо в списке инстансов выбрать

00:31:06.800 --> 00:31:15.000
Web Server 1, далее нажать на кнопку Instance 
state и выбрать опцию Terminate Instance.

00:31:15.000 --> 00:31:23.120
Также во всплывающем меню необходимо 
подтвердить о том, что мы отключаем этот инстанс.

00:31:23.120 --> 00:31:29.040
На этом мы добрались до конца 
нашей лабораторной работы.

00:31:29.040 --> 00:31:38.080
Я вам напоминаю, что вам необходимо корректно 
отключить/разлогиниться из временного

00:31:38.080 --> 00:31:44.480
AWS аккаунта. Также вам необходимо в 
AWS Academy, на странице лабораторной

00:31:44.480 --> 00:31:47.520
работы нажать на кнопку End Lab, 
подтвердить и дождаться

00:31:47.520 --> 00:31:53.120
сообщения о том, что "DELETE has 
been initiated... You may close this

00:31:53.120 --> 00:31:56.600
message box now." что говорит 
о том, что процесс удаления

00:31:56.600 --> 00:32:03.320
всех созданных ресурсов и аккаунтов 
инициирован, и вы можете закрывать это окно.

00:32:03.320 --> 00:32:05.800
Вы закрываете это всплывающее 
окно, также можете закрывать

00:32:05.800 --> 00:32:11.120
вкладку с AWS Academy, и на этом вы 
успешно завершили лабораторную работу.

00:32:11.120 --> 00:32:15.440
Еще раз хотел бы вас поздравить
завершением лабораторной работы.

00:32:15.440 --> 00:32:21.920
Я очень надеюсь, что многие 
вопросы были отвечены, вы

00:32:21.920 --> 00:32:28.200
получили более полное представление 
о сервисах ELB и Auto Scaling.

00:32:28.200 --> 00:32:45.000
Если будут вопросы, то задавайте, а мы с вами 
увидимся на следующих наших активностях.