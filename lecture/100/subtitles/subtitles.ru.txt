Добрый день, уважаемые студенты! 
Я рад вас всех видеть на очередной лекции.
Тема сегодняшней лекции это хранение, т.е. Storage.
Итак, давайте начнем.
Сегодняшняя лекция состоит из четырех секций.
Мы разберем четыре самые основные сервисы, связанные с хранением.
Это Amazon Elastic Block Store, т.е. жесткий диск, который мы привязываем к инстансу Amazon EC2.
Далее, это сервис Amazon S3, т.е. Amazon Simple Storage Service, для объектного хранения.
После чего разберем Amazon EFS, Amazon Elastic File System - сервис, который предоставляет нам жесткие диски с общим доступом для нескольких инстансов AmazonEC2.
И самым последним разберем Amazon S3 Glacier, это объектное холодное хранение.
Есть определенные use cases, когда нам необходим этот вариант IT-ресурса.
Итак, мы с вами начинаем с Amazon Elastic Block Store, чаще всего вы будете видеть этот сервис как Amazon EBS в сокращенном варианте.
Что же такое Amazon EBS? 
Это постоянное блочное хранение, т.е. жесткие диски, которые вы подключаете к вашим инстансам Amazon EC2.
Под постоянным имеется в виду при отключении вашего инстанса, данные на жестких дисках сохраняются.
Также жесткие диски Amazon EBS это то место, куда устанавливается операционная система на вашем инстансе Amazon EC2.
Для высокой доступности Amazon EBS реплицирует ваши данные в несколько разных ресурсах, прозрачным для вас в рамках текущей availability zone.
Таким образом, поломка жесткого диска для вас прозрачна и Amazon берет на себя поддержку и гарантию того, что ваши Amazon EBS Volume доступны и с ними ничего не происходит.
Также здесь следует отметить, что с Amazon EBS вы можете выделить необходимое количество гигабайтов для ваших жестких дисков и по необходимости увеличивать либо уменьшать, чтобы оплачивать только за то, что вы используете.
Есть два типа хранения.
Мы с вами говорим, что Amazon EBS - это блочное хранилище, а Amazon S3 - это объектное хранилище.
Чем же оно отличается?
Давайте рассмотрим на примере изменения одного символа в файле с размером 1 гигабайт, т.е. вы представляете, какой объем символов внутри этого одного файла и что же происходит, когда вы меняете только один символ.
Когда мы говорим про блочное хранилище, вы изменяете конкретное место в этом жестком диске, только необходимую ячейку памяти.
Когда мы говорим про объектное хранилище, то для того, чтобы обновить один символ внутри этого большого файла, нам необходимо перезаписать весь этот файл.
Таким образом, вы видите, что мы не можем частично менять файлы при объектном хранении. 
Это требует большую пропускную способность, нежели блочное хранение, когда изменение файлов, вне зависимости от его размера, требует внесения изменения только в определенном месте.
А вся остальная часть большого файла может оставаться нетронутой.
И здесь возникают различного рода нюансы.
Когда мы говорим про блочное хранилище, то мы можем работать с меньшим пропускным каналом к сети.
Когда мы говорим про объектное хранилище, то может потребоваться более широкий канал.
Но с другой стороны, цена за хранение гигабайта данных в блочном хранении может быть на порядок дороже, чем объектное хранилище.
Таким образом, в зависимости от вашей бизнес-задачи, вы будете принципиально для себя выбирать работать с блочным хранилищем, либо с объектом хранилищем.
Еще один важный момент, который следует отметить, это то, что при частой перезаписи лишь небольшой части ваших файлов, возможно, говорит о том, что следует использовать блочное хранилище.
Когда вы работаете с маленькими, например, JSON файлами, когда большая часть этого файла меняется, либо размер этих файлов не такой большой, то объектное хранилище может быть для вас лучшим вариантом.
Давайте пройдемся по основным преимуществам использования сервиса Amazon EBS.
Это то, что этот сервис предоставляет вам возможность индивидуально создавать жесткие диски для ваших инстансов Amazon EC2.
Также мы говорим, что это хранение блочного уровня, и все жесткие диски прозрачно для вас реплицируются внутри той же availability zone.
Таким образом, поломка физически одного жесткого диска, она для вас прозрачна, так как происходит автоматическое переключение на копию внутри той же availability zone, и ваш EC2 инстанс продолжает работать без перебоев.
Также есть возможность делать некие снапшоты, т.е. образы ваших жестких дисков, которые сохраняются в сервисе Amazon S3.
С этих снапшотов вы далее можете восстанавливать ваши жесткие диски и поднимать новые инстансы Amazon EC2.
Существует четыре типа жестких дисков внутри сервиса Amazon EBS.
Подразделяются на две категории.
Первые это SSD, т.е. Solid State Drives, другие это HDD, т.е. Hard Disk Drives.
SSD мы все знаем, они быстрее.
Внутри SSD делится тоже на два вида.
Это General Purpose, общего назначения, т.е. 90-95% случаев General Purpose для вас подходящий вариант.
Когда мы говорим Provisioned IOPS, это та опция, тот тип жестких дисков, который предоставляет вам больший канал IOPS, т.е. операции записи и чтения на ваши жесткие диски.
Если ваше приложение активно записывает и читается с жестких дисков, то Provisioned IOPS может быть опцией для вас.
Здесь следует отметить, что Provisioned IOPS стоит намного дороже, чем General Purpose, поэтому рекомендуется всегда начинать с General Purpose.
Если вам нужно больше IOPS, больше производительность жестких дисков, то в этом случае есть смысл рассматривать Provisioned IOPS.
Когда мы говорим про жесткие диски для установки операционной системы, то это всегда SSD, либо General Purpose, либо Provisioned IOPS.
Таким образом, вторая группа, т.е. HDD, жесткие диски предыдущего поколения, они не могут быть использованы для установки операционной системы.
Вы можете использовать эти жесткие диски как дополнительное хранилище, дополнительные жесткие диски для дешевого хранения некоторых данных.
Есть два варианта, это Throughput-Optimized и Cold.
Когда мы говорим Throughput-Optimized, это оптимальный вариант в рамках группы HDD, т.е. Hard Disk Drives, и подходит в большинстве случаев для стандартных нагрузок, опять же для целей хранения.
Когда мы говорим про холодное хранение, т.е. если у вас приложения нетребовательны к операциям чтения и записи на жесткие диски, то для того, чтобы сократить расходы на конкретный сервис Amazon EBS, то рекомендуется рассмотреть опцию Cold, которая по производительности чуть хуже, но при этом по стоимости также стоит дешевле.
Актуальные цены вы всегда можете посмотреть на официальной странице сервиса во вкладке Pricing.
Давайте теперь подробнее рассмотрим, какие же есть use cases для каждого типа жестких дисков EBS.
Когда мы говорим General Purpose, из того, что можно дополнительно отметить, это использование Virtual desktops, это когда у вас есть удаленный рабочий стол и ваши сотрудники работают там.
Еще один пример, который стоит упомянуть, General Purpose также следует применять для ваших development и test сред.
Обычно, когда это не Production среда, то нагрузки там минимальные. Обычно эти нагрузки искусственные, поэтому для целей тестирования и разработки дешевый вариант, который мы можем использовать для установки операционной системы, рекомендуется применять этот General Purpose.
Если мы говорим про Provisioned IOPS, это те приложения, которые сильно зависят от операции чтения и записи на ваши жесткие диски.
Как пример, может быть, у вас на вашем Amazon EC2 установлена база данных, т.е. вы решили по тем или иным причинам не использовать Service Managed Database RDS, а решили самостоятельно установить на виртуальный сервер вашу базу данных и там работать.
В этом случае база данных – это тот пример, когда операции чтения и записи выше среднего.
Таким образом, Provisioned IOPS больше подходит в этом случае.
Если мы говорим про следующий третий вид, это Throughput-Optimized. 
Как примеры могут быть работа с Big data, работа с Data warehouse, т.е. склад данных, обработка логов и т.д.
Если мы говорим про Cold, это все те опции, когда нам необходимо сократить расходы на хранение, либо у нас достаточно большой объем данных, которые не часто запрашиваются.
В этом случае Cold – опция, тип жестких дисков наиболее подходит.
Давайте отметим еще парочку преимуществ использования сервиса Amazon EBS касательно снапшотов.
Мы говорили, что снапшот – это некая сохраненная копия вашего жесткого диска и она привязывается к определенному времени.
Можно настроить ежедневные, еженедельные, либо более сложный график создания снапшотов ваших жестких дисков.
Когда создается самый первый снапшот, то он называется baseline snapshot, т.е. он сохраняет полностью весь жесткий диск.
Так как мы работаем с блочным хранилищем, то у нас есть возможность все следующие снапшоты хранить не всю целую копию жесткого диска, а лишь сохранить изменения с последнего снапшота.
Таким образом, представим, что у вас есть 10 снапшотов на каждый день за последние 10 дней.
И это не говорит о том, что при размере, например, 10 гигабайтов вашего жесткого диска, то все 10 снапшотов будут весить 100 гигабайтов, т.е. 10 умноженные на 10.
А наоборот, первый будет весить только 10 гигабайтов, а все последующие будут хранить лишь изменения.
Если мы говорим о том, что ваш жесткий диск не менялся сильно, то может получится так, что все оставшиеся ваши снапшоты, т.е. 9 снапшотов могут весить меньше 1 гигабайта.
Если мы говорим про шифрование, т.е. encryption, то оно также доступно.
Вы можете подключить сервис AWS KMS для шифрования ваших жестких дисков, и доступно это в рамках сервиса Amazon EBS без дополнительной платы.
Вы лишь оплачиваете отдельно за сервис AWS KMS за использование и создание ключей шифрования.
Если мы говорим про эластичность, т.е. elasticity, то здесь следует отметить, что размер вашего жесткого диска может динамически меняться.
Более того, вы можете даже не останавливать ваш инстанс, а динамически увеличить размер вашего жесткого диска.
Также есть возможность менять тип жестких дисков динамически, т.е. нет необходимости вам заниматься копированием от одного жесткого диска на другой жесткий диск другого типа. 
Достаточно вызвать соответствующую команду по изменению типа, и все необходимые действия будут произведены на стороне AWS.
Из чего складывается оплата за сервис Amazon EBS? 
Оно состоит из четырех составляющих.
Первое – это объемы, т.е. вы оплачиваете за гигабайт ежемесячно за суммарное количество гигабайтов на всех ваших жестких дисках.
Далее это – IOPS, т.е. если мы говорим про General Purpose SSD, то цена за IOPS включена в оплату за Volume.
Если мы говорим про Magnetic, вы дополнительно оплачиваете за каждый request input output операции.
Если мы говорим Provisioned IOPS, то вы оплачиваете дополнительно за объем IOPS, который вы для себя указали.
Следующая категория это снапшоты, т.е. снапшоты – это копии ваших жестких дисков, которые хранятся в сервисе Amazon S3.
Таким образом, вы будете оплачивать по тарифам Amazon S3 сумму в зависимости от объемов гигабайтов ваших снапшотов суммарно.
Поэтому когда мы говорим про снапшоты, для экономии оплаты за хранение внутри Amazon S3 рекомендуется правильно настроить расписание создания снапшотов, т.е. как пример вам нет необходимости создавать ежедневные снапшоты и хранить все снапшоты за последний год.
Достаточно хранить ежедневные снапшоты за последнюю неделю.
Далее от недели до одного месяца можно хранить снапшоты еженедельные, т.е. еще три снапшота добавляются.
Далее все те снапшоты, которые старше одного месяца до одного года можно хранить ежемесячно.
Добавляется еще 11 снапшотов.
Таким образом можно сэкономить на хранении ваших снапшотов, но при этом иметь достаточную гибкость в случае если вам нужно восстановить предыдущее состояние ваших жестких дисков.
И последнее это Data transfer, т.е. мы с вами помним, что мы за трансфер данных в рамках одного региона ничего не оплачиваем.
Мы не оплачиваем за inbound traffic, т.е. когда мы данные загружаем внутри AWS, но при этом если мы копируем наши жесткие Amazon EBS Volume, жесткие диски с одного региона на другой, то здесь необходимо оплатить стандартную оплату за data transfer между двумя регионами.
Далее уже скопированные жесткие диски на втором регионе уже будут оплачиваться по стандартным тарифам того региона.
На этом мы подошли к концу первой секции.
Давайте пройдемся по самым основным моментам сервиса Amazon EBS.
Это сервис, который предоставляет вам блочное хранилище.
Простыми словами, это жесткие диски, которые вы подключаете к вашим инстансам Amazon EC2.
На этих жестких дисках устанавливается операционная система, а также вы можете подключать дополнительные жесткие диски для целей хранения.
Выделяют две группы типов жестких дисков, это HDD, которые медленные, но дешевле.
И второй вариант – это SSD, более продвинутый вариант, работает быстрее, но при этом стоит дороже.
Здесь важный момент, вы для установки операционной системы можете выбрать только тип SSD.
Все ваши жесткие диски прозрачно для вас реплицируются внутри той же availability zone.
Таким образом, физическая поломка конкретного жесткого диска не отражается на работе вашего инстанса Amazon EC2, вашего приложения, так как происходит автоматическое переключение на реплику, т.е. копию жесткого диска.
Можно настроить шифрование, это происходит также прозрачно, нет никаких сложностей, подключается сервис AWS KMS и они работают достаточно нативно совместно.
Все ваши volumes могут быть динамически увеличены либо уменьшены в размере, а также вы с легкостью можете менять тип ваших жестких дисков.
Когда мы говорим про backup ваших жестких дисков, то мы создаем снапшоты.
Снапшоты это копия ваших жестких дисков, хранящихся внутри сервиса Amazon S3.
Мы переходим с вами ко второй части нашей лекции и поговорим про сервис Amazon Simple Storage Service.
Чаще вы будете видеть название этого сервиса в сокращенном варианте Amazon S3.
Amazon S3 – это сервис, который предоставляет объектное хранилище для ваших данных.
Мы с вами ранее упоминали, что при изменении даже одного символа внутри файла, для того чтобы обновить этот файл внутри объектного хранилища, необходимо его полностью перезагрузить.
В зависимости от вашей бизнес-задачи, вам нужно будет использовать либо блочное, либо объектное хранилище.
Все ваши данные, которые хранятся в рамках Amazon S3, они организованы по bucket-ам, т.е. вы создаете некий bucket, внутри bucket-a уже заливаете ваши объекты.
Вы можете создавать структуру из папок, оно на стороне AWS Management Console будет отображаться как структура папок, но на самом деле это хранение файлов с ключом, с путем до этого файла, который содержит в себе слэшы.
Таким образом, внутри под капотом, это все происходит не как папки и файлы, а по-другому, но при этом отображение для удобства, для легкости восприятия и удобной работы вы можете видеть и работать как файлы и папки.
Давайте пройдемся по основным преимуществам сервиса Amazon S3.
Мы с вами говорили, что Amazon S3 это объектное хранилище.
Это сервис, который предоставляет durability, т.е. надежность хранения ваших данных 99.99, либо по-другому говорят 11 девяток, т.е. практически 100% надежность хранения ваших данных и гарантирует вам, что вы свои данные не потеряете.
Как это реализовано? 
Это реализовано следующим образом: в рамках сервиса Amazon S3 происходит прозрачная операция по репликации нескольких копии всех объектов, которые вы храните внутри этого сервиса.
Таким образом, когда происходит техническая поломка железа, которая хранит именно определенный ваш объект, то для последующей работы и в доступном состоянии для вас остаются реплики этого объекта.
Далее происходит автоматическое понимание, что на стороне AWS под капотом что-то произошло с этим железом и все объекты, которые хранились в этом жестком диске, они еще раз реплицируются уже в другие жесткие диски.
Таким образом, этот процесс автоматизирован на стороне AWS и благодаря вот этому процессу репликации достигается 99.99% надежности хранения ваших данных.
Если мы говорим про размер объектов, которые вы можете хранить, то максимальный размер, который вы можете сохранить внутри Amazon S3 может достигать 5 ТБ для одного объекта.
Таким образом, вы внутри Amazon S3 можете хранить снапшоты ваших баз данных как объект.
Amazon S3 является managed сервисом.
Таким образом, вы не управляете никакой инфраструктурой, не делаете никаких настроек, а лишь вам предоставляется сервис в готовом виде и вы загружаете любое, фактически неограниченное количество объектов внутри этого сервиса.
И все те процессы, которые должны быть выполнены для поддержания хранения ваших данных обеспечиваются AWS.
Если мы говорим про шифрование, то можно настроить для сервиса Amazon S3 хранение как в покое, т.е. at rest, также и in transit, т.е. во время передачи данных.
Другой интересной фичей Amazon S3 является настройка так называемых event notifications, т.е. вы можете для определенных event-ов, связанных с сервисом Amazon S3, например это может быть загрузка нового файла, либо удаление файла, по определенному пути навесить на нее триггер и по триггеру либо настроить уведомления через сервис Amazon SNS, либо загрузку этого event-а в Amazon SQS для последующей обработки.
Также вы можете передать это лямбде для того, чтобы лямбда напрямую получила этот event и произвела некоторые действия.
Когда мы работаем с сервисом Amazon S3, мы храним различного рода данные.
Это в свою очередь, говорит о том, что частота обращения, частота работы с этими данными могут сильно различаться.
Некоторые данные вы будете запрашивать и возможно изменять, либо только читать каждый день.
Некоторые данные вы возможно будете запрашивать раз в несколько месяцев, а некоторые данные, которые за всю жизнь существования этих данных могут быть не запрошены ни один раз.
Есть такие данные, use case, как самый явный пример это по некоторым регуляторным требованиям, определенным положениям в зарегулированных сферах таких как финансовая сфера, медицина, государственный сектор – это те направления, те сферы, где по некоторым регуляторным требованиям вам несколько лет, до 5-10 лет необходимо хранить эти данные, так как они могут быть востребованы.
Если будут востребованы, то компания обязана предоставить некоторую информацию.
Таким образом, ввиду того, что такие кейсы в целях регуляторных могут не возникнуть, то эти данные могут по большей своей части храниться несколько лет, а потом по истечению необходимого минимального времени хранения могут быть успешно удалены.
Давайте пройдемся теперь по типам хранения внутри Amazon S3, которые были специально разработаны для того, чтобы лучше подходить под ваши бизнес-задачи и при этом иметь возможность экономить и сделать более cost-effective решение с помощью сервиса Amazon S3.
Самый первый и самый популярный тип хранения, класс хранения это – Amazon S3 Standard.
Это тот класс хранения, который подходит для более 90% случаев и это тот класс, когда вы можете надежно, т.е. 11 девяток хранить ваши данные.
Вы можете в режиме онлайн запрашивать ваши данные и соответственно для того, чтобы это все обеспечить, необходимы те или иные ресурсы, а вот все это формирует итоговую цену этого класса.
Если мы хотим сделать наши расходы меньше, то мы можем рассмотреть следующий класс хранения, называется Amazon S3 Intelligent Tiering.
Идея этого класса в том, что Amazon за вас анализирует, как часто происходит работа, обращение, перезапись каждого объекта внутри всех ваших бакетов, там где вы подключите этот класс и по своей внутренней логике переносит ваши объекты на уровне каждого объекта от одного класса хранения на другой, для того, чтобы сэкономить ваши расходы на сервис Amazon S3.
При этом никак не меняется эффективность работы сервиса Amazon S3, т.е. если ваши данные часто запрашиваются и должны быть доступны онлайн по требованию, то соответственно Intelligent Tiering ни в коем случае не переведет эти объекты в класс, который не может сразу извлечь ваши объекты.
Обратный случай, когда он видит, что ваши объекты совсем не запрашиваются, то почему бы эти данные не перенести в класс хранения дешевле, но который может быть недоступен сразу или может быть в класс хранения, который менее надежен, но дешевле.
Если мы говорим про следующий класс, это Standard-Infrequent Access.
Этот класс хранения отличается от стандартного тем, что здесь вы можете хранить ваши объекты, которые вы не часто запрашиваете, дешевле.
Когда мы говорим про стандартный класс, вы оплачиваете только за суммарное количество гигабайтов в месяц.
Когда мы говорим Standard-Infrequent Access, вы оплачиваете за суммарное количество гигабайтов данных, которые вы храните.
При этом тариф за каждый гигабайт ниже, т.е. дешевле, но при этом добавляется еще один компонент, который формирует итоговую цену.
Это оплата за Retrieval fee, т.е. за извлеченное количество гигабайтов, за каждый гигабайт, вы отдельно оплачиваете некоторую сумму.
Таким образом, если вы положите ваши часто запрашиваемые данные в Infrequent Access, это будет очень невыгодно.
Вы будете переплачивать фактически ввиду того, что стоимость извлечения может быть больше стоимости хранения.
Обратный случай, если у вас данные, которые вы не часто запрашиваете, то может получиться так, что за счет скидки за хранение и за счет того, что вы не так часто запрашиваете, итоговая сумма Standard-Infrequent Access может быть выгоднее, чем Standard.
Следующий класс хранения – это One Zone-Infrequent Access.
Чем он отличается от предыдущих? 
Это тем, что ваши данные хранятся в рамках одной Availability zone, тогда как предыдущие классы хранения Standard, Standard-Infrequent Access и все другие, они хранятся как минимум в трех Availability zone-aх.
За счет этого достигается надежность 11 девяток.
Когда мы говорим про One Zone-Infrequent Access, то это одна Availability zone, соответственно там не 11 девяток, а меньше.
Этот класс хранения может быть идеальным вариантом, если вы храните данные, которые могут быть легко восстановлены, либо потеря которых некритична для вашего бизнеса.
В этом случае вы можете хранить данные в одной Availability zone, какая-то небольшая часть может потеряться и при этом вы не так много, т.е. намного меньше будете оплачивать по сравнению с Standard классом хранения.
Осталось еще два класса хранения, это Glacier.
Это тот класс хранения, который позволяет вам надежно хранить архивные данные, т.е. те данные, которые вы скорее всего не будете запрашивать.
Есть вероятность того, что вы эти данные запросите, но в большинстве случаев они так и останутся незапрошенными и вы должны хранить данные лишь некоторый период.
Amazon S3 Glacier предоставляет самый дешевый тариф за гигабайт хранения данных, при этом вы не можете извлечь ваши данные сразу в режиме онлайн.
Есть три опции как вы эти данные можете извлечь, это самый быстрый, который извлекает ваши данные в течение нескольких минут и самый медленный, для извлечения которых требуется несколько часов.
Но при этом понятно, что тот, который за минуту извлекает по тарифу стоит дороже, а тот, который за несколько часов будет извлекать ваши данные, он стоит дешевле.
Но при этом помните, что когда мы работаем с Glacier и вы часто запрашиваете ваши данные, что неприемлемо для этого класса, то оплата за этот класс хранения может выйти дороже, чем стандартный класс хранения.
Поэтому нужно знать с какими данными вы работаете и соответственно настраивать life cycle policy, про который мы поговорим чуть попозже.
Самый последний класс хранения ¬– это Glacier Deep Archive.
Это те данные, которые вы можете хранить максимально дешево, которые по регуляторным требованиям должны храниться несколько лет и обычно сюда относят данные, к которым вы обращаетесь возможно один или два раза в течение года.
Эти данные идеально подходят для хранения в Glacier Deep Archive.
Если мы говорим про извлечение данных, то данные обычно извлекаются не раньше, чем 12 часов, т.е. в течение 12 часов.
Это нужно учитывать при работе с классами хранения Glacier и Glacier Deep Archive.
Мы с вами двигаемся дальше.
Повторю некоторые нюансы по работе с сервисом Amazon S3.
Мы с вами сказали, что все наши данные организованы внутри bucket-ов и внутри bucket-ов вы создаете некое подобие структуры папок и файлов и храните ваши объекты.
Bucket-ы именуются некоторым образом и вот это имя должно быть уникально для всего сервиса Amazon S3, глобально.
Представим, что в регионе us-east-1 был создан bucket Елжан Мауленов, то в другом регионе, например, eu-west-1, это европейский регион, я не могу создать bucket с таким же именем, так как пул названий bucket-ов должен быть уникальный в рамках всего AWS глобально.
Но есть нюанс касательно хранения.
Когда мы создаем bucket, мы указываем к какому региону будет относиться наш bucket.
Это тот регион, где будут храниться ваши данные внутри этого bucket-а.
Давайте приведу пример.
Представим, что я создал bucket Елжан-Мауленов-1 в регионе North Virginia.
В этом случае все объекты, которые я буду туда заливать, будут храниться на серверах, которые физически находятся в регионе North Virginia.
И также создал в AWS Management Console другой bucket, который называется Елжан-Мауленов-2, но при этом как регион указал Токио.
В этом случае все данные, объекты, которые буду заливать в этот bucket, они будут храниться физически в рамках границ региона Токио.
Здесь на слайде вы можете видеть пример двух вариантов ссылки до ваших объектов, т.е. есть вариант Bucket path-style URL endpoint.
Это когда у вас в начале идет стандартная часть, т.е. s3.название региона.amazonaws.com, дальше /bucket name/путь к вашему файлу.
Есть другой вариант, это Bucket virtual hosted-style URL endpoint, когда название bucket name уже сидит в названии сайта.
И через / идет уже путь к вашему объекту.
И тот и другой вариант рабочий и в зависимости от того, какой удобнее для вас вы выбираете.
Если мы говорим касательно доступа к вашим объектам, то вы можете настроить на уровне bucket-а, а также на уровне каждого объекта внутри bucket-а соответствующие bucket policy, которые определяют кто, как может обращаться или какие операции может производить на bucket-е либо на определенном объекте.
Когда мы говорим про сервис Amazon S3, bucket у нас хранится в рамках одного региона.
Также по мере необходимости вы можете загрузить очень маленький файл в один bucket и по необходимости этот bucket может быть увеличен на несколько терабайтов.
Нет никаких ограничений и вы фактически будете оплачивать только за то, что вы используете.
Также важный момент это то, что к Amazon S3 вы можете обращаться со всех возможных вариантов, а именно через AWS Management Console, через Command Line Interface, т.е. Amazon CLI, а также AWS SDK, т.е. Software Development Kit.
Если мы говорим про use case сервиса Amazon S3, то мы можем использовать Amazon S3 для того, чтобы хранить некоторые файлы, медиа-файлы, которые используют ваше приложение.
Также мы можем хостить статический веб-сайт внутри Amazon S3, есть специальная feature для этого.
S3 может выступать как местом хранения ваших backup-ов, снапшотов, также Amazon S3 может использоваться для disaster recovery, для хранения определенной части вашей инфраструктуры.
Если вы работаете с большими данными, то соответственно Amazon S3 тоже может быть тем местом, домом ваших данных, где в связке с другими сервисами вы будете не только хранить эти данные, но и также будет возможность работать, обрабатывать, изменять и проводить некоторый анализ и аналитику на основе этих данных.
Когда мы говорим про Pricing в рамках сервиса Amazon S3, то мы платим за количество гигабайтов, которые мы храним.
Мы платим за data transfer, т.е. трансфер данных от одного региона до другого региона, а также мы оплачиваем за количество запросов к сервису Amazon S3 для разного вида действий, т.е. это может быть PUT, COPY, POST, LIST либо GET.
Если говорить про то, что мы не оплачиваем, если данные передвигаются в рамках Amazon S3, за это оплата не идет.
Также если мы передаем данные из Amazon S3 в Amazon CloudFront либо наши Amazon EC2 инстансы в рамках того же региона, то также мы не должны ничего оплачивать АWS.
На этом мы подошли к концу второй секции.
Посмотрели подробно сервис Amazon S3, давайте пройдемся по самым основным моментам.
Резумируя, мы говорим, что Amazon S3 это managed service для объектного хранения данных внутри облака AWS.
Мы можем хранить неограниченное количество объектов, объекты наши хранятся внутри bucket-ов, мы оплачиваем только за то, что мы используем, т.е. за тот объем данных, которые мы храним внутри сервиса Amazon S3.
Мы можем обращаться в любое время с любого места, используя все возможные варианты для обращения, для доступа к нашим объектам внутри bucket-ов.
Также есть достаточно широкий набор настроек безопасности для того, чтобы ваши данные были зашифрованы не только в состоянии хранения, но и в состоянии передачи.
Мы с вами переходим к третьей части нашей лекции и к третьему сервису хранения.
Это Amazon Elastic File System, либо чаще вы будете его встречать как Amazon EFS.
Это тот сервис, который предоставляет вам жесткие диски, которые вы можете расшарить между несколькими инстансами Amazon EC2.
Таким образом будет общий доступ, общее хранилище для пула ваших инстансов.
Для некоторых бизнес задач это очень подходящий сервис.
Здесь также мы оплачиваем только за то, что мы используем, т.е. в зависимости от объема данных, которые находятся, при увеличении, соответственно, мы оплачиваем больше, при уменьшении наши расходы на сервис Amazon EFS уменьшаются.
Если же мы говорим про основные фичи сервиса Amazon EFS, то это тот сервис, который предоставляет нам файловое хранилище внутри облака AWS.
Это файловое хранилище, файловая система, она может быть масштабирована до размера терабайтов, петабайтов, при этом предоставлять высокую доступность.
Это тот сервис, который предоставляет вам общее одно место, которое может быть доступно из нескольких Amazon EC2 инстансов.
Размер жестких дисков увеличивается и уменьшается, вы, соответственно, оплачиваете за тот объем на текущий момент, который вы используете.
Есть поддержка NFC, т.е. Network File System версии 4.0 и 4.1.
А также следует отметить, что Amazon EFS поддерживает все операционные системы, базирующиеся на Linux.
Здесь вы можете видеть пример архитектуры с использованием сервиса Amazon EFS.
У нас есть VPC, у нас есть ресурсы в трех availability zone-ах, есть инстансы Amazon EC2 в наших private либо public subnet-ах, и, соответственно, у наших EC2 инстансов есть Network Interface.
Мы этот Elastic File System подключаем, монтируем к Network Interface, и, соответственно, у инстансов Amazon EC2 появляется доступ на всех в трех availability zone-ах к одной файловой системе, общей для всех этих инстансов в рамках всего VPC.
На этом мы подошли к концу третьей секции нашей лекции.
Подробнее рассмотрели сервис Amazon EFS.
Давайте остановимся на самых основных моментах.
Amazon EFS – это тот сервис, который предоставляет вам файловую систему, которая может быть расшарена на несколько EC2 инстансах, т.е. это общее место, и в зависимости от вашей бизнес-задачи вам могут потребоваться подобные IT-ресурсы.
С Amazon EFS вы оплачиваете только за тот объем информации, который вы храните в вашем EFS жестком диске, т.е. по модели Pay as you go.
EFS является полностью managed сервисом.
Таким образом вам нет необходимости поддерживать все то, что происходит под капотом, а лишь получаете готовый сервис, который можете использовать и достаточно быстро, буквально за пару кликов настраивать и интегрировать вашу IT-инфраструктуру.
Мы с вами добрались до самой последней секции в рамках нашей лекции и подробнее поговорим про сервис Amazon S3 Glacier.
Про него мы поговорили во второй части, здесь рассмотрим некоторые нюансы.
Давайте остановимся с вами на основных features-ах сервиса Amazon S3 Glacier.
Это тот сервис, который используется для архивирования ваших данных.
Он также как и другие классы хранения сервиса Amazon S3, предоставляет высокую надежность, т.е. 11 девяток.
Glacier это опция хранения данных с самым дешевым тарифом.
Когда мы говорим Glacier, то мы должны быть готовы, что данные извлекаются не сразу, т.е. есть три опции, это Standard, Bulk и Expedited.
Когда мы говорим Expedited, это ускоренный вариант, данные могут быть извлечены в течение 1-5 минуты.
Это та опция, которая самая дорогая.
Дальше идет стандартная опция, когда мы данные извлекаем в течение 3-5 часов и стоит соответственно среднее.
И самая дешевая опция, это когда мы используем опцию Bulk, когда данные извлекаются от 5-12 часов.
Если говорить про безопасность, то Glacier поддерживает SSL/TLS.
Также что следует отметить, это Vault Lock feature.
Для того, чтобы ее объяснить, давайте введем некоторые термины.
Есть понятие archive, т.е. архив.
Это любой объект, это может быть медиафайл, текстовый файл, тот объект, который вы хотите архивировать.
Vault – это набор архивов, которые вы храните вместе.
Представьте, что vault это некий аналог zip архива на локальном нашем компьютере.
И также есть такое понятие, как Vault Access policy.
Это как раз таки Vault Lock feature.
Идея в том, что вы можете привязать к вашему vault некий access policy, который определяет, кто по каким условиям может или не может обратиться к объектам, которые хранятся внутри вашего vault-a.
Vault дословно переводится как погреб либо подвал.
Давайте подробнее остановимся на самых основных use case-ах сервиса Amazon S3 Glacier.
Первый – это Media asset archiving.
Это когда мы храним некоторые данные, как видео, некоторые текстовые информации, т.е. какие-то новости, надежно и в большом объеме.
Далее – это Healthcare information archiving, т.е. это хранение больших объемов информации, которые из сферы медицины, т.е. это информация о проведенных исследованиях, о медицинской истории пациентов и так далее.
Также здесь сюда могут относиться медицинские анализы, различные снимки и так далее, которые тоже оцифрованные и должны где-то храниться.
Другой вариант это Regulatory and compliance archiving.
Это то, что мы ранее говорили, т.е. в зависимости от сферы есть определенные требования по закону, такие как финансы, здравоохранение, государственный сектор, который обязан хранить данные в течение определенного периода.
Эти данные должны храниться, так как они могут быть востребованы клиентами, пациентами и компания ввиду некоторых законов и положений, обязана предоставить эти данные.
Соответственно она их удалить не может, но ему достаточно хранить определенный период, обычно несколько лет, от трех лет до десяти лет, после чего данные могут быть удалены.
Еще один пример – это хранение научных данных, т.е. во время проведения некоторых наукоемких расчетов генерируется большой объем искусственно либо собирается большой объем данных для дальнейшего анализа.
И для того, чтобы выгодно хранить эти данные, так чтобы они были и доступны, и при этом недорого хранились, то можно воспользоваться сервисом Amazon S3 Glacier.
Другой момент это то, что по старинке, данные, архивы, они хранятся на магнитных носителях, т.е. в HDD дисках, и как только вы загружаете сюда данные, жесткие диски отключаются от системы и хранятся где-то там на полочке.
Это не очень надежно, потому что жесткие диски они в виду конструкции своей могут размагнитиваться и соответственно данные теряются.
Да, можно хранить данные в RAID-массивах, либо как-то попроще, реплицировать, хранить несколько копий, но сам процесс хранения, понимания, где какие данные лежат, он может быть достаточно трудоемким, если это большие объемы данных, и Amazon S3 Glacier выступает как выгодный аналог хранения данных в облаке, при этом вот эта опция архивирования ваших данных предоставляется как готовый сервис.
Давайте теперь подробнее поговорим, что же такое Lifecycle Policies, на нее мы ранее ссылались на предыдущих слайдах.
Это та опция, которая позволяет вам настроить жизненный цикл ваших данных внутри Amazon S3.
Также мы используем наш Lifecycle Policies, если по тем или иным причинам Intelligent Tiering для нас не подходит.
Итак, представим, что у нас есть некоторый сайт, на этом сайте мы публикуем видео-контент, и мы знаем, что в течение месяца после публикации видеоматериала, в течение месяца она активно просматривается.
Таким образом, наиболее оптимальный вариант класс хранения файлов первые 30 дней жизни это Amazon S3 Standard класс хранения.
Далее, мы собираем некоторую статистику, анализируем, и мы знаем, что через 30 дней наш видеоматериал, так как уже был просмотрен большей частью нашей аудитории, оно редко просматривается.
Таким образом, мы можем сэкономить расходы на хранение наших видео-файлов и перенести через 30 дней на класс хранения Amazon S3 Standard-Infrequent Access.
Далее, мы с вами знаем, что через 60 дней мы не храним наш контент на нашем сайте, а через 60 дней его удаляем по некоторым причинам, и нам нужно удалить эти файлы.
Но мы можем эти данные по запросу выдать.
В этом случае, через 60 дней, мы можем настроить перенос наших mp4-файлов с Amazon S3 Standard-Infrequent Access класса хранения на Amazon S3 Glacier, когда мы данные сразу отдать не можем, но достаточно дешево можем хранить.
Этот видео-контент хранится в течение года, и если кто-то запрашивает, то мы можем этот контент выдать.
Далее мы говорим, что через год мы можем смело удалять наш видео-контент, ввиду того, что он становится неактуальным.
Никто его смотреть не будет, и, соответственно, нет смысла платить за его хранение и обслуживание.
Мы можем настроить Lifecycle Policy таким образом, что через год она автоматически удаляется.
Таким образом, мы видим, что мы можем настроить Lifecycle Policy, т.е. некоторый шаблон, что происходит с объектом после определенного количества дней с момента загрузки, и она автоматически применяется ко всем объектам на уровне этого объекта, т.е. объект мы загрузили сегодня, и через 30 дней она переходит в Amazon S3 Standard-Infrequent Access.
Дальше, если мы говорим, что мы через 3 дня загружаем новый объект, то для него отчет начинается с момента его загрузки.
И опять же через 30 дней происходит переход на другой класс хранения.
Давайте с вами разберем сравнительную таблицу между стандартными классами Amazon S3, а также классами хранения Amazon S3 Glacier.
Чем же они отличаются? 
Основные отличия это Average Latency, т.е. как быстро вы получаете файл.
Если мы говорим про стандартные классы S3, то это миллисекунды, т.е. мы получаем файл сразу.
Если мы говорим про классы хранения Glacier, это Glacier Archive, то здесь это минуты и часы, т.е. мы файлы не сможем получить сразу, это не в онлайне, поэтому нужно планировать у себя дополнительно, что файлы вы получите через какое-то время.
Если мы говорим про максимальный размер файла, который можем хранить, т.е. объекта, для стандартных классов хранения S3 это 5 ТБ максимум, а для Amazon S3 Glacier мы уже можем сохранить объект до 40 ТБ.
Если мы говорим про оплату на хранение за каждый гигабайт ежемесячно, то стандартные классы хранения относительно дорого стоят, а Amazon S3 Glacier намного дешевле.
И обратный случай, когда мы говорим про Retrieval Pricing, т.е. цена извлечения данных, то для стандартных классов Amazon S3 где-то мы не оплачиваем даже за retrieval, где-то мы оплачиваем небольшие суммы, небольшой тариф, в случае когда мы говорим про извлечение из Glacier, то это стоит дороже.
Поэтому нужно знать подробно информацию о своих данных для того, чтобы расположить в правильном классе хранения.
На этом мы добрались до самого конца четвертой секции, и давайте пройдемся по самым основным моментам, связанных с сервисом Amazon S3 Glacier.
Это тот сервис, который позволяет нам архивировать и хранить дешево наши данные в облаке.
Этот сервис, так же как и Amazon S3, предоставляет достаточно высокую надежность хранения, т.е. это 11 девяток , т.е. это 99,9…9% того, что данные не потеряются.
Это гарантия.
Также важно отметить, что цена за хранение Amazon S3 Glacier намного меньше и выгоднее по сравнению со стандартными классами хранения Amazon S3.
Но при этом чем же кардинально отличается, это то, что при стандартных классах Amazon S3 мы извлекаем данные сразу онлайн.
Когда мы говорим про классы хранения Glacier, это Glacier и Glacier Archive, то данные извлекаются в течение минут или нескольких часов, т.е. до 12 часов может занимать время извлечения ваших данных с vault-ов.
Поэтому этот момент нужно учитывать.
На этом мы добрались до самого конца нашей лекции, рассмотрели все четыре сервиса, связанных с хранением.
Буквально пару основных моментов.
Это то, что Amazon S3 это объектное хранилище, у нас есть Amazon EBS для блочного хранения данных, обычно мы используем в связке с инстансами Amazon EC2.
Далее есть Amazon EFS, если нам необходимо для нескольких инстансов Amazon EC2 предоставить общую файловую систему и есть у нас Amazon S3 Glacier, который мы дополнительно отдельно рассмотрели, это два отдельных класса хранения Glacier и Glacier Archive, которые позволяют нам выгодно хранить наши архивные данные.
На этом слайде вы видите возможные полезные ссылки для дополнительного изучения.
На этом мы заканчиваем нашу лекцию.
Я надеюсь вы получили более полное представление об основных сервисах хранения, если есть вопросы обязательно задавайте и увидимся с вами на следующих наших активностях.
